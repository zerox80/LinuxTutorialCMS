2025-11-19T16:05:49.1905857Z Current runner version: '2.329.0'
2025-11-19T16:05:49.1929558Z ##[group]Runner Image Provisioner
2025-11-19T16:05:49.1930443Z Hosted Compute Agent
2025-11-19T16:05:49.1930914Z Version: 20251016.436
2025-11-19T16:05:49.1931457Z Commit: 8ab8ac8bfd662a3739dab9fe09456aba92132568
2025-11-19T16:05:49.1932087Z Build Date: 2025-10-15T20:44:12Z
2025-11-19T16:05:49.1932610Z ##[endgroup]
2025-11-19T16:05:49.1933076Z ##[group]Operating System
2025-11-19T16:05:49.1933602Z Ubuntu
2025-11-19T16:05:49.1934041Z 24.04.3
2025-11-19T16:05:49.1934441Z LTS
2025-11-19T16:05:49.1934872Z ##[endgroup]
2025-11-19T16:05:49.1935288Z ##[group]Runner Image
2025-11-19T16:05:49.1935805Z Image: ubuntu-24.04
2025-11-19T16:05:49.1936242Z Version: 20251112.124.1
2025-11-19T16:05:49.1937164Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20251112.124/images/ubuntu/Ubuntu2404-Readme.md
2025-11-19T16:05:49.1938525Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20251112.124
2025-11-19T16:05:49.1939524Z ##[endgroup]
2025-11-19T16:05:49.1940553Z ##[group]GITHUB_TOKEN Permissions
2025-11-19T16:05:49.1942393Z Contents: read
2025-11-19T16:05:49.1942881Z Metadata: read
2025-11-19T16:05:49.1943384Z Packages: read
2025-11-19T16:05:49.1943815Z ##[endgroup]
2025-11-19T16:05:49.1945873Z Secret source: Actions
2025-11-19T16:05:49.1946447Z Prepare workflow directory
2025-11-19T16:05:49.2270894Z Prepare all required actions
2025-11-19T16:05:49.2308761Z Getting action download info
2025-11-19T16:05:49.6398116Z Download action repository 'actions/checkout@v5' (SHA:93cb6efe18208431cddfb8368fd83d5badbf9bfd)
2025-11-19T16:05:50.2463279Z Download action repository 'actions-rs/toolchain@v1' (SHA:16499b5e05bf2e26879000db0c1d13f7e13fa3af)
2025-11-19T16:05:50.8195829Z Download action repository 'actions/cache@v4' (SHA:0057852bfaa89a56745cba8c7296529d2fc39830)
2025-11-19T16:05:51.0577613Z Complete job name: backend-test
2025-11-19T16:05:51.1370159Z ##[group]Run actions/checkout@v5
2025-11-19T16:05:51.1371723Z with:
2025-11-19T16:05:51.1372613Z   repository: zerox80/RustBlogCMS
2025-11-19T16:05:51.1374151Z   token: ***
2025-11-19T16:05:51.1374965Z   ssh-strict: true
2025-11-19T16:05:51.1375884Z   ssh-user: git
2025-11-19T16:05:51.1376806Z   persist-credentials: true
2025-11-19T16:05:51.1377771Z   clean: true
2025-11-19T16:05:51.1378671Z   sparse-checkout-cone-mode: true
2025-11-19T16:05:51.1379811Z   fetch-depth: 1
2025-11-19T16:05:51.1380743Z   fetch-tags: false
2025-11-19T16:05:51.1381619Z   show-progress: true
2025-11-19T16:05:51.1382533Z   lfs: false
2025-11-19T16:05:51.1383376Z   submodules: false
2025-11-19T16:05:51.1384278Z   set-safe-directory: true
2025-11-19T16:05:51.1385539Z ##[endgroup]
2025-11-19T16:05:51.2558870Z Syncing repository: zerox80/RustBlogCMS
2025-11-19T16:05:51.2563870Z ##[group]Getting Git version info
2025-11-19T16:05:51.2566098Z Working directory is '/home/runner/work/RustBlogCMS/RustBlogCMS'
2025-11-19T16:05:51.2569792Z [command]/usr/bin/git version
2025-11-19T16:05:51.2571173Z git version 2.51.2
2025-11-19T16:05:51.2579434Z ##[endgroup]
2025-11-19T16:05:51.2596182Z Temporarily overriding HOME='/home/runner/work/_temp/fe090c84-739c-4469-89e4-3a15988e0c69' before making global git config changes
2025-11-19T16:05:51.2600724Z Adding repository directory to the temporary git global config as a safe directory
2025-11-19T16:05:51.2604398Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/RustBlogCMS/RustBlogCMS
2025-11-19T16:05:51.2644143Z Deleting the contents of '/home/runner/work/RustBlogCMS/RustBlogCMS'
2025-11-19T16:05:51.2647933Z ##[group]Initializing the repository
2025-11-19T16:05:51.2653283Z [command]/usr/bin/git init /home/runner/work/RustBlogCMS/RustBlogCMS
2025-11-19T16:05:51.2751882Z hint: Using 'master' as the name for the initial branch. This default branch name
2025-11-19T16:05:51.2755122Z hint: is subject to change. To configure the initial branch name to use in all
2025-11-19T16:05:51.2757736Z hint: of your new repositories, which will suppress this warning, call:
2025-11-19T16:05:51.2760415Z hint:
2025-11-19T16:05:51.2761906Z hint: 	git config --global init.defaultBranch <name>
2025-11-19T16:05:51.2763671Z hint:
2025-11-19T16:05:51.2765272Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2025-11-19T16:05:51.2767814Z hint: 'development'. The just-created branch can be renamed via this command:
2025-11-19T16:05:51.2769559Z hint:
2025-11-19T16:05:51.2770350Z hint: 	git branch -m <name>
2025-11-19T16:05:51.2771189Z hint:
2025-11-19T16:05:51.2772285Z hint: Disable this message with "git config set advice.defaultBranchName false"
2025-11-19T16:05:51.2774281Z Initialized empty Git repository in /home/runner/work/RustBlogCMS/RustBlogCMS/.git/
2025-11-19T16:05:51.2777445Z [command]/usr/bin/git remote add origin https://github.com/zerox80/RustBlogCMS
2025-11-19T16:05:51.2812327Z ##[endgroup]
2025-11-19T16:05:51.2813797Z ##[group]Disabling automatic garbage collection
2025-11-19T16:05:51.2818458Z [command]/usr/bin/git config --local gc.auto 0
2025-11-19T16:05:51.2854963Z ##[endgroup]
2025-11-19T16:05:51.2856295Z ##[group]Setting up auth
2025-11-19T16:05:51.2865526Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-11-19T16:05:51.2907948Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-11-19T16:05:51.3238988Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-11-19T16:05:51.3273814Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-11-19T16:05:51.3493838Z [command]/usr/bin/git config --local --name-only --get-regexp ^includeIf\.gitdir:
2025-11-19T16:05:51.3533751Z [command]/usr/bin/git submodule foreach --recursive git config --local --show-origin --name-only --get-regexp remote.origin.url
2025-11-19T16:05:51.3769956Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2025-11-19T16:05:51.3809636Z ##[endgroup]
2025-11-19T16:05:51.3811889Z ##[group]Fetching the repository
2025-11-19T16:05:51.3821545Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +feacb2dfad6cd511531325a37b8c3fcb8aecca15:refs/remotes/origin/main
2025-11-19T16:05:51.9456399Z From https://github.com/zerox80/RustBlogCMS
2025-11-19T16:05:51.9457374Z  * [new ref]         feacb2dfad6cd511531325a37b8c3fcb8aecca15 -> origin/main
2025-11-19T16:05:51.9490199Z ##[endgroup]
2025-11-19T16:05:51.9490768Z ##[group]Determining the checkout info
2025-11-19T16:05:51.9492255Z ##[endgroup]
2025-11-19T16:05:51.9497317Z [command]/usr/bin/git sparse-checkout disable
2025-11-19T16:05:51.9540789Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2025-11-19T16:05:51.9568551Z ##[group]Checking out the ref
2025-11-19T16:05:51.9572972Z [command]/usr/bin/git checkout --progress --force -B main refs/remotes/origin/main
2025-11-19T16:05:51.9696226Z Switched to a new branch 'main'
2025-11-19T16:05:51.9697009Z branch 'main' set up to track 'origin/main'.
2025-11-19T16:05:51.9702598Z ##[endgroup]
2025-11-19T16:05:51.9750911Z [command]/usr/bin/git log -1 --format=%H
2025-11-19T16:05:51.9776611Z feacb2dfad6cd511531325a37b8c3fcb8aecca15
2025-11-19T16:05:51.9982387Z ##[group]Run actions-rs/toolchain@v1
2025-11-19T16:05:51.9982825Z with:
2025-11-19T16:05:51.9983078Z   toolchain: 1.83.0
2025-11-19T16:05:51.9983361Z   override: true
2025-11-19T16:05:51.9983631Z   components: rustfmt, clippy
2025-11-19T16:05:51.9983929Z   default: false
2025-11-19T16:05:51.9984182Z ##[endgroup]
2025-11-19T16:05:52.1000737Z [command]/home/runner/.cargo/bin/rustup show
2025-11-19T16:05:52.4306596Z Default host: x86_64-unknown-linux-gnu
2025-11-19T16:05:52.4307263Z rustup home:  /home/runner/.rustup
2025-11-19T16:05:52.4308080Z 
2025-11-19T16:05:52.5121040Z installed toolchains
2025-11-19T16:05:52.5121675Z --------------------
2025-11-19T16:05:52.5122091Z stable-x86_64-unknown-linux-gnu (active, default)
2025-11-19T16:05:52.5122502Z 
2025-11-19T16:05:52.5122675Z active toolchain
2025-11-19T16:05:52.5123081Z ----------------
2025-11-19T16:05:52.5123509Z name: stable-x86_64-unknown-linux-gnu
2025-11-19T16:05:52.5124190Z active because: it's the default toolchain
2025-11-19T16:05:52.5124895Z installed targets:
2025-11-19T16:05:52.5125338Z   x86_64-unknown-linux-gnu
2025-11-19T16:05:52.5162409Z [command]/home/runner/.cargo/bin/rustup -V
2025-11-19T16:05:52.5217543Z rustup 1.28.2 (e4f3ad6f8 2025-04-28)
2025-11-19T16:05:52.5254743Z info: This is the version for the rustup toolchain manager, not the rustc compiler.
2025-11-19T16:05:53.4620609Z info: The currently active `rustc` version is `rustc 1.91.1 (ed61e7d7e 2025-11-07)`
2025-11-19T16:05:53.4641605Z Installed rustup 1.28.2 support components
2025-11-19T16:05:53.4646474Z [command]/home/runner/.cargo/bin/rustup toolchain install 1.83.0 --component rustfmt --component clippy
2025-11-19T16:05:53.4795873Z info: syncing channel updates for '1.83.0-x86_64-unknown-linux-gnu'
2025-11-19T16:05:53.7884926Z info: latest update on 2024-11-28, rust version 1.83.0 (90b35a623 2024-11-26)
2025-11-19T16:05:53.7885869Z info: downloading component 'cargo'
2025-11-19T16:05:54.0178946Z info: downloading component 'clippy'
2025-11-19T16:05:54.1746046Z info: downloading component 'rust-std'
2025-11-19T16:05:54.5961712Z info: downloading component 'rustc'
2025-11-19T16:05:55.5007080Z info: downloading component 'rustfmt'
2025-11-19T16:05:55.8377947Z info: installing component 'cargo'
2025-11-19T16:05:56.5300203Z info: installing component 'clippy'
2025-11-19T16:05:56.8332478Z info: installing component 'rust-std'
2025-11-19T16:05:58.8558211Z info: installing component 'rustc'
2025-11-19T16:06:03.6610317Z info: installing component 'rustfmt'
2025-11-19T16:06:03.9769845Z 
2025-11-19T16:06:03.9884158Z   1.83.0-x86_64-unknown-linux-gnu installed - rustc 1.83.0 (90b35a623 2024-11-26)
2025-11-19T16:06:03.9884710Z 
2025-11-19T16:06:03.9909524Z [command]/home/runner/.cargo/bin/rustup override set 1.83.0
2025-11-19T16:06:03.9973293Z info: override toolchain for '/home/runner/work/RustBlogCMS/RustBlogCMS' set to '1.83.0-x86_64-unknown-linux-gnu'
2025-11-19T16:06:04.0001287Z ##[group]Gathering installed versions
2025-11-19T16:06:04.0008964Z [command]/home/runner/.cargo/bin/rustc -V
2025-11-19T16:06:04.0426663Z rustc 1.83.0 (90b35a623 2024-11-26)
2025-11-19T16:06:04.0458302Z ##[warning]The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/
2025-11-19T16:06:04.0469649Z ##[warning]The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/
2025-11-19T16:06:04.0471175Z [command]/home/runner/.cargo/bin/cargo -V
2025-11-19T16:06:04.0855977Z cargo 1.83.0 (5ffbef321 2024-10-29)
2025-11-19T16:06:04.0867834Z ##[warning]The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/
2025-11-19T16:06:04.0874294Z [command]/home/runner/.cargo/bin/rustup -V
2025-11-19T16:06:04.0923058Z rustup 1.28.2 (e4f3ad6f8 2025-04-28)
2025-11-19T16:06:04.0923783Z info: This is the version for the rustup toolchain manager, not the rustc compiler.
2025-11-19T16:06:04.1309656Z info: The currently active `rustc` version is `rustc 1.83.0 (90b35a623 2024-11-26)`
2025-11-19T16:06:04.1323380Z ##[warning]The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/
2025-11-19T16:06:04.1325526Z ##[endgroup]
2025-11-19T16:06:04.2074056Z ##[group]Run actions/cache@v4
2025-11-19T16:06:04.2074304Z with:
2025-11-19T16:06:04.2074489Z   path: ~/.cargo/registry
2025-11-19T16:06:04.2074696Z   key: Linux-cargo-registry-
2025-11-19T16:06:04.2074927Z   enableCrossOsArchive: false
2025-11-19T16:06:04.2075142Z   fail-on-cache-miss: false
2025-11-19T16:06:04.2075353Z   lookup-only: false
2025-11-19T16:06:04.2075535Z   save-always: false
2025-11-19T16:06:04.2075723Z ##[endgroup]
2025-11-19T16:06:04.5819448Z Cache not found for input keys: Linux-cargo-registry-
2025-11-19T16:06:04.6543731Z ##[group]Run actions/cache@v4
2025-11-19T16:06:04.6543977Z with:
2025-11-19T16:06:04.6544147Z   path: ~/.cargo/git
2025-11-19T16:06:04.6544352Z   key: Linux-cargo-index-
2025-11-19T16:06:04.6544566Z   enableCrossOsArchive: false
2025-11-19T16:06:04.6544791Z   fail-on-cache-miss: false
2025-11-19T16:06:04.6545025Z   lookup-only: false
2025-11-19T16:06:04.6545216Z   save-always: false
2025-11-19T16:06:04.6545397Z ##[endgroup]
2025-11-19T16:06:04.9958742Z Cache not found for input keys: Linux-cargo-index-
2025-11-19T16:06:05.0736472Z ##[group]Run actions/cache@v4
2025-11-19T16:06:05.0736722Z with:
2025-11-19T16:06:05.0736895Z   path: backend/target
2025-11-19T16:06:05.0737245Z   key: Linux-cargo-build-target-
2025-11-19T16:06:05.0737483Z   enableCrossOsArchive: false
2025-11-19T16:06:05.0737723Z   fail-on-cache-miss: false
2025-11-19T16:06:05.0737947Z   lookup-only: false
2025-11-19T16:06:05.0738132Z   save-always: false
2025-11-19T16:06:05.0738326Z ##[endgroup]
2025-11-19T16:06:05.4180873Z Cache not found for input keys: Linux-cargo-build-target-
2025-11-19T16:06:05.4246579Z ##[group]Run cargo fmt -- --check
2025-11-19T16:06:05.4246913Z [36;1mcargo fmt -- --check[0m
2025-11-19T16:06:05.4272668Z shell: /usr/bin/bash -e {0}
2025-11-19T16:06:05.4272916Z ##[endgroup]
2025-11-19T16:06:05.5576966Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/export_content.rs:1:
2025-11-19T16:06:05.5577498Z -
2025-11-19T16:06:05.5577650Z -
2025-11-19T16:06:05.5577791Z  /**
2025-11-19T16:06:05.5577947Z   * Content Export Utility
2025-11-19T16:06:05.5578147Z   *
2025-11-19T16:06:05.5578455Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/export_content.rs:32:
2025-11-19T16:06:05.5578861Z   * - Handles database errors safely
2025-11-19T16:06:05.5579125Z   * - Uses proper error handling for file operations
2025-11-19T16:06:05.5579527Z   */
2025-11-19T16:06:05.5579666Z -
2025-11-19T16:06:05.5584151Z  use std::{env, fs, path::Path};
2025-11-19T16:06:05.5584384Z  
2025-11-19T16:06:05.5584574Z  use anyhow::{Context, Result};
2025-11-19T16:06:05.5585002Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/export_content.rs:169:
2025-11-19T16:06:05.5585367Z  
2025-11-19T16:06:05.5585530Z  #[tokio::main]
2025-11-19T16:06:05.5585736Z  async fn main() -> Result<()> {
2025-11-19T16:06:05.5585937Z -
2025-11-19T16:06:05.5586104Z      dotenv::dotenv().ok();
2025-11-19T16:06:05.5586288Z  
2025-11-19T16:06:05.5586480Z      let args: Vec<String> = env::args().collect();
2025-11-19T16:06:05.5595807Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:1:
2025-11-19T16:06:05.5596484Z -
2025-11-19T16:06:05.5596702Z -
2025-11-19T16:06:05.5596924Z  /**
2025-11-19T16:06:05.5597157Z   * Content Import Utility
2025-11-19T16:06:05.5597356Z   *
2025-11-19T16:06:05.5597667Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:39:
2025-11-19T16:06:05.5598069Z   * - Database connection or transaction errors
2025-11-19T16:06:05.5598325Z   * - Data validation failures
2025-11-19T16:06:05.5598526Z   */
2025-11-19T16:06:05.5598680Z -
2025-11-19T16:06:05.5598856Z  use std::{env, fs, path::Path};
2025-11-19T16:06:05.5599057Z  
2025-11-19T16:06:05.5599350Z  use anyhow::{anyhow, Context, Result};
2025-11-19T16:06:05.5599747Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:51:
2025-11-19T16:06:05.5600396Z  
2025-11-19T16:06:05.5600602Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.5600833Z  struct SiteContentImport {
2025-11-19T16:06:05.5601030Z -
2025-11-19T16:06:05.5601185Z      section: String,
2025-11-19T16:06:05.5601353Z  
2025-11-19T16:06:05.5601512Z      content: Value,
2025-11-19T16:06:05.5601979Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:62:
2025-11-19T16:06:05.5602331Z  
2025-11-19T16:06:05.5602520Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.5602731Z  struct SitePageImport {
2025-11-19T16:06:05.5602922Z -
2025-11-19T16:06:05.5603065Z      id: String,
2025-11-19T16:06:05.5603229Z  
2025-11-19T16:06:05.5603420Z      slug: String,
2025-11-19T16:06:05.5603743Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:92:
2025-11-19T16:06:05.5604101Z  
2025-11-19T16:06:05.5604250Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.5604463Z  struct SitePostImport {
2025-11-19T16:06:05.5604646Z -
2025-11-19T16:06:05.5604790Z      id: String,
2025-11-19T16:06:05.5604945Z  
2025-11-19T16:06:05.5605097Z      page_id: String,
2025-11-19T16:06:05.5605426Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:120:
2025-11-19T16:06:05.5605788Z  
2025-11-19T16:06:05.5605936Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.5606145Z  struct ImportBundle {
2025-11-19T16:06:05.5606312Z -
2025-11-19T16:06:05.5606574Z      site_content: Vec<SiteContentImport>,
2025-11-19T16:06:05.5606830Z  
2025-11-19T16:06:05.5606986Z      pages: Vec<SitePageImport>,
2025-11-19T16:06:05.5607351Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:130:
2025-11-19T16:06:05.5607895Z  
2025-11-19T16:06:05.5608050Z  #[tokio::main]
2025-11-19T16:06:05.5608240Z  async fn main() -> Result<()> {
2025-11-19T16:06:05.5608438Z -
2025-11-19T16:06:05.5608605Z      dotenv::dotenv().ok();
2025-11-19T16:06:05.5608790Z  
2025-11-19T16:06:05.5608981Z      let args: Vec<String> = env::args().collect();
2025-11-19T16:06:05.5609469Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:178:
2025-11-19T16:06:05.5609868Z      tx: &mut Transaction<'_, Sqlite>,
2025-11-19T16:06:05.5610100Z      items: &[SiteContentImport],
2025-11-19T16:06:05.5610326Z  ) -> Result<()> {
2025-11-19T16:06:05.5610528Z -
2025-11-19T16:06:05.5610675Z      for item in items {
2025-11-19T16:06:05.5610858Z -
2025-11-19T16:06:05.5611078Z          let serialized = serde_json::to_string(&item.content)
2025-11-19T16:06:05.5611400Z              .context("Failed to serialize site_content entry")?;
2025-11-19T16:06:05.5611646Z  
2025-11-19T16:06:05.5611957Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:203:
2025-11-19T16:06:05.5612332Z      tx: &mut Transaction<'_, Sqlite>,
2025-11-19T16:06:05.5612574Z      items: &[SitePageImport],
2025-11-19T16:06:05.5612772Z  ) -> Result<()> {
2025-11-19T16:06:05.5612942Z -
2025-11-19T16:06:05.5613105Z      for item in items {
2025-11-19T16:06:05.5613282Z -
2025-11-19T16:06:05.5613440Z          let hero_serialized =
2025-11-19T16:06:05.5613761Z              serde_json::to_string(&item.hero).context("Failed to serialize page hero JSON")?;
2025-11-19T16:06:05.5614104Z          let layout_serialized =
2025-11-19T16:06:05.5614460Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/bin/import_content.rs:241:
2025-11-19T16:06:05.5614844Z      tx: &mut Transaction<'_, Sqlite>,
2025-11-19T16:06:05.5615071Z      items: &[SitePostImport],
2025-11-19T16:06:05.5615276Z  ) -> Result<()> {
2025-11-19T16:06:05.5615444Z -
2025-11-19T16:06:05.5615591Z      for item in items {
2025-11-19T16:06:05.5615804Z -
2025-11-19T16:06:05.5615966Z          sqlx::query(
2025-11-19T16:06:05.5616434Z              "INSERT INTO site_posts (id, page_id, title, slug, excerpt, content_markdown, is_published, published_at, order_index, created_at, updated_at) \
2025-11-19T16:06:05.5617025Z               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, COALESCE(?, CURRENT_TIMESTAMP), COALESCE(?, CURRENT_TIMESTAMP)) \
2025-11-19T16:06:05.5738264Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:19:
2025-11-19T16:06:05.5738816Z  //! ```
2025-11-19T16:06:05.5739055Z  
2025-11-19T16:06:05.5739362Z  use axum::{
2025-11-19T16:06:05.5739608Z +    extract::FromRef,
2025-11-19T16:06:05.5739818Z      extract::FromRequestParts,
2025-11-19T16:06:05.5740030Z      http::{
2025-11-19T16:06:05.5740221Z          header::{AUTHORIZATION, SET_COOKIE},
2025-11-19T16:06:05.5740561Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:26:
2025-11-19T16:06:05.5740896Z          HeaderMap, HeaderValue, StatusCode,
2025-11-19T16:06:05.5741128Z      },
2025-11-19T16:06:05.5741282Z      Json,
2025-11-19T16:06:05.5741447Z -    extract::FromRef,
2025-11-19T16:06:05.5741619Z  };
2025-11-19T16:06:05.5741849Z  use axum_extra::extract::cookie::{Cookie, CookieJar, SameSite};
2025-11-19T16:06:05.5742151Z  use chrono::{Duration, Utc};
2025-11-19T16:06:05.5742461Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:33:
2025-11-19T16:06:05.5742908Z  use jsonwebtoken::{decode, encode, DecodingKey, EncodingKey, Header, Validation};
2025-11-19T16:06:05.5743245Z -use std::sync::LazyLock;
2025-11-19T16:06:05.5743481Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.5743708Z -use std::sync::OnceLock;
2025-11-19T16:06:05.5743915Z  use std::collections::HashSet;
2025-11-19T16:06:05.5744116Z  use std::env;
2025-11-19T16:06:05.5744299Z +use std::sync::LazyLock;
2025-11-19T16:06:05.5744496Z +use std::sync::OnceLock;
2025-11-19T16:06:05.5744733Z  use time::{Duration as TimeDuration, OffsetDateTime};
2025-11-19T16:06:05.5744988Z  
2025-11-19T16:06:05.5745335Z  use crate::db::{self, DbPool};
2025-11-19T16:06:05.5745656Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:46:
2025-11-19T16:06:05.5745973Z  
2025-11-19T16:06:05.5746168Z  /// Global storage for the JWT decoding key.
2025-11-19T16:06:05.5746444Z  /// Derived from JWT_SECRET once it's initialized.
2025-11-19T16:06:05.5746792Z -pub static DECODING_KEY: LazyLock<DecodingKey> = LazyLock::new(|| {
2025-11-19T16:06:05.5747173Z -    DecodingKey::from_secret(get_jwt_secret().as_bytes())
2025-11-19T16:06:05.5747429Z -});
2025-11-19T16:06:05.5747627Z +pub static DECODING_KEY: LazyLock<DecodingKey> =
2025-11-19T16:06:05.5747961Z +    LazyLock::new(|| DecodingKey::from_secret(get_jwt_secret().as_bytes()));
2025-11-19T16:06:05.5748262Z  
2025-11-19T16:06:05.5748517Z  /// List of known placeholder secrets that must not be used in production.
2025-11-19T16:06:05.5748896Z  /// These are common defaults found in example configurations.
2025-11-19T16:06:05.5749406Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:391:
2025-11-19T16:06:05.5749733Z  
2025-11-19T16:06:05.5749915Z          // Check if token is blacklisted
2025-11-19T16:06:05.5750165Z          let pool = DbPool::from_ref(state);
2025-11-19T16:06:05.5750568Z -        let is_blacklisted = crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.5750943Z -            .await
2025-11-19T16:06:05.5751134Z -            .map_err(|e| {
2025-11-19T16:06:05.5751461Z -                tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.5751764Z -                (
2025-11-19T16:06:05.5751963Z -                    StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.5752230Z -                    "Internal server error".to_string(),
2025-11-19T16:06:05.5752460Z -                )
2025-11-19T16:06:05.5752618Z -            })?;
2025-11-19T16:06:05.5752795Z +        let is_blacklisted =
2025-11-19T16:06:05.5753109Z +            crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.5753429Z +                .await
2025-11-19T16:06:05.5753608Z +                .map_err(|e| {
2025-11-19T16:06:05.5753900Z +                    tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.5754273Z +                    (
2025-11-19T16:06:05.5754491Z +                        StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.5754762Z +                        "Internal server error".to_string(),
2025-11-19T16:06:05.5754996Z +                    )
2025-11-19T16:06:05.5755173Z +                })?;
2025-11-19T16:06:05.5755333Z  
2025-11-19T16:06:05.5755493Z          if is_blacklisted {
2025-11-19T16:06:05.5755805Z -            return Err((StatusCode::UNAUTHORIZED, "Token has been revoked".to_string()));
2025-11-19T16:06:05.5756141Z +            return Err((
2025-11-19T16:06:05.5756342Z +                StatusCode::UNAUTHORIZED,
2025-11-19T16:06:05.5756589Z +                "Token has been revoked".to_string(),
2025-11-19T16:06:05.5756825Z +            ));
2025-11-19T16:06:05.5756987Z          }
2025-11-19T16:06:05.5757138Z  
2025-11-19T16:06:05.5757280Z          Ok(claims)
2025-11-19T16:06:05.5757564Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:563:
2025-11-19T16:06:05.5757884Z      None
2025-11-19T16:06:05.5758038Z  }
2025-11-19T16:06:05.5758181Z  
2025-11-19T16:06:05.5758323Z -
2025-11-19T16:06:05.5758640Z  /// Optional Claims extractor for endpoints that support both authenticated and anonymous access.
2025-11-19T16:06:05.5759019Z  ///
2025-11-19T16:06:05.5759293Z  /// If a valid token is provided, it extracts the claims.
2025-11-19T16:06:05.5759669Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:596:
2025-11-19T16:06:05.5759991Z  
2025-11-19T16:06:05.5760153Z          // Check if token is blacklisted
2025-11-19T16:06:05.5760409Z          let pool = DbPool::from_ref(state);
2025-11-19T16:06:05.5760867Z -        let is_blacklisted = crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.5761244Z -            .await
2025-11-19T16:06:05.5761485Z -            .map_err(|e| {
2025-11-19T16:06:05.5761768Z -                tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.5762086Z -                (
2025-11-19T16:06:05.5762299Z -                    StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.5762560Z -                    "Internal server error".to_string(),
2025-11-19T16:06:05.5762797Z -                )
2025-11-19T16:06:05.5762959Z -            })?;
2025-11-19T16:06:05.5763136Z +        let is_blacklisted =
2025-11-19T16:06:05.5763436Z +            crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.5763756Z +                .await
2025-11-19T16:06:05.5763940Z +                .map_err(|e| {
2025-11-19T16:06:05.5764226Z +                    tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.5764526Z +                    (
2025-11-19T16:06:05.5764726Z +                        StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.5764996Z +                        "Internal server error".to_string(),
2025-11-19T16:06:05.5765224Z +                    )
2025-11-19T16:06:05.5765397Z +                })?;
2025-11-19T16:06:05.5765561Z  
2025-11-19T16:06:05.5765719Z          if is_blacklisted {
2025-11-19T16:06:05.5766028Z -            return Err((StatusCode::UNAUTHORIZED, "Token has been revoked".to_string()));
2025-11-19T16:06:05.5766359Z +            return Err((
2025-11-19T16:06:05.5766564Z +                StatusCode::UNAUTHORIZED,
2025-11-19T16:06:05.5766956Z +                "Token has been revoked".to_string(),
2025-11-19T16:06:05.5767336Z +            ));
2025-11-19T16:06:05.5767495Z          }
2025-11-19T16:06:05.5767651Z  
2025-11-19T16:06:05.5767814Z          Ok(OptionalClaims(Some(claims)))
2025-11-19T16:06:05.5856162Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:125:
2025-11-19T16:06:05.5856685Z      Ok(pool)
2025-11-19T16:06:05.5856921Z  }
2025-11-19T16:06:05.5857128Z  
2025-11-19T16:06:05.5857361Z -
2025-11-19T16:06:05.5857508Z -
2025-11-19T16:06:05.5857647Z -
2025-11-19T16:06:05.5857824Z -
2025-11-19T16:06:05.5857970Z -
2025-11-19T16:06:05.5858301Z -
2025-11-19T16:06:05.5858443Z -
2025-11-19T16:06:05.5858578Z -
2025-11-19T16:06:05.5858862Z  async fn ensure_site_page_schema(pool: &DbPool) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.5859325Z      let mut tx = pool.begin().await?;
2025-11-19T16:06:05.5859546Z  
2025-11-19T16:06:05.5859795Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:210:
2025-11-19T16:06:05.5860134Z  async fn apply_core_migrations(
2025-11-19T16:06:05.5860392Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.5860662Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.5860861Z -
2025-11-19T16:06:05.5861007Z      sqlx::query(
2025-11-19T16:06:05.5861177Z          r#"
2025-11-19T16:06:05.5861357Z          CREATE TABLE IF NOT EXISTS users (
2025-11-19T16:06:05.5861713Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:398:
2025-11-19T16:06:05.5862016Z      Ok(())
2025-11-19T16:06:05.5862171Z  }
2025-11-19T16:06:05.5862310Z  
2025-11-19T16:06:05.5862452Z -
2025-11-19T16:06:05.5862590Z -
2025-11-19T16:06:05.5862750Z  async fn seed_site_content_tx(
2025-11-19T16:06:05.5862989Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.5863230Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.5863534Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:482:
2025-11-19T16:06:05.5863879Z                      "target": { "type": "section", "value": "home" }
2025-11-19T16:06:05.5864123Z                  },
2025-11-19T16:06:05.5864317Z                  "tutorialCardButton": "Zum Tutorial"
2025-11-19T16:06:05.5864550Z -            })
2025-11-19T16:06:05.5864706Z +            }),
2025-11-19T16:06:05.5864866Z          ),
2025-11-19T16:06:05.5865015Z          (
2025-11-19T16:06:05.5865248Z              "site_meta",
2025-11-19T16:06:05.5865541Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:489:
2025-11-19T16:06:05.5865846Z              json!({
2025-11-19T16:06:05.5866332Z                  "title": "Linux Tutorial - Lerne Linux Schritt für Schritt",
2025-11-19T16:06:05.5866729Z                  "description": "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah."
2025-11-19T16:06:05.5867059Z -            })
2025-11-19T16:06:05.5867218Z +            }),
2025-11-19T16:06:05.5867384Z          ),
2025-11-19T16:06:05.5867533Z          (
2025-11-19T16:06:05.5867693Z              "header",
2025-11-19T16:06:05.5867977Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:744:
2025-11-19T16:06:05.5868280Z  
2025-11-19T16:06:05.5868462Z      match (admin_username, admin_password) {
2025-11-19T16:06:05.5868830Z          (Some(username), Some(password)) if !username.is_empty() && !password.is_empty() => {
2025-11-19T16:06:05.5869174Z -
2025-11-19T16:06:05.5869487Z              if password.len() < 12 {
2025-11-19T16:06:05.5869774Z                  tracing::error!(
2025-11-19T16:06:05.5870085Z                      "ADMIN_PASSWORD must be at least 12 characters long (NIST recommendation)!"
2025-11-19T16:06:05.5870507Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:775:
2025-11-19T16:06:05.5870826Z                      }
2025-11-19T16:06:05.5870995Z                  },
2025-11-19T16:06:05.5871170Z                  None => {
2025-11-19T16:06:05.5871350Z -
2025-11-19T16:06:05.5871517Z                      let password_hash =
2025-11-19T16:06:05.5871813Z                          bcrypt::hash(&password, bcrypt::DEFAULT_COST).map_err(|e| {
2025-11-19T16:06:05.5872176Z                              tracing::error!("Failed to hash admin password: {}", e);
2025-11-19T16:06:05.5872551Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:809:
2025-11-19T16:06:05.5872893Z      let mut tx = pool.begin().await?;
2025-11-19T16:06:05.5873111Z  
2025-11-19T16:06:05.5873262Z      if seed_enabled {
2025-11-19T16:06:05.5873440Z -
2025-11-19T16:06:05.5873613Z          let already_seeded: Option<(String,)> =
2025-11-19T16:06:05.5873994Z              sqlx::query_as("SELECT value FROM app_metadata WHERE key = 'default_tutorials_seeded'")
2025-11-19T16:06:05.5874452Z                  .fetch_optional(&mut *tx)
2025-11-19T16:06:05.5874797Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1004:
2025-11-19T16:06:05.5875123Z      Ok(())
2025-11-19T16:06:05.5875276Z  }
2025-11-19T16:06:05.5875454Z  
2025-11-19T16:06:05.5875602Z -
2025-11-19T16:06:05.5875759Z -
2025-11-19T16:06:05.5875893Z -
2025-11-19T16:06:05.5876031Z -
2025-11-19T16:06:05.5876192Z  async fn apply_comment_migrations(
2025-11-19T16:06:05.5876453Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.5876705Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.5877015Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1024:
2025-11-19T16:06:05.5877403Z          sqlx::query("ALTER TABLE comments ADD COLUMN post_id TEXT")
2025-11-19T16:06:05.5877687Z              .execute(&mut **tx)
2025-11-19T16:06:05.5877886Z              .await?;
2025-11-19T16:06:05.5878049Z -        
2025-11-19T16:06:05.5878199Z +
2025-11-19T16:06:05.5878353Z          // Add index for post_id
2025-11-19T16:06:05.5878684Z          sqlx::query("CREATE INDEX IF NOT EXISTS idx_comments_post ON comments(post_id)")
2025-11-19T16:06:05.5879012Z              .execute(&mut **tx)
2025-11-19T16:06:05.5879400Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1038:
2025-11-19T16:06:05.5879752Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.5880005Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.5880215Z      // Create comment_votes table
2025-11-19T16:06:05.5880532Z -    sqlx::query(include_str!("../migrations/20241119_create_comment_votes.sql"))
2025-11-19T16:06:05.5880856Z -        .execute(&mut **tx)
2025-11-19T16:06:05.5881045Z -        .await?;
2025-11-19T16:06:05.5881367Z +    sqlx::query(include_str!(
2025-11-19T16:06:05.5881605Z +        "../migrations/20241119_create_comment_votes.sql"
2025-11-19T16:06:05.5881853Z +    ))
2025-11-19T16:06:05.5882012Z +    .execute(&mut **tx)
2025-11-19T16:06:05.5882210Z +    .await?;
2025-11-19T16:06:05.5882369Z  
2025-11-19T16:06:05.5882547Z      // Add votes column to comments if missing
2025-11-19T16:06:05.5882814Z -    let has_votes: bool = sqlx::query_scalar(
2025-11-19T16:06:05.5883137Z -        "SELECT COUNT(*) FROM pragma_table_info('comments') WHERE name='votes'",
2025-11-19T16:06:05.5883444Z -    )
2025-11-19T16:06:05.5883604Z -    .fetch_one(&mut **tx)
2025-11-19T16:06:05.5883799Z -    .await
2025-11-19T16:06:05.5883967Z -    .map(|count: i64| count > 0)?;
2025-11-19T16:06:05.5884192Z +    let has_votes: bool =
2025-11-19T16:06:05.5884515Z +        sqlx::query_scalar("SELECT COUNT(*) FROM pragma_table_info('comments') WHERE name='votes'")
2025-11-19T16:06:05.5884875Z +            .fetch_one(&mut **tx)
2025-11-19T16:06:05.5885091Z +            .await
2025-11-19T16:06:05.5885272Z +            .map(|count: i64| count > 0)?;
2025-11-19T16:06:05.5885487Z  
2025-11-19T16:06:05.5885637Z      if !has_votes {
2025-11-19T16:06:05.5885884Z          tracing::info!("Adding votes column to comments table");
2025-11-19T16:06:05.5886259Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1121:
2025-11-19T16:06:05.5886633Z      // Actually, apply_comment_migrations adds post_id.
2025-11-19T16:06:05.5887043Z      // Let's check columns in comments_old to be safe, or just assume standard flow.
2025-11-19T16:06:05.5887567Z      // To be safe, we'll select specific columns.
2025-11-19T16:06:05.5887923Z -    
2025-11-19T16:06:05.5888129Z +
2025-11-19T16:06:05.5888359Z      // Note: We need to handle the case where tutorial_id was NOT NULL.
2025-11-19T16:06:05.5888645Z      // If we have data, it's fine.
2025-11-19T16:06:05.5888855Z -    
2025-11-19T16:06:05.5888994Z +
2025-11-19T16:06:05.5889146Z      sqlx::query(
2025-11-19T16:06:05.5889401Z          r#"
2025-11-19T16:06:05.5889716Z          INSERT INTO comments (id, tutorial_id, post_id, author, content, created_at, votes, is_admin)
2025-11-19T16:06:05.5890171Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1148:
2025-11-19T16:06:05.5890584Z          .await?;
2025-11-19T16:06:05.5890754Z  
2025-11-19T16:06:05.5890898Z      // 6. Mark as fixed
2025-11-19T16:06:05.5891094Z -    sqlx::query(
2025-11-19T16:06:05.5891382Z -        "INSERT INTO app_metadata (key, value) VALUES ('comment_schema_fixed_v1', 'true')"
2025-11-19T16:06:05.5891711Z -    )
2025-11-19T16:06:05.5891868Z -    .execute(&mut **tx)
2025-11-19T16:06:05.5892057Z -    .await?;
2025-11-19T16:06:05.5892362Z +    sqlx::query("INSERT INTO app_metadata (key, value) VALUES ('comment_schema_fixed_v1', 'true')")
2025-11-19T16:06:05.5892727Z +        .execute(&mut **tx)
2025-11-19T16:06:05.5892928Z +        .await?;
2025-11-19T16:06:05.5893081Z  
2025-11-19T16:06:05.5893223Z      Ok(())
2025-11-19T16:06:05.5893371Z  }
2025-11-19T16:06:05.5893684Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:33:
2025-11-19T16:06:05.5894044Z  use sqlx::{self, FromRow};
2025-11-19T16:06:05.5894283Z  use std::{env, sync::OnceLock, time::Duration};
2025-11-19T16:06:05.5894514Z  
2025-11-19T16:06:05.5894655Z -
2025-11-19T16:06:05.5894844Z  /// Global salt for hashing login attempt identifiers.
2025-11-19T16:06:05.5895174Z  /// Initialized once at startup via init_login_attempt_salt().
2025-11-19T16:06:05.5895534Z  static LOGIN_ATTEMPT_SALT: OnceLock<String> = OnceLock::new();
2025-11-19T16:06:05.5895948Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:61:
2025-11-19T16:06:05.5896423Z          return Err("LOGIN_ATTEMPT_SALT must be at least 32 characters long".to_string());
2025-11-19T16:06:05.5896745Z      }
2025-11-19T16:06:05.5896906Z  
2025-11-19T16:06:05.5897303Z -    let unique_chars = trimmed.chars().collect::<std::collections::HashSet<_>>().len();
2025-11-19T16:06:05.5897735Z +    let unique_chars = trimmed
2025-11-19T16:06:05.5897939Z +        .chars()
2025-11-19T16:06:05.5898135Z +        .collect::<std::collections::HashSet<_>>()
2025-11-19T16:06:05.5898374Z +        .len();
2025-11-19T16:06:05.5898544Z      if unique_chars < 10 {
2025-11-19T16:06:05.5898884Z          return Err("LOGIN_ATTEMPT_SALT must contain at least 10 unique characters".to_string());
2025-11-19T16:06:05.5899312Z      }
2025-11-19T16:06:05.5899615Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:479:
2025-11-19T16:06:05.5899981Z  ) -> (StatusCode, HeaderMap) {
2025-11-19T16:06:05.5900218Z      // Extract token to blacklist it
2025-11-19T16:06:05.5900501Z      if let Some(token) = auth::extract_token(&headers) {
2025-11-19T16:06:05.5900939Z -        if let Err(e) = repositories::token_blacklist::blacklist_token(&pool, &token, claims.exp as i64).await {
2025-11-19T16:06:05.5901344Z +        if let Err(e) =
2025-11-19T16:06:05.5901685Z +            repositories::token_blacklist::blacklist_token(&pool, &token, claims.exp as i64).await
2025-11-19T16:06:05.5902046Z +        {
2025-11-19T16:06:05.5902285Z              tracing::error!("Failed to blacklist token on logout: {}", e);
2025-11-19T16:06:05.5902571Z          }
2025-11-19T16:06:05.5902717Z      }
2025-11-19T16:06:05.5944215Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:26:
2025-11-19T16:06:05.5944914Z      http::StatusCode,
2025-11-19T16:06:05.5945173Z      Json,
2025-11-19T16:06:05.5945430Z  };
2025-11-19T16:06:05.5945593Z -use std::net::SocketAddr;
2025-11-19T16:06:05.5945816Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.5946040Z +use std::net::SocketAddr;
2025-11-19T16:06:05.5946226Z  
2025-11-19T16:06:05.5946360Z -
2025-11-19T16:06:05.5946515Z  #[derive(Deserialize)]
2025-11-19T16:06:05.5946721Z  pub struct CreateCommentRequest {
2025-11-19T16:06:05.5947000Z      content: String,
2025-11-19T16:06:05.5947340Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:64:
2025-11-19T16:06:05.5947704Z      pub is_admin: bool,
2025-11-19T16:06:05.5947892Z  }
2025-11-19T16:06:05.5948027Z  
2025-11-19T16:06:05.5948168Z -
2025-11-19T16:06:05.5948302Z -
2025-11-19T16:06:05.5948441Z -
2025-11-19T16:06:05.5948749Z -
2025-11-19T16:06:05.5949061Z  fn sanitize_comment_content(raw: &str) -> Result<String, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.5949603Z      let trimmed = raw.trim();
2025-11-19T16:06:05.5949797Z  
2025-11-19T16:06:05.5950102Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:134:
2025-11-19T16:06:05.5950501Z      let limit = params.limit.clamp(1, 200);
2025-11-19T16:06:05.5950766Z      let offset = params.offset.max(0);
2025-11-19T16:06:05.5950987Z  
2025-11-19T16:06:05.5951359Z -    let comments = repositories::comments::list_comments(&pool, &tutorial_id, limit, offset, params.sort.as_deref())
2025-11-19T16:06:05.5951775Z -        .await
2025-11-19T16:06:05.5951960Z -        .map_err(|e| {
2025-11-19T16:06:05.5952181Z -            tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.5952417Z -            (
2025-11-19T16:06:05.5952622Z -                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.5952867Z -                Json(ErrorResponse {
2025-11-19T16:06:05.5953145Z -                    error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.5953392Z -                }),
2025-11-19T16:06:05.5953566Z -            )
2025-11-19T16:06:05.5953723Z -        })?;
2025-11-19T16:06:05.6026715Z +    let comments = repositories::comments::list_comments(
2025-11-19T16:06:05.6027365Z +        &pool,
2025-11-19T16:06:05.6027677Z +        &tutorial_id,
2025-11-19T16:06:05.6027996Z +        limit,
2025-11-19T16:06:05.6028261Z +        offset,
2025-11-19T16:06:05.6028549Z +        params.sort.as_deref(),
2025-11-19T16:06:05.6028837Z +    )
2025-11-19T16:06:05.6029014Z +    .await
2025-11-19T16:06:05.6029192Z +    .map_err(|e| {
2025-11-19T16:06:05.6029945Z +        tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6030308Z +        (
2025-11-19T16:06:05.6030511Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6030778Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6031043Z +                error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6031297Z +            }),
2025-11-19T16:06:05.6031468Z +        )
2025-11-19T16:06:05.6031616Z +    })?;
2025-11-19T16:06:05.6031774Z  
2025-11-19T16:06:05.6032053Z -    let response_comments: Vec<Comment> = comments.into_iter().map(|c| Comment {
2025-11-19T16:06:05.6032388Z -        id: c.id,
2025-11-19T16:06:05.6032583Z -        tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6032807Z -        post_id: c.post_id,
2025-11-19T16:06:05.6033025Z -        author: c.author,
2025-11-19T16:06:05.6033218Z -        content: c.content,
2025-11-19T16:06:05.6033431Z -        created_at: c.created_at,
2025-11-19T16:06:05.6033643Z -        votes: c.votes,
2025-11-19T16:06:05.6033847Z -        is_admin: c.is_admin,
2025-11-19T16:06:05.6034063Z -    }).collect();
2025-11-19T16:06:05.6034287Z +    let response_comments: Vec<Comment> = comments
2025-11-19T16:06:05.6034534Z +        .into_iter()
2025-11-19T16:06:05.6034722Z +        .map(|c| Comment {
2025-11-19T16:06:05.6034929Z +            id: c.id,
2025-11-19T16:06:05.6035119Z +            tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6035359Z +            post_id: c.post_id,
2025-11-19T16:06:05.6035568Z +            author: c.author,
2025-11-19T16:06:05.6035774Z +            content: c.content,
2025-11-19T16:06:05.6035983Z +            created_at: c.created_at,
2025-11-19T16:06:05.6036209Z +            votes: c.votes,
2025-11-19T16:06:05.6036405Z +            is_admin: c.is_admin,
2025-11-19T16:06:05.6036614Z +        })
2025-11-19T16:06:05.6036770Z +        .collect();
2025-11-19T16:06:05.6036944Z  
2025-11-19T16:06:05.6037102Z      Ok(Json(response_comments))
2025-11-19T16:06:05.6037309Z  }
2025-11-19T16:06:05.6037635Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:165:
2025-11-19T16:06:05.6038025Z      Path(tutorial_id): Path<String>,
2025-11-19T16:06:05.6038298Z      Json(payload): Json<CreateCommentRequest>,
2025-11-19T16:06:05.6038618Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6039010Z -    
2025-11-19T16:06:05.6039338Z      if let Err(e) = validate_tutorial_id(&tutorial_id) {
2025-11-19T16:06:05.6039847Z          return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: e })));
2025-11-19T16:06:05.6040163Z      }
2025-11-19T16:06:05.6040478Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:175:
2025-11-19T16:06:05.6040849Z          .await
2025-11-19T16:06:05.6041017Z          .map_err(|e| {
2025-11-19T16:06:05.6041293Z              tracing::error!("Failed to verify tutorial existence: {}", e);
2025-11-19T16:06:05.6041775Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6042185Z +            (
2025-11-19T16:06:05.6042375Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6042630Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6042899Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6043152Z +                }),
2025-11-19T16:06:05.6043336Z +            )
2025-11-19T16:06:05.6043491Z          })?;
2025-11-19T16:06:05.6043647Z  
2025-11-19T16:06:05.6043791Z      if !exists {
2025-11-19T16:06:05.6044123Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:182:
2025-11-19T16:06:05.6044680Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Tutorial not found".to_string() })));
2025-11-19T16:06:05.6045072Z +        return Err((
2025-11-19T16:06:05.6045272Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6045490Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6045820Z +                error: "Tutorial not found".to_string(),
2025-11-19T16:06:05.6046052Z +            }),
2025-11-19T16:06:05.6046223Z +        ));
2025-11-19T16:06:05.6046377Z      }
2025-11-19T16:06:05.6046532Z  
2025-11-19T16:06:05.6046790Z      create_comment_internal(pool, Some(tutorial_id), None, payload, None).await
2025-11-19T16:06:05.6047274Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:195:
2025-11-19T16:06:05.6047634Z          .await
2025-11-19T16:06:05.6047814Z          .map_err(|e| {
2025-11-19T16:06:05.6048082Z              tracing::error!("Failed to verify post existence: {}", e);
2025-11-19T16:06:05.6048542Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to fetch comments".to_string() }))
2025-11-19T16:06:05.6048945Z +            (
2025-11-19T16:06:05.6049129Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6049482Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6049740Z +                    error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6049990Z +                }),
2025-11-19T16:06:05.6050161Z +            )
2025-11-19T16:06:05.6050333Z          })?;
2025-11-19T16:06:05.6050499Z  
2025-11-19T16:06:05.6050652Z      if !exists {
2025-11-19T16:06:05.6050985Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:202:
2025-11-19T16:06:05.6051549Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Post not found".to_string() })));
2025-11-19T16:06:05.6051943Z +        return Err((
2025-11-19T16:06:05.6052134Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6052366Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6052597Z +                error: "Post not found".to_string(),
2025-11-19T16:06:05.6052836Z +            }),
2025-11-19T16:06:05.6053003Z +        ));
2025-11-19T16:06:05.6053153Z      }
2025-11-19T16:06:05.6053307Z  
2025-11-19T16:06:05.6053481Z      let limit = params.limit.clamp(1, 200);
2025-11-19T16:06:05.6053878Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:206:
2025-11-19T16:06:05.6054262Z      let offset = params.offset.max(0);
2025-11-19T16:06:05.6054487Z  
2025-11-19T16:06:05.6054850Z -    let comments = repositories::comments::list_post_comments(&pool, &post_id, limit, offset, params.sort.as_deref())
2025-11-19T16:06:05.6055358Z -        .await
2025-11-19T16:06:05.6055525Z -        .map_err(|e| {
2025-11-19T16:06:05.6055754Z -            tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6056199Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to fetch comments".to_string() }))
2025-11-19T16:06:05.6056597Z -        })?;
2025-11-19T16:06:05.6056837Z +    let comments = repositories::comments::list_post_comments(
2025-11-19T16:06:05.6057103Z +        &pool,
2025-11-19T16:06:05.6057278Z +        &post_id,
2025-11-19T16:06:05.6057443Z +        limit,
2025-11-19T16:06:05.6057612Z +        offset,
2025-11-19T16:06:05.6057793Z +        params.sort.as_deref(),
2025-11-19T16:06:05.6057999Z +    )
2025-11-19T16:06:05.6058143Z +    .await
2025-11-19T16:06:05.6058305Z +    .map_err(|e| {
2025-11-19T16:06:05.6058513Z +        tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6058741Z +        (
2025-11-19T16:06:05.6058931Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6059168Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6059497Z +                error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6059738Z +            }),
2025-11-19T16:06:05.6059905Z +        )
2025-11-19T16:06:05.6060056Z +    })?;
2025-11-19T16:06:05.6060216Z  
2025-11-19T16:06:05.6060473Z -    let response_comments: Vec<Comment> = comments.into_iter().map(|c| Comment {
2025-11-19T16:06:05.6060800Z -        id: c.id,
2025-11-19T16:06:05.6060997Z -        tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6061227Z -        post_id: c.post_id,
2025-11-19T16:06:05.6061445Z -        author: c.author,
2025-11-19T16:06:05.6061712Z -        content: c.content,
2025-11-19T16:06:05.6061933Z -        created_at: c.created_at,
2025-11-19T16:06:05.6062146Z -        votes: c.votes,
2025-11-19T16:06:05.6062345Z -        is_admin: c.is_admin,
2025-11-19T16:06:05.6062543Z -    }).collect();
2025-11-19T16:06:05.6062756Z +    let response_comments: Vec<Comment> = comments
2025-11-19T16:06:05.6063003Z +        .into_iter()
2025-11-19T16:06:05.6063201Z +        .map(|c| Comment {
2025-11-19T16:06:05.6063402Z +            id: c.id,
2025-11-19T16:06:05.6063596Z +            tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6063833Z +            post_id: c.post_id,
2025-11-19T16:06:05.6064044Z +            author: c.author,
2025-11-19T16:06:05.6064259Z +            content: c.content,
2025-11-19T16:06:05.6064468Z +            created_at: c.created_at,
2025-11-19T16:06:05.6064693Z +            votes: c.votes,
2025-11-19T16:06:05.6064889Z +            is_admin: c.is_admin,
2025-11-19T16:06:05.6065093Z +        })
2025-11-19T16:06:05.6065258Z +        .collect();
2025-11-19T16:06:05.6065426Z  
2025-11-19T16:06:05.6065589Z      Ok(Json(response_comments))
2025-11-19T16:06:05.6065787Z  }
2025-11-19T16:06:05.6066097Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:232:
2025-11-19T16:06:05.6066517Z      auth::OptionalClaims(claims): auth::OptionalClaims,
2025-11-19T16:06:05.6066814Z      Json(payload): Json<CreateCommentRequest>,
2025-11-19T16:06:05.6067113Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6067388Z -    
2025-11-19T16:06:05.6067546Z      // Verify post exists
2025-11-19T16:06:05.6067827Z      let exists = repositories::posts::check_post_exists(&pool, &post_id)
2025-11-19T16:06:05.6068121Z          .await
2025-11-19T16:06:05.6068560Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:239:
2025-11-19T16:06:05.6069001Z          .map_err(|e| {
2025-11-19T16:06:05.6069383Z              tracing::error!("Failed to verify post existence: {}", e);
2025-11-19T16:06:05.6069877Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6070269Z +            (
2025-11-19T16:06:05.6070465Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6070816Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6071070Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6071313Z +                }),
2025-11-19T16:06:05.6071476Z +            )
2025-11-19T16:06:05.6071630Z          })?;
2025-11-19T16:06:05.6071783Z  
2025-11-19T16:06:05.6071938Z      if !exists {
2025-11-19T16:06:05.6072258Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:245:
2025-11-19T16:06:05.6072787Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Post not found".to_string() })));
2025-11-19T16:06:05.6073151Z +        return Err((
2025-11-19T16:06:05.6073334Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6073554Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6073784Z +                error: "Post not found".to_string(),
2025-11-19T16:06:05.6074011Z +            }),
2025-11-19T16:06:05.6074162Z +        ));
2025-11-19T16:06:05.6074312Z      }
2025-11-19T16:06:05.6074452Z  
2025-11-19T16:06:05.6074712Z      create_comment_internal(pool, None, Some(post_id), payload, claims).await
2025-11-19T16:06:05.6075174Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:256:
2025-11-19T16:06:05.6075559Z      claims: Option<auth::Claims>,
2025-11-19T16:06:05.6075846Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6076200Z      let comment_content = sanitize_comment_content(&payload.content)?;
2025-11-19T16:06:05.6076489Z -    
2025-11-19T16:06:05.6076632Z +
2025-11-19T16:06:05.6076807Z      let author = if let Some(ref c) = claims {
2025-11-19T16:06:05.6077034Z          c.sub.clone()
2025-11-19T16:06:05.6077213Z      } else {
2025-11-19T16:06:05.6077590Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:265:
2025-11-19T16:06:05.6077963Z              Some(name) => {
2025-11-19T16:06:05.6078180Z                  let trimmed = name.trim();
2025-11-19T16:06:05.6078433Z                  if trimmed.len() < 2 || trimmed.len() > 50 {
2025-11-19T16:06:05.6078920Z -                    return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: "Name must be between 2 and 50 characters".to_string() })));
2025-11-19T16:06:05.6079529Z +                    return Err((
2025-11-19T16:06:05.6079780Z +                        StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6080021Z +                        Json(ErrorResponse {
2025-11-19T16:06:05.6080326Z +                            error: "Name must be between 2 and 50 characters".to_string(),
2025-11-19T16:06:05.6080613Z +                        }),
2025-11-19T16:06:05.6080801Z +                    ));
2025-11-19T16:06:05.6080988Z                  }
2025-11-19T16:06:05.6081165Z                  trimmed.to_string()
2025-11-19T16:06:05.6081376Z -            },
2025-11-19T16:06:05.6081778Z -            None => return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: "Name is required for guest comments".to_string() })))
2025-11-19T16:06:05.6082217Z +            }
2025-11-19T16:06:05.6082373Z +            None => {
2025-11-19T16:06:05.6082556Z +                return Err((
2025-11-19T16:06:05.6082763Z +                    StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6083004Z +                    Json(ErrorResponse {
2025-11-19T16:06:05.6083289Z +                        error: "Name is required for guest comments".to_string(),
2025-11-19T16:06:05.6083554Z +                    }),
2025-11-19T16:06:05.6083735Z +                ))
2025-11-19T16:06:05.6083895Z +            }
2025-11-19T16:06:05.6084052Z          }
2025-11-19T16:06:05.6084196Z      };
2025-11-19T16:06:05.6084344Z  
2025-11-19T16:06:05.6084638Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:278:
2025-11-19T16:06:05.6085007Z          .await
2025-11-19T16:06:05.6085169Z          .map_err(|e| {
2025-11-19T16:06:05.6085435Z              tracing::error!("Database error checking rate limit: {}", e);
2025-11-19T16:06:05.6085913Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6086397Z +            (
2025-11-19T16:06:05.6086591Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6086834Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6087100Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6087342Z +                }),
2025-11-19T16:06:05.6087522Z +            )
2025-11-19T16:06:05.6087685Z          })?;
2025-11-19T16:06:05.6087837Z  
2025-11-19T16:06:05.6088030Z      if let Some(created_at_str) = last_comment_time {
2025-11-19T16:06:05.6088427Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:289:
2025-11-19T16:06:05.6088808Z                  return Err((
2025-11-19T16:06:05.6089033Z                      StatusCode::TOO_MANY_REQUESTS,
2025-11-19T16:06:05.6089365Z                      Json(ErrorResponse {
2025-11-19T16:06:05.6089931Z -                        error: format!("Please wait {} seconds before posting another comment", 60 - diff.num_seconds()),
2025-11-19T16:06:05.6090318Z +                        error: format!(
2025-11-19T16:06:05.6090606Z +                            "Please wait {} seconds before posting another comment",
2025-11-19T16:06:05.6090894Z +                            60 - diff.num_seconds()
2025-11-19T16:06:05.6091124Z +                        ),
2025-11-19T16:06:05.6091304Z                      }),
2025-11-19T16:06:05.6091482Z                  ));
2025-11-19T16:06:05.6091640Z              }
2025-11-19T16:06:05.6091958Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:319:
2025-11-19T16:06:05.6092314Z      .await
2025-11-19T16:06:05.6092469Z      .map_err(|e| {
2025-11-19T16:06:05.6092751Z          tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6093180Z -        (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6093581Z +        (
2025-11-19T16:06:05.6093762Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6094007Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6094251Z +                error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6094496Z +            }),
2025-11-19T16:06:05.6094653Z +        )
2025-11-19T16:06:05.6094811Z      })?;
2025-11-19T16:06:05.6094957Z  
2025-11-19T16:06:05.6095124Z      let response_comment = Comment {
2025-11-19T16:06:05.6095501Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:439:
2025-11-19T16:06:05.6095856Z      }
2025-11-19T16:06:05.6096013Z  
2025-11-19T16:06:05.6096171Z      // Determine voter ID
2025-11-19T16:06:05.6096384Z -    let voter_id = claims.sub; 
2025-11-19T16:06:05.6096599Z +    let voter_id = claims.sub;
2025-11-19T16:06:05.6096795Z  
2025-11-19T16:06:05.6096944Z      // Check if already voted
2025-11-19T16:06:05.6097272Z      let has_voted = repositories::comments::check_vote_exists(&pool, &id, &voter_id)
2025-11-19T16:06:05.6097872Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:1:
2025-11-19T16:06:05.6098253Z +use crate::db;
2025-11-19T16:06:05.6098429Z  use axum::{
2025-11-19T16:06:05.6098596Z      extract::State,
2025-11-19T16:06:05.6098799Z      response::{Html, IntoResponse},
2025-11-19T16:06:05.6099188Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:4:
2025-11-19T16:06:05.6099639Z  };
2025-11-19T16:06:05.6099799Z  use reqwest::Client;
2025-11-19T16:06:05.6099992Z  use std::env;
2025-11-19T16:06:05.6100172Z -use crate::db;
2025-11-19T16:06:05.6100333Z  
2025-11-19T16:06:05.6100525Z  // Default frontend URL (internal Docker network)
2025-11-19T16:06:05.6100846Z  const DEFAULT_FRONTEND_URL: &str = "http://frontend";
2025-11-19T16:06:05.6101283Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:11:
2025-11-19T16:06:05.6101653Z  
2025-11-19T16:06:05.6101927Z  pub async fn serve_index(State(pool): State<db::DbPool>) -> impl IntoResponse {
2025-11-19T16:06:05.6102468Z -    let frontend_url = env::var("FRONTEND_URL").unwrap_or_else(|_| DEFAULT_FRONTEND_URL.to_string());
2025-11-19T16:06:05.6102841Z +    let frontend_url =
2025-11-19T16:06:05.6103130Z +        env::var("FRONTEND_URL").unwrap_or_else(|_| DEFAULT_FRONTEND_URL.to_string());
2025-11-19T16:06:05.6103486Z      let index_url = format!("{}/index.html", frontend_url);
2025-11-19T16:06:05.6103749Z  
2025-11-19T16:06:05.6103926Z      // Fetch index.html from frontend container
2025-11-19T16:06:05.6104345Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:20:
2025-11-19T16:06:05.6104737Z              Ok(text) => text,
2025-11-19T16:06:05.6104958Z              Err(e) => {
2025-11-19T16:06:05.6105207Z                  tracing::error!("Failed to read index.html body: {}", e);
2025-11-19T16:06:05.6105687Z -                return Html("<h1>Internal Server Error</h1><p>Failed to load application.</p>".to_string()).into_response();
2025-11-19T16:06:05.6106095Z +                return Html(
2025-11-19T16:06:05.6106403Z +                    "<h1>Internal Server Error</h1><p>Failed to load application.</p>".to_string(),
2025-11-19T16:06:05.6106731Z +                )
2025-11-19T16:06:05.6106908Z +                .into_response();
2025-11-19T16:06:05.6107117Z              }
2025-11-19T16:06:05.6107273Z          },
2025-11-19T16:06:05.6107441Z          Err(e) => {
2025-11-19T16:06:05.6107800Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:27:
2025-11-19T16:06:05.6108276Z              tracing::error!("Failed to fetch index.html from {}: {}", index_url, e);
2025-11-19T16:06:05.6108858Z -            return Html("<h1>Internal Server Error</h1><p>Failed to connect to frontend service.</p>".to_string()).into_response();
2025-11-19T16:06:05.6109351Z +            return Html(
2025-11-19T16:06:05.6109745Z +                "<h1>Internal Server Error</h1><p>Failed to connect to frontend service.</p>"
2025-11-19T16:06:05.6110072Z +                    .to_string(),
2025-11-19T16:06:05.6110285Z +            )
2025-11-19T16:06:05.6110475Z +            .into_response();
2025-11-19T16:06:05.6110671Z          }
2025-11-19T16:06:05.6110838Z      };
2025-11-19T16:06:05.6110994Z  
2025-11-19T16:06:05.6111333Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:32:
2025-11-19T16:06:05.6111733Z      // Fetch site meta from DB
2025-11-19T16:06:05.6112149Z -    let site_meta = match crate::repositories::content::fetch_site_content_by_section(&pool, "site_meta").await {
2025-11-19T16:06:05.6112559Z -        Ok(Some(record)) => {
2025-11-19T16:06:05.6112882Z -            match serde_json::from_str::<serde_json::Value>(&record.content_json) {
2025-11-19T16:06:05.6113229Z -                Ok(json) => json,
2025-11-19T16:06:05.6113464Z -                Err(_) => serde_json::json!({}),
2025-11-19T16:06:05.6113714Z +    let site_meta =
2025-11-19T16:06:05.6114048Z +        match crate::repositories::content::fetch_site_content_by_section(&pool, "site_meta").await
2025-11-19T16:06:05.6114419Z +        {
2025-11-19T16:06:05.6114593Z +            Ok(Some(record)) => {
2025-11-19T16:06:05.6114916Z +                match serde_json::from_str::<serde_json::Value>(&record.content_json) {
2025-11-19T16:06:05.6115238Z +                    Ok(json) => json,
2025-11-19T16:06:05.6115493Z +                    Err(_) => serde_json::json!({}),
2025-11-19T16:06:05.6115741Z +                }
2025-11-19T16:06:05.6115898Z              }
2025-11-19T16:06:05.6116065Z -        },
2025-11-19T16:06:05.6116238Z -        _ => serde_json::json!({}),
2025-11-19T16:06:05.6116454Z -    };
2025-11-19T16:06:05.6116632Z +            _ => serde_json::json!({}),
2025-11-19T16:06:05.6116852Z +        };
2025-11-19T16:06:05.6116999Z  
2025-11-19T16:06:05.6117172Z -    let title = site_meta.get("title")
2025-11-19T16:06:05.6117400Z +    let title = site_meta
2025-11-19T16:06:05.6117598Z +        .get("title")
2025-11-19T16:06:05.6117876Z          .and_then(|v| v.as_str())
2025-11-19T16:06:05.6118409Z          .unwrap_or("Linux Tutorial - Lerne Linux Schritt für Schritt");
2025-11-19T16:06:05.6118692Z -    
2025-11-19T16:06:05.6118891Z -    let description = site_meta.get("description")
2025-11-19T16:06:05.6119145Z +
2025-11-19T16:06:05.6119461Z +    let description = site_meta
2025-11-19T16:06:05.6119716Z +        .get("description")
2025-11-19T16:06:05.6119917Z          .and_then(|v| v.as_str())
2025-11-19T16:06:05.6120231Z          .unwrap_or("Lerne Linux von Grund auf - Interaktiv, modern und praxisnah.");
2025-11-19T16:06:05.6120533Z  
2025-11-19T16:06:05.6120860Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:58:
2025-11-19T16:06:05.6121261Z      // Replace Title
2025-11-19T16:06:05.6121472Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6121867Z          "<title>Linux Tutorial - Lerne Linux Schritt für Schritt</title>",
2025-11-19T16:06:05.6122187Z -        &format!("<title>{}</title>", safe_title)
2025-11-19T16:06:05.6122465Z +        &format!("<title>{}</title>", safe_title),
2025-11-19T16:06:05.6122686Z      );
2025-11-19T16:06:05.6122840Z  
2025-11-19T16:06:05.6122999Z      // Replace Meta Description
2025-11-19T16:06:05.6123390Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:65:
2025-11-19T16:06:05.6123904Z -    // Note: This regex-like replacement is brittle if the HTML formatting changes. 
2025-11-19T16:06:05.6124336Z +    // Note: This regex-like replacement is brittle if the HTML formatting changes.
2025-11-19T16:06:05.6124802Z      // For now, we assume the exact string from index.html or use a more robust regex if needed.
2025-11-19T16:06:05.6125389Z      // Since we don't have regex crate here yet, we'll try to replace the known default description.
2025-11-19T16:06:05.6125918Z      // If it's dynamic, we might need a more robust approach, but for now let's try replacing the known default.
2025-11-19T16:06:05.6126475Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:69:
2025-11-19T16:06:05.6127469Z      let default_desc = "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah. Umfassende Tutorials für Einsteiger und Fortgeschrittene.";
2025-11-19T16:06:05.6127993Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6128247Z          &format!("content=\"{}\"", default_desc),
2025-11-19T16:06:05.6128515Z -        &format!("content=\"{}\"", safe_description)
2025-11-19T16:06:05.6128779Z +        &format!("content=\"{}\"", safe_description),
2025-11-19T16:06:05.6129018Z      );
2025-11-19T16:06:05.6129177Z  
2025-11-19T16:06:05.6129845Z -    // Also replace OG tags if possible. 
2025-11-19T16:06:05.6130108Z +    // Also replace OG tags if possible.
2025-11-19T16:06:05.6130421Z      // A better approach for robust replacement without full HTML parsing:
2025-11-19T16:06:05.6130883Z      // We can replace the whole <head> block or specific known lines if we are sure about the structure.
2025-11-19T16:06:05.6131338Z      // Given the index.html structure, we can try to replace specific lines.
2025-11-19T16:06:05.6131827Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:79:
2025-11-19T16:06:05.6132211Z -    
2025-11-19T16:06:05.6132354Z +
2025-11-19T16:06:05.6132517Z      // Replace OG Title
2025-11-19T16:06:05.6132731Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6133103Z          "content=\"Linux Tutorial - Lerne Linux Schritt für Schritt\"",
2025-11-19T16:06:05.6133554Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:83:
2025-11-19T16:06:05.6133959Z -        &format!("content=\"{}\"", safe_title)
2025-11-19T16:06:05.6134206Z +        &format!("content=\"{}\"", safe_title),
2025-11-19T16:06:05.6134438Z      );
2025-11-19T16:06:05.6134583Z  
2025-11-19T16:06:05.6134927Z      // Replace OG Description (reusing the description replacement above might handle this if content matches)
2025-11-19T16:06:05.6135616Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:88:
2025-11-19T16:06:05.6136117Z      let default_og_desc = "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah.";
2025-11-19T16:06:05.6136480Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6136757Z          &format!("content=\"{}\"", default_og_desc),
2025-11-19T16:06:05.6137041Z -        &format!("content=\"{}\"", safe_description)
2025-11-19T16:06:05.6137318Z +        &format!("content=\"{}\"", safe_description),
2025-11-19T16:06:05.6137571Z      );
2025-11-19T16:06:05.6137726Z  
2025-11-19T16:06:05.6137911Z      Html(injected_html).into_response()
2025-11-19T16:06:05.6138272Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:1:
2025-11-19T16:06:05.6138602Z -
2025-11-19T16:06:05.6138749Z -
2025-11-19T16:06:05.6138889Z  /**
2025-11-19T16:06:05.6139057Z   * HTTP Handlers Module
2025-11-19T16:06:05.6139505Z   *
2025-11-19T16:06:05.6139801Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:140:
2025-11-19T16:06:05.6140170Z   * - Caching headers for static content
2025-11-19T16:06:05.6140424Z   * - Async/await for high concurrency
2025-11-19T16:06:05.6140633Z   */
2025-11-19T16:06:05.6140781Z -
2025-11-19T16:06:05.6140971Z  // HTTP Handler Modules - Organized by Domain
2025-11-19T16:06:05.6141194Z  
2025-11-19T16:06:05.6141363Z  // Core System Handlers
2025-11-19T16:06:05.6141693Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:147:
2025-11-19T16:06:05.6142112Z -pub mod auth;      // Authentication and authorization
2025-11-19T16:06:05.6142425Z -pub mod search;    // Full-text search functionality
2025-11-19T16:06:05.6142866Z +pub mod auth; // Authentication and authorization
2025-11-19T16:06:05.6143153Z +pub mod search; // Full-text search functionality
2025-11-19T16:06:05.6143401Z  
2025-11-19T16:06:05.6143564Z  // Content Management Handlers
2025-11-19T16:06:05.6143784Z  pub mod tutorials;
2025-11-19T16:06:05.6144102Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:152:
2025-11-19T16:06:05.6144452Z  pub mod upload;
2025-11-19T16:06:05.6144653Z -    // Tutorial CRUD operations
2025-11-19T16:06:05.6144898Z -pub mod comments;     // Comment system management
2025-11-19T16:06:05.6145175Z +// Tutorial CRUD operations
2025-11-19T16:06:05.6145411Z +pub mod comments; // Comment system management
2025-11-19T16:06:05.6145655Z  
2025-11-19T16:06:05.6145816Z  // Site Content Handlers
2025-11-19T16:06:05.6146031Z +pub mod frontend_proxy;
2025-11-19T16:06:05.6146276Z  pub mod site_content; // Dynamic site content sections
2025-11-19T16:06:05.6146574Z -pub mod site_pages;   // Static page management
2025-11-19T16:06:05.6146854Z -pub mod site_posts;   // Blog post management
2025-11-19T16:06:05.6147180Z -pub mod frontend_proxy; // Frontend proxy for server-side injection
2025-11-19T16:06:05.6147515Z +pub mod site_pages; // Static page management
2025-11-19T16:06:05.6147889Z +pub mod site_posts; // Blog post management // Frontend proxy for server-side injection
2025-11-19T16:06:05.6148233Z  
2025-11-19T16:06:05.6148524Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/search.rs:57:
2025-11-19T16:06:05.6148927Z              // Keep only safe characters for FTS5 queries
2025-11-19T16:06:05.6149442Z              let sanitized: String = token
2025-11-19T16:06:05.6149709Z                  .chars()
2025-11-19T16:06:05.6150078Z -                .filter(|c| c.is_ascii_alphanumeric() || matches!(c, '*' | '-' | '_' | '.' | '+' | '#' | '@' | '/' | ':' | '(' | ')' | '[' | ']'))
2025-11-19T16:06:05.6150454Z +                .filter(|c| {
2025-11-19T16:06:05.6150705Z +                    c.is_ascii_alphanumeric()
2025-11-19T16:06:05.6150950Z +                        || matches!(
2025-11-19T16:06:05.6151188Z +                            c,
2025-11-19T16:06:05.6151398Z +                            '*' | '-'
2025-11-19T16:06:05.6151642Z +                                | '_'
2025-11-19T16:06:05.6151980Z +                                | '.'
2025-11-19T16:06:05.6152187Z +                                | '+'
2025-11-19T16:06:05.6152402Z +                                | '#'
2025-11-19T16:06:05.6152610Z +                                | '@'
2025-11-19T16:06:05.6152833Z +                                | '/'
2025-11-19T16:06:05.6153041Z +                                | ':'
2025-11-19T16:06:05.6153271Z +                                | '('
2025-11-19T16:06:05.6153482Z +                                | ')'
2025-11-19T16:06:05.6153698Z +                                | '['
2025-11-19T16:06:05.6153911Z +                                | ']'
2025-11-19T16:06:05.6154119Z +                        )
2025-11-19T16:06:05.6154325Z +                })
2025-11-19T16:06:05.6154500Z                  .collect();
2025-11-19T16:06:05.6154725Z              if sanitized.is_empty() {
2025-11-19T16:06:05.6154939Z                  None
2025-11-19T16:06:05.6155273Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/search.rs:104:
2025-11-19T16:06:05.6155655Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6155897Z      Query(params): Query<SearchQuery>,
2025-11-19T16:06:05.6156223Z  ) -> Result<Json<Vec<TutorialResponse>>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6156552Z -
2025-11-19T16:06:05.6156729Z      if params.q.trim().is_empty() {
2025-11-19T16:06:05.6156948Z          return Err((
2025-11-19T16:06:05.6157196Z              StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6157563Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:1:
2025-11-19T16:06:05.6157940Z -
2025-11-19T16:06:05.6158082Z -
2025-11-19T16:06:05.6158249Z  use crate::{
2025-11-19T16:06:05.6158503Z -    auth, db, repositories,
2025-11-19T16:06:05.6158716Z +    auth, db,
2025-11-19T16:06:05.6158879Z      models::{
2025-11-19T16:06:05.6159338Z          ErrorResponse, SiteContentListResponse, SiteContentResponse, UpdateSiteContentRequest,
2025-11-19T16:06:05.6159733Z      },
2025-11-19T16:06:05.6160046Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:8:
2025-11-19T16:06:05.6160437Z +    repositories,
2025-11-19T16:06:05.6160602Z  };
2025-11-19T16:06:05.6160762Z  use axum::{
2025-11-19T16:06:05.6160939Z      extract::{Path, State},
2025-11-19T16:06:05.6161313Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:164:
2025-11-19T16:06:05.6161708Z  pub async fn list_site_content(
2025-11-19T16:06:05.6161943Z      State(pool): State<db::DbPool>,
2025-11-19T16:06:05.6162288Z  ) -> Result<Json<SiteContentListResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6162761Z -    let records = repositories::content::fetch_all_site_content(&pool).await.map_err(|err| {
2025-11-19T16:06:05.6163183Z -        tracing::error!("Failed to load site content: {}", err);
2025-11-19T16:06:05.6163441Z -        (
2025-11-19T16:06:05.6163632Z -            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6163878Z -            Json(ErrorResponse {
2025-11-19T16:06:05.6164142Z -                error: "Failed to load site content".to_string(),
2025-11-19T16:06:05.6164399Z -            }),
2025-11-19T16:06:05.6164560Z -        )
2025-11-19T16:06:05.6164714Z -    })?;
2025-11-19T16:06:05.6164955Z +    let records = repositories::content::fetch_all_site_content(&pool)
2025-11-19T16:06:05.6165249Z +        .await
2025-11-19T16:06:05.6165413Z +        .map_err(|err| {
2025-11-19T16:06:05.6165662Z +            tracing::error!("Failed to load site content: {}", err);
2025-11-19T16:06:05.6165919Z +            (
2025-11-19T16:06:05.6166114Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6166359Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6166617Z +                    error: "Failed to load site content".to_string(),
2025-11-19T16:06:05.6166865Z +                }),
2025-11-19T16:06:05.6167029Z +            )
2025-11-19T16:06:05.6167191Z +        })?;
2025-11-19T16:06:05.6167414Z  
2025-11-19T16:06:05.6167617Z      let mut items = Vec::with_capacity(records.len());
2025-11-19T16:06:05.6167871Z      for record in records {
2025-11-19T16:06:05.6168228Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_pages.rs:1:
2025-11-19T16:06:05.6168586Z -
2025-11-19T16:06:05.6168736Z -
2025-11-19T16:06:05.6168878Z  use crate::{
2025-11-19T16:06:05.6169058Z -    auth, db, repositories,
2025-11-19T16:06:05.6169342Z +    auth, db,
2025-11-19T16:06:05.6169501Z      models::{
2025-11-19T16:06:05.6169913Z          CreateSitePageRequest, ErrorResponse, NavigationItemResponse, NavigationResponse,
2025-11-19T16:06:05.6170911Z          SitePageListResponse, SitePageResponse, SitePageWithPostsResponse, SitePostDetailResponse,
2025-11-19T16:06:05.6171592Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_pages.rs:8:
2025-11-19T16:06:05.6171995Z          SitePostResponse, UpdateSitePageRequest,
2025-11-19T16:06:05.6172243Z      },
2025-11-19T16:06:05.6172403Z +    repositories,
2025-11-19T16:06:05.6172579Z  };
2025-11-19T16:06:05.6172736Z  use axum::{
2025-11-19T16:06:05.6172912Z      extract::{Path, State},
2025-11-19T16:06:05.6173272Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_posts.rs:1:
2025-11-19T16:06:05.6173631Z -
2025-11-19T16:06:05.6173784Z -
2025-11-19T16:06:05.6173932Z  use crate::{
2025-11-19T16:06:05.6174121Z -    auth, db, repositories,
2025-11-19T16:06:05.6174315Z +    auth, db,
2025-11-19T16:06:05.6174484Z      models::{
2025-11-19T16:06:05.6174783Z          CreateSitePostRequest, ErrorResponse, SitePostListResponse, SitePostResponse,
2025-11-19T16:06:05.6175157Z          UpdateSitePostRequest,
2025-11-19T16:06:05.6175639Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_posts.rs:8:
2025-11-19T16:06:05.6175997Z      },
2025-11-19T16:06:05.6176157Z +    repositories,
2025-11-19T16:06:05.6176323Z  };
2025-11-19T16:06:05.6176480Z  use axum::{
2025-11-19T16:06:05.6176656Z      extract::{Path, State},
2025-11-19T16:06:05.6177062Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:43:
2025-11-19T16:06:05.6177425Z      }
2025-11-19T16:06:05.6177571Z  
2025-11-19T16:06:05.6177790Z      // Ensure only safe characters for database and URL usage
2025-11-19T16:06:05.6178334Z -    if !id.chars().all(|c| c.is_alphanumeric() || c == '-' || c == '_' || c == '.') {
2025-11-19T16:06:05.6178670Z +    if !id
2025-11-19T16:06:05.6178829Z +        .chars()
2025-11-19T16:06:05.6179171Z +        .all(|c| c.is_alphanumeric() || c == '-' || c == '_' || c == '.')
2025-11-19T16:06:05.6179527Z +    {
2025-11-19T16:06:05.6179762Z          return Err("Tutorial ID contains invalid characters".to_string());
2025-11-19T16:06:05.6180170Z      }
2025-11-19T16:06:05.6180317Z      Ok(())
2025-11-19T16:06:05.6180687Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:76:
2025-11-19T16:06:05.6181222Z  
2025-11-19T16:06:05.6181452Z  pub(crate) fn validate_icon(icon: &str) -> Result<(), String> {
2025-11-19T16:06:05.6181825Z      const ALLOWED_ICONS: &[&str] = &[
2025-11-19T16:06:05.6182195Z -        "Terminal",    // Command line and shell tutorials
2025-11-19T16:06:05.6182597Z -        "FolderTree",  // File system and directory tutorials
2025-11-19T16:06:05.6183068Z -        "FileText",    // Text editing and file manipulation
2025-11-19T16:06:05.6183605Z -        "Settings",    // System configuration and settings
2025-11-19T16:06:05.6184033Z -        "Shield",      // Security and permissions
2025-11-19T16:06:05.6184407Z -        "Network",     // Networking and connectivity
2025-11-19T16:06:05.6184765Z -        "Database",    // Database and data management
2025-11-19T16:06:05.6185209Z -        "Server",      // Server administration and services
2025-11-19T16:06:05.6185509Z +        "Terminal",   // Command line and shell tutorials
2025-11-19T16:06:05.6185815Z +        "FolderTree", // File system and directory tutorials
2025-11-19T16:06:05.6186247Z +        "FileText",   // Text editing and file manipulation
2025-11-19T16:06:05.6186540Z +        "Settings",   // System configuration and settings
2025-11-19T16:06:05.6186820Z +        "Shield",     // Security and permissions
2025-11-19T16:06:05.6187085Z +        "Network",    // Networking and connectivity
2025-11-19T16:06:05.6187359Z +        "Database",   // Database and data management
2025-11-19T16:06:05.6187636Z +        "Server",     // Server administration and services
2025-11-19T16:06:05.6187881Z      ];
2025-11-19T16:06:05.6188027Z  
2025-11-19T16:06:05.6188206Z      if ALLOWED_ICONS.contains(&icon) {
2025-11-19T16:06:05.6188594Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:182:
2025-11-19T16:06:05.6188968Z  
2025-11-19T16:06:05.6189131Z  #[derive(Deserialize)]
2025-11-19T16:06:05.6189439Z  pub struct TutorialListQuery {
2025-11-19T16:06:05.6189662Z -
2025-11-19T16:06:05.6189842Z      #[serde(default = "default_tutorial_limit")]
2025-11-19T16:06:05.6189926Z      limit: i64,
2025-11-19T16:06:05.6189988Z  
2025-11-19T16:06:05.6190216Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:235:
2025-11-19T16:06:05.6190303Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6190393Z      Path(id): Path<String>,
2025-11-19T16:06:05.6190561Z  ) -> Result<Json<TutorialResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6190632Z -
2025-11-19T16:06:05.6190742Z      if let Err(e) = validate_tutorial_id(&id) {
2025-11-19T16:06:05.6190931Z          return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: e })));
2025-11-19T16:06:05.6190995Z      }
2025-11-19T16:06:05.6191296Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:279:
2025-11-19T16:06:05.6191381Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6191488Z      Json(payload): Json<CreateTutorialRequest>,
2025-11-19T16:06:05.6191648Z  ) -> Result<Json<TutorialResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6191727Z -
2025-11-19T16:06:05.6191823Z      if claims.role != "admin" {
2025-11-19T16:06:05.6191894Z          return Err((
2025-11-19T16:06:05.6191991Z              StatusCode::FORBIDDEN,
2025-11-19T16:06:05.6192214Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:321:
2025-11-19T16:06:05.6192288Z                      }),
2025-11-19T16:06:05.6192358Z                  )
2025-11-19T16:06:05.6192444Z              })?;
2025-11-19T16:06:05.6192512Z -        
2025-11-19T16:06:05.6192581Z +
2025-11-19T16:06:05.6192657Z          if exists {
2025-11-19T16:06:05.6192735Z -             return Err((
2025-11-19T16:06:05.6192810Z +            return Err((
2025-11-19T16:06:05.6192905Z                  StatusCode::CONFLICT,
2025-11-19T16:06:05.6192999Z                  Json(ErrorResponse {
2025-11-19T16:06:05.6193147Z                      error: "Tutorial ID already exists".to_string(),
2025-11-19T16:06:05.6193459Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:599:
2025-11-19T16:06:05.6193591Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6193701Z      Path(id): Path<String>,
2025-11-19T16:06:05.6193884Z  ) -> Result<StatusCode, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6193967Z -
2025-11-19T16:06:05.6194090Z      if claims.role != "admin" {
2025-11-19T16:06:05.6194191Z          return Err((
2025-11-19T16:06:05.6194324Z              StatusCode::FORBIDDEN,
2025-11-19T16:06:05.6194723Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:1:
2025-11-19T16:06:05.6194788Z -
2025-11-19T16:06:05.6194873Z  use crate::{
2025-11-19T16:06:05.6194939Z      auth,
2025-11-19T16:06:05.6195045Z      models::{ErrorResponse, UploadResponse},
2025-11-19T16:06:05.6195260Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:38:
2025-11-19T16:06:05.6195340Z          )
2025-11-19T16:06:05.6195402Z      })? {
2025-11-19T16:06:05.6195518Z          let name = field.name().unwrap_or("").to_string();
2025-11-19T16:06:05.6195688Z -        
2025-11-19T16:06:05.6195751Z +
2025-11-19T16:06:05.6195829Z          if name == "file" {
2025-11-19T16:06:05.6195981Z              let file_name = field.file_name().unwrap_or("unknown").to_string();
2025-11-19T16:06:05.6196055Z -            
2025-11-19T16:06:05.6196114Z +
2025-11-19T16:06:05.6196202Z              // Simple extension validation
2025-11-19T16:06:05.6196343Z              let ext = std::path::Path::new(&file_name)
2025-11-19T16:06:05.6196450Z                  .extension()
2025-11-19T16:06:05.6196801Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:83:
2025-11-19T16:06:05.6196872Z  
2025-11-19T16:06:05.6197014Z                  // Verify the detected extension matches our allowed list
2025-11-19T16:06:05.6197133Z                  if !ALLOWED_EXTENSIONS.contains(&detected_ext) {
2025-11-19T16:06:05.6197211Z -                     return Err((
2025-11-19T16:06:05.6197294Z +                    return Err((
2025-11-19T16:06:05.6197394Z                          StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6197481Z                          Json(ErrorResponse {
2025-11-19T16:06:05.6197670Z -                            error: format!("File type '{}' not allowed. Detected: {}", detected_ext, mime),
2025-11-19T16:06:05.6197754Z +                            error: format!(
2025-11-19T16:06:05.6197863Z +                                "File type '{}' not allowed. Detected: {}",
2025-11-19T16:06:05.6197948Z +                                detected_ext, mime
2025-11-19T16:06:05.6198030Z +                            ),
2025-11-19T16:06:05.6198099Z                          }),
2025-11-19T16:06:05.6198166Z                      ));
2025-11-19T16:06:05.6198243Z                  }
2025-11-19T16:06:05.6198515Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:93:
2025-11-19T16:06:05.6198580Z  
2025-11-19T16:06:05.6198781Z                  // Verify the detected extension matches the file extension (prevent spoofing)
2025-11-19T16:06:05.6198976Z                  // Note: infer might return "jpeg" for "jpg", so we need to be flexible or normalize
2025-11-19T16:06:05.6199174Z -                let normalized_detected = if detected_ext == "jpeg" { "jpg" } else { detected_ext };
2025-11-19T16:06:05.6199384Z +                let normalized_detected = if detected_ext == "jpeg" {
2025-11-19T16:06:05.6199466Z +                    "jpg"
2025-11-19T16:06:05.6199545Z +                } else {
2025-11-19T16:06:05.6199627Z +                    detected_ext
2025-11-19T16:06:05.6199710Z +                };
2025-11-19T16:06:05.6199865Z                  let normalized_ext = if ext == "jpeg" { "jpg" } else { ext.as_str() };
2025-11-19T16:06:05.6199928Z  
2025-11-19T16:06:05.6200040Z                  if normalized_detected != normalized_ext {
2025-11-19T16:06:05.6200274Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:100:
2025-11-19T16:06:05.6200356Z -                     return Err((
2025-11-19T16:06:05.6200438Z +                    return Err((
2025-11-19T16:06:05.6200557Z                          StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6200647Z                          Json(ErrorResponse {
2025-11-19T16:06:05.6200883Z -                            error: format!("File extension mismatch. Expected '{}', but detected '{}'", ext, detected_ext),
2025-11-19T16:06:05.6200981Z +                            error: format!(
2025-11-19T16:06:05.6201131Z +                                "File extension mismatch. Expected '{}', but detected '{}'",
2025-11-19T16:06:05.6201226Z +                                ext, detected_ext
2025-11-19T16:06:05.6201314Z +                            ),
2025-11-19T16:06:05.6201387Z                          }),
2025-11-19T16:06:05.6201460Z                      ));
2025-11-19T16:06:05.6201532Z                  }
2025-11-19T16:06:05.6201761Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:107:
2025-11-19T16:06:05.6201838Z              } else {
2025-11-19T16:06:05.6202006Z -                 return Err((
2025-11-19T16:06:05.6202091Z +                return Err((
2025-11-19T16:06:05.6202184Z                      StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6202275Z                      Json(ErrorResponse {
2025-11-19T16:06:05.6202396Z                          error: "Could not determine file type".to_string(),
2025-11-19T16:06:05.6202671Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:116:
2025-11-19T16:06:05.6202859Z              let new_filename = format!("{}.{}", Uuid::new_v4(), ext);
2025-11-19T16:06:05.6203086Z              let upload_dir = std::env::var("UPLOAD_DIR").unwrap_or_else(|_| "uploads".to_string());
2025-11-19T16:06:05.6203224Z              let mut upload_path = PathBuf::from(upload_dir);
2025-11-19T16:06:05.6203290Z -            
2025-11-19T16:06:05.6203353Z +
2025-11-19T16:06:05.6203460Z              // Ensure uploads directory exists
2025-11-19T16:06:05.6203548Z              if !upload_path.exists() {
2025-11-19T16:06:05.6203679Z                  fs::create_dir_all(&upload_path).await.map_err(|err| {
2025-11-19T16:06:05.6203903Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:128:
2025-11-19T16:06:05.6203970Z                      )
2025-11-19T16:06:05.6204035Z                  })?;
2025-11-19T16:06:05.6204099Z              }
2025-11-19T16:06:05.6204180Z -            
2025-11-19T16:06:05.6204239Z +
2025-11-19T16:06:05.6204330Z              upload_path.push(&new_filename);
2025-11-19T16:06:05.6204392Z  
2025-11-19T16:06:05.6204524Z              fs::write(&upload_path, data).await.map_err(|err| {
2025-11-19T16:06:05.6204735Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:141:
2025-11-19T16:06:05.6204876Z              })?;
2025-11-19T16:06:05.6204951Z  
2025-11-19T16:06:05.6205062Z              let url = format!("/uploads/{}", new_filename);
2025-11-19T16:06:05.6205129Z -            
2025-11-19T16:06:05.6205198Z +
2025-11-19T16:06:05.6205301Z              return Ok(Json(UploadResponse { url }));
2025-11-19T16:06:05.6205369Z          }
2025-11-19T16:06:05.6205432Z      }
2025-11-19T16:06:05.6205685Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/lib.rs:1:
2025-11-19T16:06:05.6205771Z -
2025-11-19T16:06:05.6205861Z  /**
2025-11-19T16:06:05.6206026Z   * Linux Tutorial CMS - Library Root Module
2025-11-19T16:06:05.6206113Z   *
2025-11-19T16:06:05.6206350Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/lib.rs:105:
2025-11-19T16:06:05.6206421Z   * }
2025-11-19T16:06:05.6206484Z   * ```
2025-11-19T16:06:05.6206545Z   */
2025-11-19T16:06:05.6206605Z -
2025-11-19T16:06:05.6206695Z  // Core application modules
2025-11-19T16:06:05.6206818Z -pub mod auth;     // Authentication and authorization
2025-11-19T16:06:05.6206940Z -pub mod csrf;     // Cross-Site Request Forgery protection
2025-11-19T16:06:05.6207065Z -pub mod db;       // Database operations and migrations
2025-11-19T16:06:05.6207176Z +pub mod auth; // Authentication and authorization
2025-11-19T16:06:05.6207297Z +pub mod csrf; // Cross-Site Request Forgery protection
2025-11-19T16:06:05.6207405Z +pub mod db; // Database operations and migrations
2025-11-19T16:06:05.6207507Z  pub mod handlers; // HTTP request handlers
2025-11-19T16:06:05.6207597Z  pub mod middleware; // HTTP middleware
2025-11-19T16:06:05.6207708Z -pub mod models;   // Data structures and API models
2025-11-19T16:06:05.6207822Z +pub mod models; // Data structures and API models
2025-11-19T16:06:05.6207927Z  pub mod repositories; // Database repositories
2025-11-19T16:06:05.6207990Z  
2025-11-19T16:06:05.6208197Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/auth.rs:1:
2025-11-19T16:06:05.6208295Z  use crate::{auth, repositories};
2025-11-19T16:06:05.6208364Z -use axum::{
2025-11-19T16:06:05.6208439Z -    http::StatusCode,
2025-11-19T16:06:05.6208512Z -    Json,
2025-11-19T16:06:05.6208572Z -};
2025-11-19T16:06:05.6208658Z +use axum::{http::StatusCode, Json};
2025-11-19T16:06:05.6208718Z  
2025-11-19T16:06:05.6208927Z  /// AXUM middleware for protecting routes with authentication.
2025-11-19T16:06:05.6208988Z  ///
2025-11-19T16:06:05.6209289Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/cors.rs:1:
2025-11-19T16:06:05.6209388Z  use axum::http::HeaderValue;
2025-11-19T16:06:05.6209454Z  
2025-11-19T16:06:05.6209567Z  // Default CORS origins for development environment
2025-11-19T16:06:05.6209847Z -pub const DEV_DEFAULT_FRONTEND_ORIGINS: &[&str] = &["http://localhost:5173", "http://localhost:3000"];
2025-11-19T16:06:05.6209955Z +pub const DEV_DEFAULT_FRONTEND_ORIGINS: &[&str] =
2025-11-19T16:06:05.6210076Z +    &["http://localhost:5173", "http://localhost:3000"];
2025-11-19T16:06:05.6210138Z  
2025-11-19T16:06:05.6210271Z  /// Parses and validates a list of allowed CORS origins.
2025-11-19T16:06:05.6210425Z  pub fn parse_allowed_origins<'a, I>(origins: I) -> Vec<HeaderValue>
2025-11-19T16:06:05.6210632Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/mod.rs:1:
2025-11-19T16:06:05.6210718Z +pub mod auth;
2025-11-19T16:06:05.6210786Z  pub mod cors;
2025-11-19T16:06:05.6210858Z  pub mod security;
2025-11-19T16:06:05.6210939Z -pub mod auth;
2025-11-19T16:06:05.6211000Z  
2025-11-19T16:06:05.6234904Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:1:
2025-11-19T16:06:05.6235021Z -
2025-11-19T16:06:05.6235107Z -
2025-11-19T16:06:05.6235280Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.6235364Z  use serde_json::Value;
2025-11-19T16:06:05.6235457Z  use sqlx::FromRow;
2025-11-19T16:06:05.6235648Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:74:
2025-11-19T16:06:05.6235726Z      pub color: String,
2025-11-19T16:06:05.6235795Z  
2025-11-19T16:06:05.6236173Z      pub topics: Vec<String>,
2025-11-19T16:06:05.6236245Z -    
2025-11-19T16:06:05.6236307Z +
2025-11-19T16:06:05.6236392Z      pub content: String,
2025-11-19T16:06:05.6236454Z  
2025-11-19T16:06:05.6236535Z      pub id: Option<String>,
2025-11-19T16:06:05.6236733Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:140:
2025-11-19T16:06:05.6236948Z          let topics: Vec<String> = serde_json::from_str(&tutorial.topics).unwrap_or_else(|e| {
2025-11-19T16:06:05.6237031Z              tracing::error!(
2025-11-19T16:06:05.6237235Z                  "Failed to parse topics JSON for tutorial {}: {}. Topics JSON: '{}'",
2025-11-19T16:06:05.6237339Z -                tutorial.id, e, tutorial.topics
2025-11-19T16:06:05.6237413Z +                tutorial.id,
2025-11-19T16:06:05.6237489Z +                e,
2025-11-19T16:06:05.6237566Z +                tutorial.topics
2025-11-19T16:06:05.6237630Z              );
2025-11-19T16:06:05.6237704Z              Vec::new()
2025-11-19T16:06:05.6237780Z          });
2025-11-19T16:06:05.6237970Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:167:
2025-11-19T16:06:05.6238163Z          let topics: Vec<String> = serde_json::from_str(&tutorial.topics).unwrap_or_else(|e| {
2025-11-19T16:06:05.6238259Z              tracing::error!(
2025-11-19T16:06:05.6238418Z                  "Failed to parse topics JSON for tutorial {}: {}. Topics JSON: '{}'",
2025-11-19T16:06:05.6238515Z -                tutorial.id, e, tutorial.topics
2025-11-19T16:06:05.6238592Z +                tutorial.id,
2025-11-19T16:06:05.6238657Z +                e,
2025-11-19T16:06:05.6238732Z +                tutorial.topics
2025-11-19T16:06:05.6238795Z              );
2025-11-19T16:06:05.6238876Z              Vec::new()
2025-11-19T16:06:05.6238940Z          });
2025-11-19T16:06:05.6239121Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:253:
2025-11-19T16:06:05.6239190Z  
2025-11-19T16:06:05.6239421Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6239513Z  pub struct SitePageResponse {
2025-11-19T16:06:05.6239574Z -
2025-11-19T16:06:05.6239651Z      pub id: String,
2025-11-19T16:06:05.6239714Z  
2025-11-19T16:06:05.6239785Z      pub slug: String,
2025-11-19T16:06:05.6239972Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:281:
2025-11-19T16:06:05.6240116Z  
2025-11-19T16:06:05.6240196Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6240287Z  pub struct SitePageListResponse {
2025-11-19T16:06:05.6240351Z -
2025-11-19T16:06:05.6240440Z      pub items: Vec<SitePageResponse>,
2025-11-19T16:06:05.6240501Z  }
2025-11-19T16:06:05.6240571Z  
2025-11-19T16:06:05.6240751Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:288:
2025-11-19T16:06:05.6240827Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6240925Z  pub struct SitePageWithPostsResponse {
2025-11-19T16:06:05.6240997Z -
2025-11-19T16:06:05.6241082Z      pub page: SitePageResponse,
2025-11-19T16:06:05.6241144Z  
2025-11-19T16:06:05.6241244Z      pub posts: Vec<SitePostResponse>,
2025-11-19T16:06:05.6241424Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:295:
2025-11-19T16:06:05.6241490Z  
2025-11-19T16:06:05.6241570Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6241673Z  pub struct SitePostDetailResponse {
2025-11-19T16:06:05.6241736Z -
2025-11-19T16:06:05.6241815Z      pub page: SitePageResponse,
2025-11-19T16:06:05.6241912Z  
2025-11-19T16:06:05.6242029Z      pub post: SitePostResponse,
2025-11-19T16:06:05.6242316Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:303:
2025-11-19T16:06:05.6242406Z  
2025-11-19T16:06:05.6242533Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.6242681Z  pub struct CreateSitePageRequest {
2025-11-19T16:06:05.6242770Z -
2025-11-19T16:06:05.6242878Z      pub slug: String,
2025-11-19T16:06:05.6242972Z  
2025-11-19T16:06:05.6243049Z      pub title: String,
2025-11-19T16:06:05.6243229Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:329:
2025-11-19T16:06:05.6243375Z  
2025-11-19T16:06:05.6243453Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.6243539Z  pub struct UpdateSitePageRequest {
2025-11-19T16:06:05.6243598Z -
2025-11-19T16:06:05.6243683Z      pub slug: Option<String>,
2025-11-19T16:06:05.6243745Z  
2025-11-19T16:06:05.6243821Z      pub title: Option<String>,
2025-11-19T16:06:05.6244007Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:351:
2025-11-19T16:06:05.6244066Z  
2025-11-19T16:06:05.6244192Z  #[derive(Debug, Serialize, Deserialize, FromRow, Clone)]
2025-11-19T16:06:05.6244267Z  pub struct SitePost {
2025-11-19T16:06:05.6244337Z -
2025-11-19T16:06:05.6244407Z      pub id: String,
2025-11-19T16:06:05.6244466Z  
2025-11-19T16:06:05.6244554Z      pub page_id: String,
2025-11-19T16:06:05.6244736Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:377:
2025-11-19T16:06:05.6244801Z  
2025-11-19T16:06:05.6244877Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6244968Z  pub struct SitePostResponse {
2025-11-19T16:06:05.6245028Z -
2025-11-19T16:06:05.6245096Z      pub id: String,
2025-11-19T16:06:05.6245163Z  
2025-11-19T16:06:05.6245237Z      pub page_id: String,
2025-11-19T16:06:05.6245415Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:403:
2025-11-19T16:06:05.6245480Z  
2025-11-19T16:06:05.6245567Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6245658Z  pub struct SitePostListResponse {
2025-11-19T16:06:05.6245718Z -
2025-11-19T16:06:05.6245815Z      pub items: Vec<SitePostResponse>,
2025-11-19T16:06:05.6245876Z  }
2025-11-19T16:06:05.6245935Z  
2025-11-19T16:06:05.6246114Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:410:
2025-11-19T16:06:05.6246197Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.6246283Z  pub struct CreateSitePostRequest {
2025-11-19T16:06:05.6246347Z -
2025-11-19T16:06:05.6246426Z      pub title: String,
2025-11-19T16:06:05.6246486Z  
2025-11-19T16:06:05.6246554Z      pub slug: String,
2025-11-19T16:06:05.6246736Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:428:
2025-11-19T16:06:05.6246804Z  
2025-11-19T16:06:05.6246880Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.6246965Z  pub struct UpdateSitePostRequest {
2025-11-19T16:06:05.6247034Z -
2025-11-19T16:06:05.6247158Z      pub title: Option<String>,
2025-11-19T16:06:05.6247218Z  
2025-11-19T16:06:05.6247295Z      pub slug: Option<String>,
2025-11-19T16:06:05.6247487Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:446:
2025-11-19T16:06:05.6247547Z  
2025-11-19T16:06:05.6247623Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6247721Z  pub struct NavigationItemResponse {
2025-11-19T16:06:05.6247782Z -
2025-11-19T16:06:05.6247847Z      pub id: String,
2025-11-19T16:06:05.6247907Z  
2025-11-19T16:06:05.6247985Z      pub slug: String,
2025-11-19T16:06:05.6248166Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:458:
2025-11-19T16:06:05.6248226Z  
2025-11-19T16:06:05.6248314Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.6248397Z  pub struct NavigationResponse {
2025-11-19T16:06:05.6248484Z -
2025-11-19T16:06:05.6248632Z      pub items: Vec<NavigationItemResponse>,
2025-11-19T16:06:05.6248744Z  }
2025-11-19T16:06:05.6248818Z  
2025-11-19T16:06:05.6249296Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/comments.rs:125:
2025-11-19T16:06:05.6249388Z      Ok(exists.is_some())
2025-11-19T16:06:05.6249449Z  }
2025-11-19T16:06:05.6249512Z  
2025-11-19T16:06:05.6249802Z -pub async fn check_vote_exists(pool: &DbPool, comment_id: &str, voter_id: &str) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.6249913Z -    let exists: Option<(i64,)> = sqlx::query_as(
2025-11-19T16:06:05.6250067Z -        "SELECT 1 FROM comment_votes WHERE comment_id = ? AND voter_id = ?"
2025-11-19T16:06:05.6250130Z -    )
2025-11-19T16:06:05.6250213Z -    .bind(comment_id)
2025-11-19T16:06:05.6250285Z -    .bind(voter_id)
2025-11-19T16:06:05.6250364Z -    .fetch_optional(pool)
2025-11-19T16:06:05.6250551Z -    .await?;
2025-11-19T16:06:05.6250635Z +pub async fn check_vote_exists(
2025-11-19T16:06:05.6250703Z +    pool: &DbPool,
2025-11-19T16:06:05.6250774Z +    comment_id: &str,
2025-11-19T16:06:05.6250851Z +    voter_id: &str,
2025-11-19T16:06:05.6250939Z +) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.6251024Z +    let exists: Option<(i64,)> =
2025-11-19T16:06:05.6251219Z +        sqlx::query_as("SELECT 1 FROM comment_votes WHERE comment_id = ? AND voter_id = ?")
2025-11-19T16:06:05.6251293Z +            .bind(comment_id)
2025-11-19T16:06:05.6251365Z +            .bind(voter_id)
2025-11-19T16:06:05.6251448Z +            .fetch_optional(pool)
2025-11-19T16:06:05.6251529Z +            .await?;
2025-11-19T16:06:05.6251605Z      Ok(exists.is_some())
2025-11-19T16:06:05.6251665Z  }
2025-11-19T16:06:05.6251733Z  
2025-11-19T16:06:05.6251973Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/comments.rs:151:
2025-11-19T16:06:05.6252038Z      Ok(())
2025-11-19T16:06:05.6252100Z  }
2025-11-19T16:06:05.6252171Z  
2025-11-19T16:06:05.6252411Z -pub async fn get_last_comment_time(pool: &DbPool, author: &str) -> Result<Option<String>, sqlx::Error> {
2025-11-19T16:06:05.6252497Z +pub async fn get_last_comment_time(
2025-11-19T16:06:05.6252576Z +    pool: &DbPool,
2025-11-19T16:06:05.6252647Z +    author: &str,
2025-11-19T16:06:05.6252744Z +) -> Result<Option<String>, sqlx::Error> {
2025-11-19T16:06:05.6252875Z      let last_comment: Option<(String,)> = sqlx::query_as(
2025-11-19T16:06:05.6253070Z -        "SELECT created_at FROM comments WHERE author = ? ORDER BY created_at DESC LIMIT 1"
2025-11-19T16:06:05.6253267Z +        "SELECT created_at FROM comments WHERE author = ? ORDER BY created_at DESC LIMIT 1",
2025-11-19T16:06:05.6253333Z      )
2025-11-19T16:06:05.6253408Z      .bind(author)
2025-11-19T16:06:05.6253487Z      .fetch_optional(pool)
2025-11-19T16:06:05.6253713Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/content.rs:4:
2025-11-19T16:06:05.6253799Z  use serde_json::Value;
2025-11-19T16:06:05.6253864Z  use sqlx;
2025-11-19T16:06:05.6253925Z  
2025-11-19T16:06:05.6254013Z -pub async fn fetch_all_site_content(
2025-11-19T16:06:05.6254093Z -    pool: &DbPool,
2025-11-19T16:06:05.6254196Z -) -> Result<Vec<SiteContent>, sqlx::Error> {
2025-11-19T16:06:05.6254477Z +pub async fn fetch_all_site_content(pool: &DbPool) -> Result<Vec<SiteContent>, sqlx::Error> {
2025-11-19T16:06:05.6254574Z      sqlx::query_as::<_, SiteContent>(
2025-11-19T16:06:05.6254756Z          "SELECT section, content_json, updated_at FROM site_content ORDER BY section",
2025-11-19T16:06:05.6254818Z      )
2025-11-19T16:06:05.6255058Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/mod.rs:1:
2025-11-19T16:06:05.6255134Z +pub mod app_metadata;
2025-11-19T16:06:05.6255205Z +pub mod comments;
2025-11-19T16:06:05.6255274Z  pub mod common;
2025-11-19T16:06:05.6255383Z  pub mod content;
2025-11-19T16:06:05.6255484Z  pub mod pages;
2025-11-19T16:06:05.6255846Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/mod.rs:4:
2025-11-19T16:06:05.6255959Z  pub mod posts;
2025-11-19T16:06:05.6256047Z  pub mod token_blacklist;
2025-11-19T16:06:05.6256118Z  pub mod tutorials;
2025-11-19T16:06:05.6256189Z -pub mod comments;
2025-11-19T16:06:05.6256269Z  pub mod users;
2025-11-19T16:06:05.6256341Z -pub mod app_metadata;
2025-11-19T16:06:05.6256402Z  
2025-11-19T16:06:05.6256643Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:22:
2025-11-19T16:06:05.6256707Z      .await
2025-11-19T16:06:05.6256768Z  }
2025-11-19T16:06:05.6256839Z  
2025-11-19T16:06:05.6256925Z -pub async fn list_published_pages(
2025-11-19T16:06:05.6256996Z -    pool: &DbPool,
2025-11-19T16:06:05.6257097Z -) -> Result<Vec<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.6257311Z +pub async fn list_published_pages(pool: &DbPool) -> Result<Vec<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.6257397Z      sqlx::query_as::<_, SitePage>(
2025-11-19T16:06:05.6257771Z          "SELECT id, slug, title, description, nav_label, show_in_nav, order_index, is_published, hero_json, layout_json, created_at, updated_at
2025-11-19T16:06:05.6257858Z           FROM site_pages
2025-11-19T16:06:05.6258079Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:35:
2025-11-19T16:06:05.6258146Z      .await
2025-11-19T16:06:05.6258207Z  }
2025-11-19T16:06:05.6258274Z  
2025-11-19T16:06:05.6258358Z -pub async fn get_site_page_by_id(
2025-11-19T16:06:05.6258427Z -    pool: &DbPool,
2025-11-19T16:06:05.6258520Z -    id: &str,
2025-11-19T16:06:05.6258621Z -) -> Result<Option<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.6258842Z +pub async fn get_site_page_by_id(pool: &DbPool, id: &str) -> Result<Option<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.6258941Z      sqlx::query_as::<_, SitePage>(
2025-11-19T16:06:05.6259443Z          "SELECT id, slug, title, description, nav_label, show_in_nav, order_index, is_published, hero_json, layout_json, created_at, updated_at FROM site_pages WHERE id = ?",
2025-11-19T16:06:05.6259517Z      )
2025-11-19T16:06:05.6259745Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:63:
2025-11-19T16:06:05.6259827Z      pool: &DbPool,
2025-11-19T16:06:05.6259916Z      page: CreateSitePageRequest,
2025-11-19T16:06:05.6260016Z  ) -> Result<SitePage, sqlx::Error> {
2025-11-19T16:06:05.6260090Z -
2025-11-19T16:06:05.6260177Z      validate_slug(&page.slug)?;
2025-11-19T16:06:05.6260240Z  
2025-11-19T16:06:05.6260349Z      let id = uuid::Uuid::new_v4().to_string();
2025-11-19T16:06:05.6262689Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/posts.rs:49:
2025-11-19T16:06:05.6262764Z      .await
2025-11-19T16:06:05.6262824Z  }
2025-11-19T16:06:05.6262895Z  
2025-11-19T16:06:05.6262979Z -pub async fn get_site_post_by_id(
2025-11-19T16:06:05.6263046Z -    pool: &DbPool,
2025-11-19T16:06:05.6263126Z -    id: &str,
2025-11-19T16:06:05.6263228Z -) -> Result<Option<SitePost>, sqlx::Error> {
2025-11-19T16:06:05.6263444Z +pub async fn get_site_post_by_id(pool: &DbPool, id: &str) -> Result<Option<SitePost>, sqlx::Error> {
2025-11-19T16:06:05.6263525Z      sqlx::query_as::<_, SitePost>(
2025-11-19T16:06:05.6263822Z          "SELECT id, page_id, title, slug, excerpt, content_markdown, is_published, published_at, order_index, created_at, updated_at
2025-11-19T16:06:05.6264011Z           FROM site_posts WHERE id = ?",
2025-11-19T16:06:05.6265129Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/token_blacklist.rs:1:
2025-11-19T16:06:05.6265220Z  use crate::db::DbPool;
2025-11-19T16:06:05.6265288Z  use sqlx;
2025-11-19T16:06:05.6265352Z  
2025-11-19T16:06:05.6265594Z -pub async fn blacklist_token(pool: &DbPool, token: &str, expires_at: i64) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6265891Z -    let expires_at_str = chrono::DateTime::<chrono::Utc>::from(std::time::UNIX_EPOCH + std::time::Duration::from_secs(expires_at as u64))
2025-11-19T16:06:05.6265962Z -        .to_rfc3339();
2025-11-19T16:06:05.6266060Z +pub async fn blacklist_token(
2025-11-19T16:06:05.6266130Z +    pool: &DbPool,
2025-11-19T16:06:05.6266201Z +    token: &str,
2025-11-19T16:06:05.6266276Z +    expires_at: i64,
2025-11-19T16:06:05.6266364Z +) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6266500Z +    let expires_at_str = chrono::DateTime::<chrono::Utc>::from(
2025-11-19T16:06:05.6266673Z +        std::time::UNIX_EPOCH + std::time::Duration::from_secs(expires_at as u64),
2025-11-19T16:06:05.6266743Z +    )
2025-11-19T16:06:05.6266811Z +    .to_rfc3339();
2025-11-19T16:06:05.6266872Z  
2025-11-19T16:06:05.6267058Z      sqlx::query("INSERT INTO token_blacklist (token, expires_at) VALUES (?, ?)")
2025-11-19T16:06:05.6267129Z          .bind(token)
2025-11-19T16:06:05.6267389Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/token_blacklist.rs:14:
2025-11-19T16:06:05.6267450Z  }
2025-11-19T16:06:05.6267515Z  
2025-11-19T16:06:05.6267797Z  pub async fn is_token_blacklisted(pool: &DbPool, token: &str) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.6268017Z -    let exists: Option<(String,)> = sqlx::query_as("SELECT token FROM token_blacklist WHERE token = ?")
2025-11-19T16:06:05.6268099Z -        .bind(token)
2025-11-19T16:06:05.6268180Z -        .fetch_optional(pool)
2025-11-19T16:06:05.6268249Z -        .await?;
2025-11-19T16:06:05.6268338Z +    let exists: Option<(String,)> =
2025-11-19T16:06:05.6268491Z +        sqlx::query_as("SELECT token FROM token_blacklist WHERE token = ?")
2025-11-19T16:06:05.6268562Z +            .bind(token)
2025-11-19T16:06:05.6268640Z +            .fetch_optional(pool)
2025-11-19T16:06:05.6268711Z +            .await?;
2025-11-19T16:06:05.6268783Z      Ok(exists.is_some())
2025-11-19T16:06:05.6268846Z  }
2025-11-19T16:06:05.6268914Z  
2025-11-19T16:06:05.6271570Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/tutorials.rs:2:
2025-11-19T16:06:05.6271658Z  use crate::models::Tutorial;
2025-11-19T16:06:05.6271725Z  use sqlx;
2025-11-19T16:06:05.6271799Z  
2025-11-19T16:06:05.6271868Z -
2025-11-19T16:06:05.6271949Z  pub async fn list_tutorials(
2025-11-19T16:06:05.6272025Z      pool: &DbPool,
2025-11-19T16:06:05.6272093Z      limit: i64,
2025-11-19T16:06:05.6274135Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/users.rs:8:
2025-11-19T16:06:05.6274277Z      pub blocked_until: Option<String>,
2025-11-19T16:06:05.6274354Z  }
2025-11-19T16:06:05.6274423Z  
2025-11-19T16:06:05.6274663Z -pub async fn get_user_by_username(pool: &DbPool, username: &str) -> Result<Option<User>, sqlx::Error> {
2025-11-19T16:06:05.6274755Z +pub async fn get_user_by_username(
2025-11-19T16:06:05.6274827Z +    pool: &DbPool,
2025-11-19T16:06:05.6274899Z +    username: &str,
2025-11-19T16:06:05.6274997Z +) -> Result<Option<User>, sqlx::Error> {
2025-11-19T16:06:05.6275146Z      sqlx::query_as::<_, User>("SELECT * FROM users WHERE username = ?")
2025-11-19T16:06:05.6275222Z          .bind(username)
2025-11-19T16:06:05.6275309Z          .fetch_optional(pool)
2025-11-19T16:06:05.6275530Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/users.rs:15:
2025-11-19T16:06:05.6275595Z          .await
2025-11-19T16:06:05.6275659Z  }
2025-11-19T16:06:05.6275726Z  
2025-11-19T16:06:05.6275984Z -pub async fn get_login_attempt(pool: &DbPool, username_hash: &str) -> Result<Option<LoginAttempt>, sqlx::Error> {
2025-11-19T16:06:05.6276166Z +pub async fn get_login_attempt(
2025-11-19T16:06:05.6276241Z +    pool: &DbPool,
2025-11-19T16:06:05.6276318Z +    username_hash: &str,
2025-11-19T16:06:05.6276426Z +) -> Result<Option<LoginAttempt>, sqlx::Error> {
2025-11-19T16:06:05.6276515Z      sqlx::query_as::<_, LoginAttempt>(
2025-11-19T16:06:05.6276701Z          "SELECT fail_count, blocked_until FROM login_attempts WHERE username = ?",
2025-11-19T16:06:05.6276764Z      )
2025-11-19T16:06:05.6406919Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:19:
2025-11-19T16:06:05.6407549Z  //! ```
2025-11-19T16:06:05.6407709Z  
2025-11-19T16:06:05.6407944Z  use axum::{
2025-11-19T16:06:05.6408080Z +    extract::FromRef,
2025-11-19T16:06:05.6408238Z      extract::FromRequestParts,
2025-11-19T16:06:05.6408345Z      http::{
2025-11-19T16:06:05.6408528Z          header::{AUTHORIZATION, SET_COOKIE},
2025-11-19T16:06:05.6408886Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:26:
2025-11-19T16:06:05.6409041Z          HeaderMap, HeaderValue, StatusCode,
2025-11-19T16:06:05.6409157Z      },
2025-11-19T16:06:05.6409429Z      Json,
2025-11-19T16:06:05.6409558Z -    extract::FromRef,
2025-11-19T16:06:05.6409670Z  };
2025-11-19T16:06:05.6409919Z  use axum_extra::extract::cookie::{Cookie, CookieJar, SameSite};
2025-11-19T16:06:05.6410066Z  use chrono::{Duration, Utc};
2025-11-19T16:06:05.6410399Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:33:
2025-11-19T16:06:05.6410747Z  use jsonwebtoken::{decode, encode, DecodingKey, EncodingKey, Header, Validation};
2025-11-19T16:06:05.6410877Z -use std::sync::LazyLock;
2025-11-19T16:06:05.6411353Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.6411511Z -use std::sync::OnceLock;
2025-11-19T16:06:05.6411662Z  use std::collections::HashSet;
2025-11-19T16:06:05.6411776Z  use std::env;
2025-11-19T16:06:05.6411928Z +use std::sync::LazyLock;
2025-11-19T16:06:05.6412065Z +use std::sync::OnceLock;
2025-11-19T16:06:05.6412288Z  use time::{Duration as TimeDuration, OffsetDateTime};
2025-11-19T16:06:05.6412400Z  
2025-11-19T16:06:05.6412560Z  use crate::db::{self, DbPool};
2025-11-19T16:06:05.6412883Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:46:
2025-11-19T16:06:05.6412989Z  
2025-11-19T16:06:05.6413166Z  /// Global storage for the JWT decoding key.
2025-11-19T16:06:05.6413346Z  /// Derived from JWT_SECRET once it's initialized.
2025-11-19T16:06:05.6413652Z -pub static DECODING_KEY: LazyLock<DecodingKey> = LazyLock::new(|| {
2025-11-19T16:06:05.6413874Z -    DecodingKey::from_secret(get_jwt_secret().as_bytes())
2025-11-19T16:06:05.6413987Z -});
2025-11-19T16:06:05.6414188Z +pub static DECODING_KEY: LazyLock<DecodingKey> =
2025-11-19T16:06:05.6414494Z +    LazyLock::new(|| DecodingKey::from_secret(get_jwt_secret().as_bytes()));
2025-11-19T16:06:05.6414607Z  
2025-11-19T16:06:05.6414900Z  /// List of known placeholder secrets that must not be used in production.
2025-11-19T16:06:05.6415153Z  /// These are common defaults found in example configurations.
2025-11-19T16:06:05.6415497Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:391:
2025-11-19T16:06:05.6415598Z  
2025-11-19T16:06:05.6415748Z          // Check if token is blacklisted
2025-11-19T16:06:05.6415921Z          let pool = DbPool::from_ref(state);
2025-11-19T16:06:05.6416379Z -        let is_blacklisted = crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.6416490Z -            .await
2025-11-19T16:06:05.6416621Z -            .map_err(|e| {
2025-11-19T16:06:05.6416931Z -                tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.6417038Z -                (
2025-11-19T16:06:05.6417212Z -                    StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6417388Z -                    "Internal server error".to_string(),
2025-11-19T16:06:05.6417669Z -                )
2025-11-19T16:06:05.6417786Z -            })?;
2025-11-19T16:06:05.6417922Z +        let is_blacklisted =
2025-11-19T16:06:05.6418282Z +            crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.6418402Z +                .await
2025-11-19T16:06:05.6418522Z +                .map_err(|e| {
2025-11-19T16:06:05.6418828Z +                    tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.6418941Z +                    (
2025-11-19T16:06:05.6419111Z +                        StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6419409Z +                        "Internal server error".to_string(),
2025-11-19T16:06:05.6419536Z +                    )
2025-11-19T16:06:05.6419652Z +                })?;
2025-11-19T16:06:05.6419761Z  
2025-11-19T16:06:05.6419911Z          if is_blacklisted {
2025-11-19T16:06:05.6420285Z -            return Err((StatusCode::UNAUTHORIZED, "Token has been revoked".to_string()));
2025-11-19T16:06:05.6420424Z +            return Err((
2025-11-19T16:06:05.6420576Z +                StatusCode::UNAUTHORIZED,
2025-11-19T16:06:05.6420755Z +                "Token has been revoked".to_string(),
2025-11-19T16:06:05.6420865Z +            ));
2025-11-19T16:06:05.6420983Z          }
2025-11-19T16:06:05.6421106Z  
2025-11-19T16:06:05.6421231Z          Ok(claims)
2025-11-19T16:06:05.6421605Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:563:
2025-11-19T16:06:05.6421722Z      None
2025-11-19T16:06:05.6421842Z  }
2025-11-19T16:06:05.6421964Z  
2025-11-19T16:06:05.6422078Z -
2025-11-19T16:06:05.6422586Z  /// Optional Claims extractor for endpoints that support both authenticated and anonymous access.
2025-11-19T16:06:05.6422846Z  ///
2025-11-19T16:06:05.6423082Z  /// If a valid token is provided, it extracts the claims.
2025-11-19T16:06:05.6423457Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/auth.rs:596:
2025-11-19T16:06:05.6423583Z  
2025-11-19T16:06:05.6423743Z          // Check if token is blacklisted
2025-11-19T16:06:05.6423923Z          let pool = DbPool::from_ref(state);
2025-11-19T16:06:05.6424398Z -        let is_blacklisted = crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.6424516Z -            .await
2025-11-19T16:06:05.6424649Z -            .map_err(|e| {
2025-11-19T16:06:05.6424943Z -                tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.6425071Z -                (
2025-11-19T16:06:05.6425252Z -                    StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6425433Z -                    "Internal server error".to_string(),
2025-11-19T16:06:05.6425567Z -                )
2025-11-19T16:06:05.6425695Z -            })?;
2025-11-19T16:06:05.6425830Z +        let is_blacklisted =
2025-11-19T16:06:05.6426199Z +            crate::repositories::token_blacklist::is_token_blacklisted(&pool, &token)
2025-11-19T16:06:05.6426363Z +                .await
2025-11-19T16:06:05.6426509Z +                .map_err(|e| {
2025-11-19T16:06:05.6426834Z +                    tracing::error!("Database error checking token blacklist: {}", e);
2025-11-19T16:06:05.6426956Z +                    (
2025-11-19T16:06:05.6427140Z +                        StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6427316Z +                        "Internal server error".to_string(),
2025-11-19T16:06:05.6427453Z +                    )
2025-11-19T16:06:05.6427570Z +                })?;
2025-11-19T16:06:05.6427680Z  
2025-11-19T16:06:05.6427840Z          if is_blacklisted {
2025-11-19T16:06:05.6428215Z -            return Err((StatusCode::UNAUTHORIZED, "Token has been revoked".to_string()));
2025-11-19T16:06:05.6428350Z +            return Err((
2025-11-19T16:06:05.6428520Z +                StatusCode::UNAUTHORIZED,
2025-11-19T16:06:05.6428706Z +                "Token has been revoked".to_string(),
2025-11-19T16:06:05.6428822Z +            ));
2025-11-19T16:06:05.6428933Z          }
2025-11-19T16:06:05.6429173Z  
2025-11-19T16:06:05.6429446Z          Ok(OptionalClaims(Some(claims)))
2025-11-19T16:06:05.6535935Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:125:
2025-11-19T16:06:05.6536143Z      Ok(pool)
2025-11-19T16:06:05.6536247Z  }
2025-11-19T16:06:05.6536351Z  
2025-11-19T16:06:05.6536443Z -
2025-11-19T16:06:05.6536525Z -
2025-11-19T16:06:05.6536633Z -
2025-11-19T16:06:05.6536737Z -
2025-11-19T16:06:05.6536840Z -
2025-11-19T16:06:05.6536935Z -
2025-11-19T16:06:05.6537046Z -
2025-11-19T16:06:05.6537133Z -
2025-11-19T16:06:05.6537505Z  async fn ensure_site_page_schema(pool: &DbPool) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6537651Z      let mut tx = pool.begin().await?;
2025-11-19T16:06:05.6537748Z  
2025-11-19T16:06:05.6538087Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:210:
2025-11-19T16:06:05.6538220Z  async fn apply_core_migrations(
2025-11-19T16:06:05.6538398Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.6538521Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6538625Z -
2025-11-19T16:06:05.6538743Z      sqlx::query(
2025-11-19T16:06:05.6538849Z          r#"
2025-11-19T16:06:05.6538992Z          CREATE TABLE IF NOT EXISTS users (
2025-11-19T16:06:05.6539539Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:398:
2025-11-19T16:06:05.6539669Z      Ok(())
2025-11-19T16:06:05.6539769Z  }
2025-11-19T16:06:05.6539876Z  
2025-11-19T16:06:05.6540001Z -
2025-11-19T16:06:05.6540105Z -
2025-11-19T16:06:05.6540253Z  async fn seed_site_content_tx(
2025-11-19T16:06:05.6540446Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.6540601Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6541301Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:482:
2025-11-19T16:06:05.6541513Z                      "target": { "type": "section", "value": "home" }
2025-11-19T16:06:05.6541637Z                  },
2025-11-19T16:06:05.6541800Z                  "tutorialCardButton": "Zum Tutorial"
2025-11-19T16:06:05.6541923Z -            })
2025-11-19T16:06:05.6542043Z +            }),
2025-11-19T16:06:05.6542154Z          ),
2025-11-19T16:06:05.6542263Z          (
2025-11-19T16:06:05.6542391Z              "site_meta",
2025-11-19T16:06:05.6542740Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:489:
2025-11-19T16:06:05.6542856Z              json!({
2025-11-19T16:06:05.6543418Z                  "title": "Linux Tutorial - Lerne Linux Schritt für Schritt",
2025-11-19T16:06:05.6543777Z                  "description": "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah."
2025-11-19T16:06:05.6543901Z -            })
2025-11-19T16:06:05.6544012Z +            }),
2025-11-19T16:06:05.6544126Z          ),
2025-11-19T16:06:05.6544264Z          (
2025-11-19T16:06:05.6544357Z              "header",
2025-11-19T16:06:05.6544668Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:744:
2025-11-19T16:06:05.6544766Z  
2025-11-19T16:06:05.6544946Z      match (admin_username, admin_password) {
2025-11-19T16:06:05.6545350Z          (Some(username), Some(password)) if !username.is_empty() && !password.is_empty() => {
2025-11-19T16:06:05.6545455Z -
2025-11-19T16:06:05.6545602Z              if password.len() < 12 {
2025-11-19T16:06:05.6545735Z                  tracing::error!(
2025-11-19T16:06:05.6546048Z                      "ADMIN_PASSWORD must be at least 12 characters long (NIST recommendation)!"
2025-11-19T16:06:05.6546374Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:775:
2025-11-19T16:06:05.6546479Z                      }
2025-11-19T16:06:05.6546597Z                  },
2025-11-19T16:06:05.6546721Z                  None => {
2025-11-19T16:06:05.6546841Z -
2025-11-19T16:06:05.6546997Z                      let password_hash =
2025-11-19T16:06:05.6547259Z                          bcrypt::hash(&password, bcrypt::DEFAULT_COST).map_err(|e| {
2025-11-19T16:06:05.6547519Z                              tracing::error!("Failed to hash admin password: {}", e);
2025-11-19T16:06:05.6548015Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:809:
2025-11-19T16:06:05.6548172Z      let mut tx = pool.begin().await?;
2025-11-19T16:06:05.6548282Z  
2025-11-19T16:06:05.6548423Z      if seed_enabled {
2025-11-19T16:06:05.6548533Z -
2025-11-19T16:06:05.6548710Z          let already_seeded: Option<(String,)> =
2025-11-19T16:06:05.6549105Z              sqlx::query_as("SELECT value FROM app_metadata WHERE key = 'default_tutorials_seeded'")
2025-11-19T16:06:05.6549389Z                  .fetch_optional(&mut *tx)
2025-11-19T16:06:05.6549733Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1004:
2025-11-19T16:06:05.6549859Z      Ok(())
2025-11-19T16:06:05.6549964Z  }
2025-11-19T16:06:05.6550070Z  
2025-11-19T16:06:05.6550172Z -
2025-11-19T16:06:05.6550287Z -
2025-11-19T16:06:05.6550391Z -
2025-11-19T16:06:05.6550491Z -
2025-11-19T16:06:05.6550642Z  async fn apply_comment_migrations(
2025-11-19T16:06:05.6550821Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.6550972Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6551305Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1024:
2025-11-19T16:06:05.6551559Z          sqlx::query("ALTER TABLE comments ADD COLUMN post_id TEXT")
2025-11-19T16:06:05.6551689Z              .execute(&mut **tx)
2025-11-19T16:06:05.6551805Z              .await?;
2025-11-19T16:06:05.6551928Z -        
2025-11-19T16:06:05.6552031Z +
2025-11-19T16:06:05.6552161Z          // Add index for post_id
2025-11-19T16:06:05.6552508Z          sqlx::query("CREATE INDEX IF NOT EXISTS idx_comments_post ON comments(post_id)")
2025-11-19T16:06:05.6552650Z              .execute(&mut **tx)
2025-11-19T16:06:05.6553123Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1038:
2025-11-19T16:06:05.6553291Z      tx: &mut sqlx::Transaction<'_, sqlx::Sqlite>,
2025-11-19T16:06:05.6553432Z  ) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.6553570Z      // Create comment_votes table
2025-11-19T16:06:05.6553888Z -    sqlx::query(include_str!("../migrations/20241119_create_comment_votes.sql"))
2025-11-19T16:06:05.6554030Z -        .execute(&mut **tx)
2025-11-19T16:06:05.6554140Z -        .await?;
2025-11-19T16:06:05.6554275Z +    sqlx::query(include_str!(
2025-11-19T16:06:05.6554467Z +        "../migrations/20241119_create_comment_votes.sql"
2025-11-19T16:06:05.6554586Z +    ))
2025-11-19T16:06:05.6554691Z +    .execute(&mut **tx)
2025-11-19T16:06:05.6554786Z +    .await?;
2025-11-19T16:06:05.6554896Z  
2025-11-19T16:06:05.6555057Z      // Add votes column to comments if missing
2025-11-19T16:06:05.6555212Z -    let has_votes: bool = sqlx::query_scalar(
2025-11-19T16:06:05.6555505Z -        "SELECT COUNT(*) FROM pragma_table_info('comments') WHERE name='votes'",
2025-11-19T16:06:05.6555616Z -    )
2025-11-19T16:06:05.6555740Z -    .fetch_one(&mut **tx)
2025-11-19T16:06:05.6555848Z -    .await
2025-11-19T16:06:05.6555996Z -    .map(|count: i64| count > 0)?;
2025-11-19T16:06:05.6556126Z +    let has_votes: bool =
2025-11-19T16:06:05.6556519Z +        sqlx::query_scalar("SELECT COUNT(*) FROM pragma_table_info('comments') WHERE name='votes'")
2025-11-19T16:06:05.6556653Z +            .fetch_one(&mut **tx)
2025-11-19T16:06:05.6556773Z +            .await
2025-11-19T16:06:05.6556912Z +            .map(|count: i64| count > 0)?;
2025-11-19T16:06:05.6557012Z  
2025-11-19T16:06:05.6557132Z      if !has_votes {
2025-11-19T16:06:05.6557368Z          tracing::info!("Adding votes column to comments table");
2025-11-19T16:06:05.6557702Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1121:
2025-11-19T16:06:05.6557924Z      // Actually, apply_comment_migrations adds post_id.
2025-11-19T16:06:05.6558261Z      // Let's check columns in comments_old to be safe, or just assume standard flow.
2025-11-19T16:06:05.6558437Z      // To be safe, we'll select specific columns.
2025-11-19T16:06:05.6558552Z -    
2025-11-19T16:06:05.6558663Z +
2025-11-19T16:06:05.6558920Z      // Note: We need to handle the case where tutorial_id was NOT NULL.
2025-11-19T16:06:05.6559327Z      // If we have data, it's fine.
2025-11-19T16:06:05.6559458Z -    
2025-11-19T16:06:05.6559573Z +
2025-11-19T16:06:05.6559695Z      sqlx::query(
2025-11-19T16:06:05.6559809Z          r#"
2025-11-19T16:06:05.6560233Z          INSERT INTO comments (id, tutorial_id, post_id, author, content, created_at, votes, is_admin)
2025-11-19T16:06:05.6560591Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/db.rs:1148:
2025-11-19T16:06:05.6560704Z          .await?;
2025-11-19T16:06:05.6560822Z  
2025-11-19T16:06:05.6560942Z      // 6. Mark as fixed
2025-11-19T16:06:05.6561057Z -    sqlx::query(
2025-11-19T16:06:05.6561407Z -        "INSERT INTO app_metadata (key, value) VALUES ('comment_schema_fixed_v1', 'true')"
2025-11-19T16:06:05.6561518Z -    )
2025-11-19T16:06:05.6561643Z -    .execute(&mut **tx)
2025-11-19T16:06:05.6561756Z -    .await?;
2025-11-19T16:06:05.6562166Z +    sqlx::query("INSERT INTO app_metadata (key, value) VALUES ('comment_schema_fixed_v1', 'true')")
2025-11-19T16:06:05.6562307Z +        .execute(&mut **tx)
2025-11-19T16:06:05.6562420Z +        .await?;
2025-11-19T16:06:05.6562527Z  
2025-11-19T16:06:05.6562653Z      Ok(())
2025-11-19T16:06:05.6562757Z  }
2025-11-19T16:06:05.6578443Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:33:
2025-11-19T16:06:05.6578672Z  use sqlx::{self, FromRow};
2025-11-19T16:06:05.6578845Z  use std::{env, sync::OnceLock, time::Duration};
2025-11-19T16:06:05.6578948Z  
2025-11-19T16:06:05.6579049Z -
2025-11-19T16:06:05.6579402Z  /// Global salt for hashing login attempt identifiers.
2025-11-19T16:06:05.6579650Z  /// Initialized once at startup via init_login_attempt_salt().
2025-11-19T16:06:05.6580226Z  static LOGIN_ATTEMPT_SALT: OnceLock<String> = OnceLock::new();
2025-11-19T16:06:05.6580610Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:61:
2025-11-19T16:06:05.6580980Z          return Err("LOGIN_ATTEMPT_SALT must be at least 32 characters long".to_string());
2025-11-19T16:06:05.6581103Z      }
2025-11-19T16:06:05.6581215Z  
2025-11-19T16:06:05.6581567Z -    let unique_chars = trimmed.chars().collect::<std::collections::HashSet<_>>().len();
2025-11-19T16:06:05.6581702Z +    let unique_chars = trimmed
2025-11-19T16:06:05.6581820Z +        .chars()
2025-11-19T16:06:05.6581989Z +        .collect::<std::collections::HashSet<_>>()
2025-11-19T16:06:05.6582099Z +        .len();
2025-11-19T16:06:05.6582230Z      if unique_chars < 10 {
2025-11-19T16:06:05.6582636Z          return Err("LOGIN_ATTEMPT_SALT must contain at least 10 unique characters".to_string());
2025-11-19T16:06:05.6582744Z      }
2025-11-19T16:06:05.6583153Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/auth.rs:479:
2025-11-19T16:06:05.6583306Z  ) -> (StatusCode, HeaderMap) {
2025-11-19T16:06:05.6583451Z      // Extract token to blacklist it
2025-11-19T16:06:05.6583656Z      if let Some(token) = auth::extract_token(&headers) {
2025-11-19T16:06:05.6584123Z -        if let Err(e) = repositories::token_blacklist::blacklist_token(&pool, &token, claims.exp as i64).await {
2025-11-19T16:06:05.6584258Z +        if let Err(e) =
2025-11-19T16:06:05.6584653Z +            repositories::token_blacklist::blacklist_token(&pool, &token, claims.exp as i64).await
2025-11-19T16:06:05.6584764Z +        {
2025-11-19T16:06:05.6585051Z              tracing::error!("Failed to blacklist token on logout: {}", e);
2025-11-19T16:06:05.6585165Z          }
2025-11-19T16:06:05.6585275Z      }
2025-11-19T16:06:05.6638596Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:26:
2025-11-19T16:06:05.6638879Z      http::StatusCode,
2025-11-19T16:06:05.6638990Z      Json,
2025-11-19T16:06:05.6639091Z  };
2025-11-19T16:06:05.6639364Z -use std::net::SocketAddr;
2025-11-19T16:06:05.6639523Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.6639675Z +use std::net::SocketAddr;
2025-11-19T16:06:05.6639792Z  
2025-11-19T16:06:05.6639878Z -
2025-11-19T16:06:05.6640001Z  #[derive(Deserialize)]
2025-11-19T16:06:05.6640446Z  pub struct CreateCommentRequest {
2025-11-19T16:06:05.6640556Z      content: String,
2025-11-19T16:06:05.6640982Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:64:
2025-11-19T16:06:05.6641119Z      pub is_admin: bool,
2025-11-19T16:06:05.6641205Z  }
2025-11-19T16:06:05.6641292Z  
2025-11-19T16:06:05.6641389Z -
2025-11-19T16:06:05.6641481Z -
2025-11-19T16:06:05.6641567Z -
2025-11-19T16:06:05.6641656Z -
2025-11-19T16:06:05.6642016Z  fn sanitize_comment_content(raw: &str) -> Result<String, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6642146Z      let trimmed = raw.trim();
2025-11-19T16:06:05.6642245Z  
2025-11-19T16:06:05.6642701Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:134:
2025-11-19T16:06:05.6642872Z      let limit = params.limit.clamp(1, 200);
2025-11-19T16:06:05.6643036Z      let offset = params.offset.max(0);
2025-11-19T16:06:05.6643146Z  
2025-11-19T16:06:05.6643682Z -    let comments = repositories::comments::list_comments(&pool, &tutorial_id, limit, offset, params.sort.as_deref())
2025-11-19T16:06:05.6643786Z -        .await
2025-11-19T16:06:05.6643911Z -        .map_err(|e| {
2025-11-19T16:06:05.6644110Z -            tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6644217Z -            (
2025-11-19T16:06:05.6644394Z -                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6644536Z -                Json(ErrorResponse {
2025-11-19T16:06:05.6644736Z -                    error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6644844Z -                }),
2025-11-19T16:06:05.6644946Z -            )
2025-11-19T16:06:05.6645060Z -        })?;
2025-11-19T16:06:05.6645450Z +    let comments = repositories::comments::list_comments(
2025-11-19T16:06:05.6645572Z +        &pool,
2025-11-19T16:06:05.6645690Z +        &tutorial_id,
2025-11-19T16:06:05.6645808Z +        limit,
2025-11-19T16:06:05.6645910Z +        offset,
2025-11-19T16:06:05.6646053Z +        params.sort.as_deref(),
2025-11-19T16:06:05.6646162Z +    )
2025-11-19T16:06:05.6646272Z +    .await
2025-11-19T16:06:05.6646396Z +    .map_err(|e| {
2025-11-19T16:06:05.6646571Z +        tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6646690Z +        (
2025-11-19T16:06:05.6646843Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6646971Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6647159Z +                error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6647261Z +            }),
2025-11-19T16:06:05.6647362Z +        )
2025-11-19T16:06:05.6647471Z +    })?;
2025-11-19T16:06:05.6647592Z  
2025-11-19T16:06:05.6647939Z -    let response_comments: Vec<Comment> = comments.into_iter().map(|c| Comment {
2025-11-19T16:06:05.6648058Z -        id: c.id,
2025-11-19T16:06:05.6648220Z -        tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6648348Z -        post_id: c.post_id,
2025-11-19T16:06:05.6648464Z -        author: c.author,
2025-11-19T16:06:05.6648589Z -        content: c.content,
2025-11-19T16:06:05.6648745Z -        created_at: c.created_at,
2025-11-19T16:06:05.6648873Z -        votes: c.votes,
2025-11-19T16:06:05.6649011Z -        is_admin: c.is_admin,
2025-11-19T16:06:05.6649135Z -    }).collect();
2025-11-19T16:06:05.6649466Z +    let response_comments: Vec<Comment> = comments
2025-11-19T16:06:05.6649575Z +        .into_iter()
2025-11-19T16:06:05.6649691Z +        .map(|c| Comment {
2025-11-19T16:06:05.6649812Z +            id: c.id,
2025-11-19T16:06:05.6649950Z +            tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6650097Z +            post_id: c.post_id,
2025-11-19T16:06:05.6650241Z +            author: c.author,
2025-11-19T16:06:05.6650378Z +            content: c.content,
2025-11-19T16:06:05.6650522Z +            created_at: c.created_at,
2025-11-19T16:06:05.6650637Z +            votes: c.votes,
2025-11-19T16:06:05.6650769Z +            is_admin: c.is_admin,
2025-11-19T16:06:05.6650869Z +        })
2025-11-19T16:06:05.6651101Z +        .collect();
2025-11-19T16:06:05.6651225Z  
2025-11-19T16:06:05.6651364Z      Ok(Json(response_comments))
2025-11-19T16:06:05.6651463Z  }
2025-11-19T16:06:05.6651876Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:165:
2025-11-19T16:06:05.6652034Z      Path(tutorial_id): Path<String>,
2025-11-19T16:06:05.6652213Z      Json(payload): Json<CreateCommentRequest>,
2025-11-19T16:06:05.6652457Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6652576Z -    
2025-11-19T16:06:05.6652785Z      if let Err(e) = validate_tutorial_id(&tutorial_id) {
2025-11-19T16:06:05.6653101Z          return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: e })));
2025-11-19T16:06:05.6653225Z      }
2025-11-19T16:06:05.6653669Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:175:
2025-11-19T16:06:05.6653777Z          .await
2025-11-19T16:06:05.6653892Z          .map_err(|e| {
2025-11-19T16:06:05.6654162Z              tracing::error!("Failed to verify tutorial existence: {}", e);
2025-11-19T16:06:05.6654659Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6654767Z +            (
2025-11-19T16:06:05.6654946Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6655088Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6655290Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6655407Z +                }),
2025-11-19T16:06:05.6655527Z +            )
2025-11-19T16:06:05.6655634Z          })?;
2025-11-19T16:06:05.6655735Z  
2025-11-19T16:06:05.6655864Z      if !exists {
2025-11-19T16:06:05.6656442Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:182:
2025-11-19T16:06:05.6656903Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Tutorial not found".to_string() })));
2025-11-19T16:06:05.6657042Z +        return Err((
2025-11-19T16:06:05.6657185Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6657329Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6657509Z +                error: "Tutorial not found".to_string(),
2025-11-19T16:06:05.6657620Z +            }),
2025-11-19T16:06:05.6657733Z +        ));
2025-11-19T16:06:05.6657844Z      }
2025-11-19T16:06:05.6657960Z  
2025-11-19T16:06:05.6658298Z      create_comment_internal(pool, Some(tutorial_id), None, payload, None).await
2025-11-19T16:06:05.6658723Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:195:
2025-11-19T16:06:05.6658837Z          .await
2025-11-19T16:06:05.6658975Z          .map_err(|e| {
2025-11-19T16:06:05.6659411Z              tracing::error!("Failed to verify post existence: {}", e);
2025-11-19T16:06:05.6659946Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to fetch comments".to_string() }))
2025-11-19T16:06:05.6660072Z +            (
2025-11-19T16:06:05.6660247Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6660381Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6660586Z +                    error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6660702Z +                }),
2025-11-19T16:06:05.6660816Z +            )
2025-11-19T16:06:05.6660927Z          })?;
2025-11-19T16:06:05.6661041Z  
2025-11-19T16:06:05.6661165Z      if !exists {
2025-11-19T16:06:05.6661603Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:202:
2025-11-19T16:06:05.6662052Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Post not found".to_string() })));
2025-11-19T16:06:05.6662181Z +        return Err((
2025-11-19T16:06:05.6662336Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6662478Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6662652Z +                error: "Post not found".to_string(),
2025-11-19T16:06:05.6662765Z +            }),
2025-11-19T16:06:05.6663002Z +        ));
2025-11-19T16:06:05.6663123Z      }
2025-11-19T16:06:05.6663233Z  
2025-11-19T16:06:05.6663407Z      let limit = params.limit.clamp(1, 200);
2025-11-19T16:06:05.6663822Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:206:
2025-11-19T16:06:05.6663995Z      let offset = params.offset.max(0);
2025-11-19T16:06:05.6664107Z  
2025-11-19T16:06:05.6664652Z -    let comments = repositories::comments::list_post_comments(&pool, &post_id, limit, offset, params.sort.as_deref())
2025-11-19T16:06:05.6664768Z -        .await
2025-11-19T16:06:05.6664900Z -        .map_err(|e| {
2025-11-19T16:06:05.6665080Z -            tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6665537Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to fetch comments".to_string() }))
2025-11-19T16:06:05.6665656Z -        })?;
2025-11-19T16:06:05.6665889Z +    let comments = repositories::comments::list_post_comments(
2025-11-19T16:06:05.6665993Z +        &pool,
2025-11-19T16:06:05.6666114Z +        &post_id,
2025-11-19T16:06:05.6666216Z +        limit,
2025-11-19T16:06:05.6666321Z +        offset,
2025-11-19T16:06:05.6666457Z +        params.sort.as_deref(),
2025-11-19T16:06:05.6666566Z +    )
2025-11-19T16:06:05.6666674Z +    .await
2025-11-19T16:06:05.6666779Z +    .map_err(|e| {
2025-11-19T16:06:05.6666941Z +        tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6667045Z +        (
2025-11-19T16:06:05.6667211Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6667354Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6667559Z +                error: "Failed to fetch comments".to_string(),
2025-11-19T16:06:05.6667680Z +            }),
2025-11-19T16:06:05.6667974Z +        )
2025-11-19T16:06:05.6668100Z +    })?;
2025-11-19T16:06:05.6668204Z  
2025-11-19T16:06:05.6668533Z -    let response_comments: Vec<Comment> = comments.into_iter().map(|c| Comment {
2025-11-19T16:06:05.6668641Z -        id: c.id,
2025-11-19T16:06:05.6668800Z -        tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6668934Z -        post_id: c.post_id,
2025-11-19T16:06:05.6669067Z -        author: c.author,
2025-11-19T16:06:05.6669422Z -        content: c.content,
2025-11-19T16:06:05.6669572Z -        created_at: c.created_at,
2025-11-19T16:06:05.6669711Z -        votes: c.votes,
2025-11-19T16:06:05.6669848Z -        is_admin: c.is_admin,
2025-11-19T16:06:05.6669983Z -    }).collect();
2025-11-19T16:06:05.6670181Z +    let response_comments: Vec<Comment> = comments
2025-11-19T16:06:05.6670312Z +        .into_iter()
2025-11-19T16:06:05.6670449Z +        .map(|c| Comment {
2025-11-19T16:06:05.6670563Z +            id: c.id,
2025-11-19T16:06:05.6670710Z +            tutorial_id: c.tutorial_id,
2025-11-19T16:06:05.6670867Z +            post_id: c.post_id,
2025-11-19T16:06:05.6670998Z +            author: c.author,
2025-11-19T16:06:05.6671133Z +            content: c.content,
2025-11-19T16:06:05.6671280Z +            created_at: c.created_at,
2025-11-19T16:06:05.6671422Z +            votes: c.votes,
2025-11-19T16:06:05.6671559Z +            is_admin: c.is_admin,
2025-11-19T16:06:05.6671678Z +        })
2025-11-19T16:06:05.6671804Z +        .collect();
2025-11-19T16:06:05.6671893Z  
2025-11-19T16:06:05.6672026Z      Ok(Json(response_comments))
2025-11-19T16:06:05.6672128Z  }
2025-11-19T16:06:05.6672565Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:232:
2025-11-19T16:06:05.6672764Z      auth::OptionalClaims(claims): auth::OptionalClaims,
2025-11-19T16:06:05.6672932Z      Json(payload): Json<CreateCommentRequest>,
2025-11-19T16:06:05.6673156Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6673250Z -    
2025-11-19T16:06:05.6673389Z      // Verify post exists
2025-11-19T16:06:05.6673667Z      let exists = repositories::posts::check_post_exists(&pool, &post_id)
2025-11-19T16:06:05.6673781Z          .await
2025-11-19T16:06:05.6674179Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:239:
2025-11-19T16:06:05.6674470Z          .map_err(|e| {
2025-11-19T16:06:05.6674723Z              tracing::error!("Failed to verify post existence: {}", e);
2025-11-19T16:06:05.6675232Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6675333Z +            (
2025-11-19T16:06:05.6675512Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6675655Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6675837Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6675943Z +                }),
2025-11-19T16:06:05.6676064Z +            )
2025-11-19T16:06:05.6676174Z          })?;
2025-11-19T16:06:05.6676283Z  
2025-11-19T16:06:05.6676399Z      if !exists {
2025-11-19T16:06:05.6676798Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:245:
2025-11-19T16:06:05.6677237Z -        return Err((StatusCode::NOT_FOUND, Json(ErrorResponse { error: "Post not found".to_string() })));
2025-11-19T16:06:05.6677367Z +        return Err((
2025-11-19T16:06:05.6677521Z +            StatusCode::NOT_FOUND,
2025-11-19T16:06:05.6677659Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6677811Z +                error: "Post not found".to_string(),
2025-11-19T16:06:05.6677923Z +            }),
2025-11-19T16:06:05.6678035Z +        ));
2025-11-19T16:06:05.6678148Z      }
2025-11-19T16:06:05.6678248Z  
2025-11-19T16:06:05.6678579Z      create_comment_internal(pool, None, Some(post_id), payload, claims).await
2025-11-19T16:06:05.6678995Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:256:
2025-11-19T16:06:05.6679421Z      claims: Option<auth::Claims>,
2025-11-19T16:06:05.6679678Z  ) -> Result<Json<Comment>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6679940Z      let comment_content = sanitize_comment_content(&payload.content)?;
2025-11-19T16:06:05.6680039Z -    
2025-11-19T16:06:05.6680161Z +
2025-11-19T16:06:05.6680333Z      let author = if let Some(ref c) = claims {
2025-11-19T16:06:05.6680449Z          c.sub.clone()
2025-11-19T16:06:05.6680565Z      } else {
2025-11-19T16:06:05.6681021Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:265:
2025-11-19T16:06:05.6681147Z              Some(name) => {
2025-11-19T16:06:05.6681288Z                  let trimmed = name.trim();
2025-11-19T16:06:05.6681466Z                  if trimmed.len() < 2 || trimmed.len() > 50 {
2025-11-19T16:06:05.6682027Z -                    return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: "Name must be between 2 and 50 characters".to_string() })));
2025-11-19T16:06:05.6682159Z +                    return Err((
2025-11-19T16:06:05.6682327Z +                        StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6682484Z +                        Json(ErrorResponse {
2025-11-19T16:06:05.6682718Z +                            error: "Name must be between 2 and 50 characters".to_string(),
2025-11-19T16:06:05.6682830Z +                        }),
2025-11-19T16:06:05.6682949Z +                    ));
2025-11-19T16:06:05.6683054Z                  }
2025-11-19T16:06:05.6683187Z                  trimmed.to_string()
2025-11-19T16:06:05.6683310Z -            },
2025-11-19T16:06:05.6683890Z -            None => return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: "Name is required for guest comments".to_string() })))
2025-11-19T16:06:05.6684004Z +            }
2025-11-19T16:06:05.6684121Z +            None => {
2025-11-19T16:06:05.6684247Z +                return Err((
2025-11-19T16:06:05.6684392Z +                    StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6684542Z +                    Json(ErrorResponse {
2025-11-19T16:06:05.6684785Z +                        error: "Name is required for guest comments".to_string(),
2025-11-19T16:06:05.6684894Z +                    }),
2025-11-19T16:06:05.6685010Z +                ))
2025-11-19T16:06:05.6685122Z +            }
2025-11-19T16:06:05.6685333Z          }
2025-11-19T16:06:05.6685434Z      };
2025-11-19T16:06:05.6685532Z  
2025-11-19T16:06:05.6685947Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:278:
2025-11-19T16:06:05.6686065Z          .await
2025-11-19T16:06:05.6686185Z          .map_err(|e| {
2025-11-19T16:06:05.6686435Z              tracing::error!("Database error checking rate limit: {}", e);
2025-11-19T16:06:05.6686967Z -            (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6687075Z +            (
2025-11-19T16:06:05.6687248Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6687403Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6687589Z +                    error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6687694Z +                }),
2025-11-19T16:06:05.6687819Z +            )
2025-11-19T16:06:05.6687931Z          })?;
2025-11-19T16:06:05.6688130Z  
2025-11-19T16:06:05.6688319Z      if let Some(created_at_str) = last_comment_time {
2025-11-19T16:06:05.6688743Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:289:
2025-11-19T16:06:05.6688873Z                  return Err((
2025-11-19T16:06:05.6689024Z                      StatusCode::TOO_MANY_REQUESTS,
2025-11-19T16:06:05.6689156Z                      Json(ErrorResponse {
2025-11-19T16:06:05.6689709Z -                        error: format!("Please wait {} seconds before posting another comment", 60 - diff.num_seconds()),
2025-11-19T16:06:05.6689852Z +                        error: format!(
2025-11-19T16:06:05.6690093Z +                            "Please wait {} seconds before posting another comment",
2025-11-19T16:06:05.6690339Z +                            60 - diff.num_seconds()
2025-11-19T16:06:05.6690465Z +                        ),
2025-11-19T16:06:05.6690582Z                      }),
2025-11-19T16:06:05.6690692Z                  ));
2025-11-19T16:06:05.6690807Z              }
2025-11-19T16:06:05.6691220Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:319:
2025-11-19T16:06:05.6691330Z      .await
2025-11-19T16:06:05.6691438Z      .map_err(|e| {
2025-11-19T16:06:05.6691611Z          tracing::error!("Database error: {}", e);
2025-11-19T16:06:05.6692129Z -        (StatusCode::INTERNAL_SERVER_ERROR, Json(ErrorResponse { error: "Failed to create comment".to_string() }))
2025-11-19T16:06:05.6692229Z +        (
2025-11-19T16:06:05.6692391Z +            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6692537Z +            Json(ErrorResponse {
2025-11-19T16:06:05.6692725Z +                error: "Failed to create comment".to_string(),
2025-11-19T16:06:05.6692826Z +            }),
2025-11-19T16:06:05.6692934Z +        )
2025-11-19T16:06:05.6693035Z      })?;
2025-11-19T16:06:05.6693144Z  
2025-11-19T16:06:05.6693304Z      let response_comment = Comment {
2025-11-19T16:06:05.6693721Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/comments.rs:439:
2025-11-19T16:06:05.6693832Z      }
2025-11-19T16:06:05.6693936Z  
2025-11-19T16:06:05.6694073Z      // Determine voter ID
2025-11-19T16:06:05.6694216Z -    let voter_id = claims.sub; 
2025-11-19T16:06:05.6694356Z +    let voter_id = claims.sub;
2025-11-19T16:06:05.6694469Z  
2025-11-19T16:06:05.6694606Z      // Check if already voted
2025-11-19T16:06:05.6694964Z      let has_voted = repositories::comments::check_vote_exists(&pool, &id, &voter_id)
2025-11-19T16:06:05.6695402Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:1:
2025-11-19T16:06:05.6695539Z +use crate::db;
2025-11-19T16:06:05.6695659Z  use axum::{
2025-11-19T16:06:05.6695790Z      extract::State,
2025-11-19T16:06:05.6695945Z      response::{Html, IntoResponse},
2025-11-19T16:06:05.6696387Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:4:
2025-11-19T16:06:05.6696494Z  };
2025-11-19T16:06:05.6696633Z  use reqwest::Client;
2025-11-19T16:06:05.6696898Z  use std::env;
2025-11-19T16:06:05.6697021Z -use crate::db;
2025-11-19T16:06:05.6697122Z  
2025-11-19T16:06:05.6697319Z  // Default frontend URL (internal Docker network)
2025-11-19T16:06:05.6697559Z  const DEFAULT_FRONTEND_URL: &str = "http://frontend";
2025-11-19T16:06:05.6698021Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:11:
2025-11-19T16:06:05.6698141Z  
2025-11-19T16:06:05.6698487Z  pub async fn serve_index(State(pool): State<db::DbPool>) -> impl IntoResponse {
2025-11-19T16:06:05.6698904Z -    let frontend_url = env::var("FRONTEND_URL").unwrap_or_else(|_| DEFAULT_FRONTEND_URL.to_string());
2025-11-19T16:06:05.6699035Z +    let frontend_url =
2025-11-19T16:06:05.6699512Z +        env::var("FRONTEND_URL").unwrap_or_else(|_| DEFAULT_FRONTEND_URL.to_string());
2025-11-19T16:06:05.6699741Z      let index_url = format!("{}/index.html", frontend_url);
2025-11-19T16:06:05.6699845Z  
2025-11-19T16:06:05.6700016Z      // Fetch index.html from frontend container
2025-11-19T16:06:05.6700466Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:20:
2025-11-19T16:06:05.6700596Z              Ok(text) => text,
2025-11-19T16:06:05.6700721Z              Err(e) => {
2025-11-19T16:06:05.6700975Z                  tracing::error!("Failed to read index.html body: {}", e);
2025-11-19T16:06:05.6701460Z -                return Html("<h1>Internal Server Error</h1><p>Failed to load application.</p>".to_string()).into_response();
2025-11-19T16:06:05.6701607Z +                return Html(
2025-11-19T16:06:05.6701936Z +                    "<h1>Internal Server Error</h1><p>Failed to load application.</p>".to_string(),
2025-11-19T16:06:05.6702039Z +                )
2025-11-19T16:06:05.6702301Z +                .into_response();
2025-11-19T16:06:05.6702425Z              }
2025-11-19T16:06:05.6702532Z          },
2025-11-19T16:06:05.6702642Z          Err(e) => {
2025-11-19T16:06:05.6703098Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:27:
2025-11-19T16:06:05.6703386Z              tracing::error!("Failed to fetch index.html from {}: {}", index_url, e);
2025-11-19T16:06:05.6703910Z -            return Html("<h1>Internal Server Error</h1><p>Failed to connect to frontend service.</p>".to_string()).into_response();
2025-11-19T16:06:05.6704037Z +            return Html(
2025-11-19T16:06:05.6704366Z +                "<h1>Internal Server Error</h1><p>Failed to connect to frontend service.</p>"
2025-11-19T16:06:05.6704497Z +                    .to_string(),
2025-11-19T16:06:05.6704612Z +            )
2025-11-19T16:06:05.6704755Z +            .into_response();
2025-11-19T16:06:05.6704870Z          }
2025-11-19T16:06:05.6704978Z      };
2025-11-19T16:06:05.6705102Z  
2025-11-19T16:06:05.6705571Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:32:
2025-11-19T16:06:05.6705709Z      // Fetch site meta from DB
2025-11-19T16:06:05.6706206Z -    let site_meta = match crate::repositories::content::fetch_site_content_by_section(&pool, "site_meta").await {
2025-11-19T16:06:05.6706356Z -        Ok(Some(record)) => {
2025-11-19T16:06:05.6706674Z -            match serde_json::from_str::<serde_json::Value>(&record.content_json) {
2025-11-19T16:06:05.6706798Z -                Ok(json) => json,
2025-11-19T16:06:05.6706971Z -                Err(_) => serde_json::json!({}),
2025-11-19T16:06:05.6707093Z +    let site_meta =
2025-11-19T16:06:05.6707521Z +        match crate::repositories::content::fetch_site_content_by_section(&pool, "site_meta").await
2025-11-19T16:06:05.6707635Z +        {
2025-11-19T16:06:05.6707778Z +            Ok(Some(record)) => {
2025-11-19T16:06:05.6708060Z +                match serde_json::from_str::<serde_json::Value>(&record.content_json) {
2025-11-19T16:06:05.6708191Z +                    Ok(json) => json,
2025-11-19T16:06:05.6708363Z +                    Err(_) => serde_json::json!({}),
2025-11-19T16:06:05.6708474Z +                }
2025-11-19T16:06:05.6708576Z              }
2025-11-19T16:06:05.6708809Z -        },
2025-11-19T16:06:05.6708939Z -        _ => serde_json::json!({}),
2025-11-19T16:06:05.6709043Z -    };
2025-11-19T16:06:05.6709181Z +            _ => serde_json::json!({}),
2025-11-19T16:06:05.6709418Z +        };
2025-11-19T16:06:05.6709527Z  
2025-11-19T16:06:05.6709672Z -    let title = site_meta.get("title")
2025-11-19T16:06:05.6709826Z +    let title = site_meta
2025-11-19T16:06:05.6709934Z +        .get("title")
2025-11-19T16:06:05.6710056Z          .and_then(|v| v.as_str())
2025-11-19T16:06:05.6710673Z          .unwrap_or("Linux Tutorial - Lerne Linux Schritt für Schritt");
2025-11-19T16:06:05.6710793Z -    
2025-11-19T16:06:05.6710982Z -    let description = site_meta.get("description")
2025-11-19T16:06:05.6711095Z +
2025-11-19T16:06:05.6711394Z +    let description = site_meta
2025-11-19T16:06:05.6737273Z +        .get("description")
2025-11-19T16:06:05.6737511Z          .and_then(|v| v.as_str())
2025-11-19T16:06:05.6737888Z          .unwrap_or("Lerne Linux von Grund auf - Interaktiv, modern und praxisnah.");
2025-11-19T16:06:05.6738038Z  
2025-11-19T16:06:05.6738514Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:58:
2025-11-19T16:06:05.6738640Z      // Replace Title
2025-11-19T16:06:05.6738802Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6739521Z          "<title>Linux Tutorial - Lerne Linux Schritt für Schritt</title>",
2025-11-19T16:06:05.6739686Z -        &format!("<title>{}</title>", safe_title)
2025-11-19T16:06:05.6739844Z +        &format!("<title>{}</title>", safe_title),
2025-11-19T16:06:05.6739983Z      );
2025-11-19T16:06:05.6740089Z  
2025-11-19T16:06:05.6740230Z      // Replace Meta Description
2025-11-19T16:06:05.6740901Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:65:
2025-11-19T16:06:05.6741263Z -    // Note: This regex-like replacement is brittle if the HTML formatting changes. 
2025-11-19T16:06:05.6741603Z +    // Note: This regex-like replacement is brittle if the HTML formatting changes.
2025-11-19T16:06:05.6741989Z      // For now, we assume the exact string from index.html or use a more robust regex if needed.
2025-11-19T16:06:05.6742388Z      // Since we don't have regex crate here yet, we'll try to replace the known default description.
2025-11-19T16:06:05.6742849Z      // If it's dynamic, we might need a more robust approach, but for now let's try replacing the known default.
2025-11-19T16:06:05.6743306Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:69:
2025-11-19T16:06:05.6744242Z      let default_desc = "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah. Umfassende Tutorials für Einsteiger und Fortgeschrittene.";
2025-11-19T16:06:05.6744411Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6744571Z          &format!("content=\"{}\"", default_desc),
2025-11-19T16:06:05.6744755Z -        &format!("content=\"{}\"", safe_description)
2025-11-19T16:06:05.6744932Z +        &format!("content=\"{}\"", safe_description),
2025-11-19T16:06:05.6745040Z      );
2025-11-19T16:06:05.6745146Z  
2025-11-19T16:06:05.6745310Z -    // Also replace OG tags if possible. 
2025-11-19T16:06:05.6745466Z +    // Also replace OG tags if possible.
2025-11-19T16:06:05.6745767Z      // A better approach for robust replacement without full HTML parsing:
2025-11-19T16:06:05.6746187Z      // We can replace the whole <head> block or specific known lines if we are sure about the structure.
2025-11-19T16:06:05.6746477Z      // Given the index.html structure, we can try to replace specific lines.
2025-11-19T16:06:05.6746954Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:79:
2025-11-19T16:06:05.6747076Z -    
2025-11-19T16:06:05.6747186Z +
2025-11-19T16:06:05.6747324Z      // Replace OG Title
2025-11-19T16:06:05.6747500Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6747880Z          "content=\"Linux Tutorial - Lerne Linux Schritt für Schritt\"",
2025-11-19T16:06:05.6748476Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:83:
2025-11-19T16:06:05.6748624Z -        &format!("content=\"{}\"", safe_title)
2025-11-19T16:06:05.6748781Z +        &format!("content=\"{}\"", safe_title),
2025-11-19T16:06:05.6748884Z      );
2025-11-19T16:06:05.6748999Z  
2025-11-19T16:06:05.6749636Z      // Replace OG Description (reusing the description replacement above might handle this if content matches)
2025-11-19T16:06:05.6750093Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/frontend_proxy.rs:88:
2025-11-19T16:06:05.6750452Z      let default_og_desc = "Lerne Linux von Grund auf - Interaktiv, modern und praxisnah.";
2025-11-19T16:06:05.6750613Z      injected_html = injected_html.replace(
2025-11-19T16:06:05.6750804Z          &format!("content=\"{}\"", default_og_desc),
2025-11-19T16:06:05.6750979Z -        &format!("content=\"{}\"", safe_description)
2025-11-19T16:06:05.6751143Z +        &format!("content=\"{}\"", safe_description),
2025-11-19T16:06:05.6751278Z      );
2025-11-19T16:06:05.6751379Z  
2025-11-19T16:06:05.6751526Z      Html(injected_html).into_response()
2025-11-19T16:06:05.6751929Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:1:
2025-11-19T16:06:05.6752040Z -
2025-11-19T16:06:05.6752153Z -
2025-11-19T16:06:05.6752258Z  /**
2025-11-19T16:06:05.6752410Z   * HTTP Handlers Module
2025-11-19T16:06:05.6752522Z   *
2025-11-19T16:06:05.6752910Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:140:
2025-11-19T16:06:05.6753063Z   * - Caching headers for static content
2025-11-19T16:06:05.6753230Z   * - Async/await for high concurrency
2025-11-19T16:06:05.6753336Z   */
2025-11-19T16:06:05.6753567Z -
2025-11-19T16:06:05.6753761Z  // HTTP Handler Modules - Organized by Domain
2025-11-19T16:06:05.6753876Z  
2025-11-19T16:06:05.6754011Z  // Core System Handlers
2025-11-19T16:06:05.6754388Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:147:
2025-11-19T16:06:05.6754615Z -pub mod auth;      // Authentication and authorization
2025-11-19T16:06:05.6754826Z -pub mod search;    // Full-text search functionality
2025-11-19T16:06:05.6755026Z +pub mod auth; // Authentication and authorization
2025-11-19T16:06:05.6755219Z +pub mod search; // Full-text search functionality
2025-11-19T16:06:05.6755317Z  
2025-11-19T16:06:05.6755457Z  // Content Management Handlers
2025-11-19T16:06:05.6755600Z  pub mod tutorials;
2025-11-19T16:06:05.6755986Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/mod.rs:152:
2025-11-19T16:06:05.6756112Z  pub mod upload;
2025-11-19T16:06:05.6756249Z -    // Tutorial CRUD operations
2025-11-19T16:06:05.6756448Z -pub mod comments;     // Comment system management
2025-11-19T16:06:05.6756586Z +// Tutorial CRUD operations
2025-11-19T16:06:05.6756764Z +pub mod comments; // Comment system management
2025-11-19T16:06:05.6756887Z  
2025-11-19T16:06:05.6757014Z  // Site Content Handlers
2025-11-19T16:06:05.6757161Z +pub mod frontend_proxy;
2025-11-19T16:06:05.6757369Z  pub mod site_content; // Dynamic site content sections
2025-11-19T16:06:05.6757567Z -pub mod site_pages;   // Static page management
2025-11-19T16:06:05.6757746Z -pub mod site_posts;   // Blog post management
2025-11-19T16:06:05.6758033Z -pub mod frontend_proxy; // Frontend proxy for server-side injection
2025-11-19T16:06:05.6758222Z +pub mod site_pages; // Static page management
2025-11-19T16:06:05.6758587Z +pub mod site_posts; // Blog post management // Frontend proxy for server-side injection
2025-11-19T16:06:05.6758703Z  
2025-11-19T16:06:05.6759179Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/search.rs:57:
2025-11-19T16:06:05.6759527Z              // Keep only safe characters for FTS5 queries
2025-11-19T16:06:05.6759672Z              let sanitized: String = token
2025-11-19T16:06:05.6759806Z                  .chars()
2025-11-19T16:06:05.6760217Z -                .filter(|c| c.is_ascii_alphanumeric() || matches!(c, '*' | '-' | '_' | '.' | '+' | '#' | '@' | '/' | ':' | '(' | ')' | '[' | ']'))
2025-11-19T16:06:05.6760519Z +                .filter(|c| {
2025-11-19T16:06:05.6760686Z +                    c.is_ascii_alphanumeric()
2025-11-19T16:06:05.6760845Z +                        || matches!(
2025-11-19T16:06:05.6760976Z +                            c,
2025-11-19T16:06:05.6761113Z +                            '*' | '-'
2025-11-19T16:06:05.6761264Z +                                | '_'
2025-11-19T16:06:05.6761398Z +                                | '.'
2025-11-19T16:06:05.6761529Z +                                | '+'
2025-11-19T16:06:05.6761672Z +                                | '#'
2025-11-19T16:06:05.6761780Z +                                | '@'
2025-11-19T16:06:05.6761898Z +                                | '/'
2025-11-19T16:06:05.6762019Z +                                | ':'
2025-11-19T16:06:05.6762207Z +                                | '('
2025-11-19T16:06:05.6762334Z +                                | ')'
2025-11-19T16:06:05.6762471Z +                                | '['
2025-11-19T16:06:05.6762605Z +                                | ']'
2025-11-19T16:06:05.6762730Z +                        )
2025-11-19T16:06:05.6762851Z +                })
2025-11-19T16:06:05.6762982Z                  .collect();
2025-11-19T16:06:05.6763146Z              if sanitized.is_empty() {
2025-11-19T16:06:05.6763268Z                  None
2025-11-19T16:06:05.6763638Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/search.rs:104:
2025-11-19T16:06:05.6763789Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6763948Z      Query(params): Query<SearchQuery>,
2025-11-19T16:06:05.6764323Z  ) -> Result<Json<Vec<TutorialResponse>>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6764426Z -
2025-11-19T16:06:05.6764576Z      if params.q.trim().is_empty() {
2025-11-19T16:06:05.6764704Z          return Err((
2025-11-19T16:06:05.6764886Z              StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6765341Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:1:
2025-11-19T16:06:05.6765441Z -
2025-11-19T16:06:05.6765538Z -
2025-11-19T16:06:05.6765666Z  use crate::{
2025-11-19T16:06:05.6765801Z -    auth, db, repositories,
2025-11-19T16:06:05.6765902Z +    auth, db,
2025-11-19T16:06:05.6766012Z      models::{
2025-11-19T16:06:05.6766449Z          ErrorResponse, SiteContentListResponse, SiteContentResponse, UpdateSiteContentRequest,
2025-11-19T16:06:05.6766548Z      },
2025-11-19T16:06:05.6766960Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:8:
2025-11-19T16:06:05.6767097Z +    repositories,
2025-11-19T16:06:05.6767207Z  };
2025-11-19T16:06:05.6767325Z  use axum::{
2025-11-19T16:06:05.6767477Z      extract::{Path, State},
2025-11-19T16:06:05.6767933Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_content.rs:164:
2025-11-19T16:06:05.6768088Z  pub async fn list_site_content(
2025-11-19T16:06:05.6768245Z      State(pool): State<db::DbPool>,
2025-11-19T16:06:05.6768616Z  ) -> Result<Json<SiteContentListResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6769018Z -    let records = repositories::content::fetch_all_site_content(&pool).await.map_err(|err| {
2025-11-19T16:06:05.6769391Z -        tracing::error!("Failed to load site content: {}", err);
2025-11-19T16:06:05.6769523Z -        (
2025-11-19T16:06:05.6769680Z -            StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6769809Z -            Json(ErrorResponse {
2025-11-19T16:06:05.6770018Z -                error: "Failed to load site content".to_string(),
2025-11-19T16:06:05.6770132Z -            }),
2025-11-19T16:06:05.6770246Z -        )
2025-11-19T16:06:05.6770364Z -    })?;
2025-11-19T16:06:05.6770669Z +    let records = repositories::content::fetch_all_site_content(&pool)
2025-11-19T16:06:05.6770788Z +        .await
2025-11-19T16:06:05.6770917Z +        .map_err(|err| {
2025-11-19T16:06:05.6771157Z +            tracing::error!("Failed to load site content: {}", err);
2025-11-19T16:06:05.6771436Z +            (
2025-11-19T16:06:05.6771599Z +                StatusCode::INTERNAL_SERVER_ERROR,
2025-11-19T16:06:05.6771731Z +                Json(ErrorResponse {
2025-11-19T16:06:05.6771928Z +                    error: "Failed to load site content".to_string(),
2025-11-19T16:06:05.6772042Z +                }),
2025-11-19T16:06:05.6772156Z +            )
2025-11-19T16:06:05.6772274Z +        })?;
2025-11-19T16:06:05.6772375Z  
2025-11-19T16:06:05.6772569Z      let mut items = Vec::with_capacity(records.len());
2025-11-19T16:06:05.6772692Z      for record in records {
2025-11-19T16:06:05.6813643Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_pages.rs:1:
2025-11-19T16:06:05.6813819Z -
2025-11-19T16:06:05.6813914Z -
2025-11-19T16:06:05.6814085Z  use crate::{
2025-11-19T16:06:05.6814217Z -    auth, db, repositories,
2025-11-19T16:06:05.6814322Z +    auth, db,
2025-11-19T16:06:05.6814439Z      models::{
2025-11-19T16:06:05.6814855Z          CreateSitePageRequest, ErrorResponse, NavigationItemResponse, NavigationResponse,
2025-11-19T16:06:05.6815319Z          SitePageListResponse, SitePageResponse, SitePageWithPostsResponse, SitePostDetailResponse,
2025-11-19T16:06:05.6815726Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_pages.rs:8:
2025-11-19T16:06:05.6815926Z          SitePostResponse, UpdateSitePageRequest,
2025-11-19T16:06:05.6816043Z      },
2025-11-19T16:06:05.6816163Z +    repositories,
2025-11-19T16:06:05.6816282Z  };
2025-11-19T16:06:05.6816405Z  use axum::{
2025-11-19T16:06:05.6816568Z      extract::{Path, State},
2025-11-19T16:06:05.6837678Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_posts.rs:1:
2025-11-19T16:06:05.6837840Z -
2025-11-19T16:06:05.6837950Z -
2025-11-19T16:06:05.6838099Z  use crate::{
2025-11-19T16:06:05.6838269Z -    auth, db, repositories,
2025-11-19T16:06:05.6838398Z +    auth, db,
2025-11-19T16:06:05.6838536Z      models::{
2025-11-19T16:06:05.6839009Z          CreateSitePostRequest, ErrorResponse, SitePostListResponse, SitePostResponse,
2025-11-19T16:06:05.6839160Z          UpdateSitePostRequest,
2025-11-19T16:06:05.6839764Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/site_posts.rs:8:
2025-11-19T16:06:05.6839882Z      },
2025-11-19T16:06:05.6840034Z +    repositories,
2025-11-19T16:06:05.6840155Z  };
2025-11-19T16:06:05.6840293Z  use axum::{
2025-11-19T16:06:05.6840474Z      extract::{Path, State},
2025-11-19T16:06:05.6918797Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:43:
2025-11-19T16:06:05.6918984Z      }
2025-11-19T16:06:05.6919090Z  
2025-11-19T16:06:05.6919501Z      // Ensure only safe characters for database and URL usage
2025-11-19T16:06:05.6919797Z -    if !id.chars().all(|c| c.is_alphanumeric() || c == '-' || c == '_' || c == '.') {
2025-11-19T16:06:05.6919928Z +    if !id
2025-11-19T16:06:05.6920048Z +        .chars()
2025-11-19T16:06:05.6920259Z +        .all(|c| c.is_alphanumeric() || c == '-' || c == '_' || c == '.')
2025-11-19T16:06:05.6920380Z +    {
2025-11-19T16:06:05.6920627Z          return Err("Tutorial ID contains invalid characters".to_string());
2025-11-19T16:06:05.6920723Z      }
2025-11-19T16:06:05.6920817Z      Ok(())
2025-11-19T16:06:05.6921223Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:76:
2025-11-19T16:06:05.6921323Z  
2025-11-19T16:06:05.6921565Z  pub(crate) fn validate_icon(icon: &str) -> Result<(), String> {
2025-11-19T16:06:05.6921725Z      const ALLOWED_ICONS: &[&str] = &[
2025-11-19T16:06:05.6921926Z -        "Terminal",    // Command line and shell tutorials
2025-11-19T16:06:05.6922137Z -        "FolderTree",  // File system and directory tutorials
2025-11-19T16:06:05.6922336Z -        "FileText",    // Text editing and file manipulation
2025-11-19T16:06:05.6922536Z -        "Settings",    // System configuration and settings
2025-11-19T16:06:05.6922704Z -        "Shield",      // Security and permissions
2025-11-19T16:06:05.6923347Z -        "Network",     // Networking and connectivity
2025-11-19T16:06:05.6923539Z -        "Database",    // Database and data management
2025-11-19T16:06:05.6923743Z -        "Server",      // Server administration and services
2025-11-19T16:06:05.6923934Z +        "Terminal",   // Command line and shell tutorials
2025-11-19T16:06:05.6924161Z +        "FolderTree", // File system and directory tutorials
2025-11-19T16:06:05.6924368Z +        "FileText",   // Text editing and file manipulation
2025-11-19T16:06:05.6924563Z +        "Settings",   // System configuration and settings
2025-11-19T16:06:05.6924720Z +        "Shield",     // Security and permissions
2025-11-19T16:06:05.6924909Z +        "Network",    // Networking and connectivity
2025-11-19T16:06:05.6925091Z +        "Database",   // Database and data management
2025-11-19T16:06:05.6925293Z +        "Server",     // Server administration and services
2025-11-19T16:06:05.6925417Z      ];
2025-11-19T16:06:05.6925523Z  
2025-11-19T16:06:05.6925669Z      if ALLOWED_ICONS.contains(&icon) {
2025-11-19T16:06:05.6926124Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:182:
2025-11-19T16:06:05.6926231Z  
2025-11-19T16:06:05.6926364Z  #[derive(Deserialize)]
2025-11-19T16:06:05.6926522Z  pub struct TutorialListQuery {
2025-11-19T16:06:05.6926640Z -
2025-11-19T16:06:05.6926820Z      #[serde(default = "default_tutorial_limit")]
2025-11-19T16:06:05.6926939Z      limit: i64,
2025-11-19T16:06:05.6927058Z  
2025-11-19T16:06:05.6927512Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:235:
2025-11-19T16:06:05.6927661Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6927937Z      Path(id): Path<String>,
2025-11-19T16:06:05.6928267Z  ) -> Result<Json<TutorialResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6928367Z -
2025-11-19T16:06:05.6928547Z      if let Err(e) = validate_tutorial_id(&id) {
2025-11-19T16:06:05.6928937Z          return Err((StatusCode::BAD_REQUEST, Json(ErrorResponse { error: e })));
2025-11-19T16:06:05.6929052Z      }
2025-11-19T16:06:05.6929637Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:279:
2025-11-19T16:06:05.6929778Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6929975Z      Json(payload): Json<CreateTutorialRequest>,
2025-11-19T16:06:05.6930294Z  ) -> Result<Json<TutorialResponse>, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6930414Z -
2025-11-19T16:06:05.6930573Z      if claims.role != "admin" {
2025-11-19T16:06:05.6930703Z          return Err((
2025-11-19T16:06:05.6930865Z              StatusCode::FORBIDDEN,
2025-11-19T16:06:05.6931289Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:321:
2025-11-19T16:06:05.6931415Z                      }),
2025-11-19T16:06:05.6931537Z                  )
2025-11-19T16:06:05.6931653Z              })?;
2025-11-19T16:06:05.6931780Z -        
2025-11-19T16:06:05.6931886Z +
2025-11-19T16:06:05.6932000Z          if exists {
2025-11-19T16:06:05.6932115Z -             return Err((
2025-11-19T16:06:05.6932248Z +            return Err((
2025-11-19T16:06:05.6932396Z                  StatusCode::CONFLICT,
2025-11-19T16:06:05.6932539Z                  Json(ErrorResponse {
2025-11-19T16:06:05.6932758Z                      error: "Tutorial ID already exists".to_string(),
2025-11-19T16:06:05.6933182Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/tutorials.rs:599:
2025-11-19T16:06:05.6933331Z      State(pool): State<DbPool>,
2025-11-19T16:06:05.6933476Z      Path(id): Path<String>,
2025-11-19T16:06:05.6933719Z  ) -> Result<StatusCode, (StatusCode, Json<ErrorResponse>)> {
2025-11-19T16:06:05.6933824Z -
2025-11-19T16:06:05.6933961Z      if claims.role != "admin" {
2025-11-19T16:06:05.6934089Z          return Err((
2025-11-19T16:06:05.6934224Z              StatusCode::FORBIDDEN,
2025-11-19T16:06:05.6947839Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:1:
2025-11-19T16:06:05.6948331Z -
2025-11-19T16:06:05.6948479Z  use crate::{
2025-11-19T16:06:05.6948591Z      auth,
2025-11-19T16:06:05.6948791Z      models::{ErrorResponse, UploadResponse},
2025-11-19T16:06:05.6949198Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:38:
2025-11-19T16:06:05.6949456Z          )
2025-11-19T16:06:05.6949580Z      })? {
2025-11-19T16:06:05.6949785Z          let name = field.name().unwrap_or("").to_string();
2025-11-19T16:06:05.6949899Z -        
2025-11-19T16:06:05.6950018Z +
2025-11-19T16:06:05.6950154Z          if name == "file" {
2025-11-19T16:06:05.6950427Z              let file_name = field.file_name().unwrap_or("unknown").to_string();
2025-11-19T16:06:05.6950538Z -            
2025-11-19T16:06:05.6950679Z +
2025-11-19T16:06:05.6950829Z              // Simple extension validation
2025-11-19T16:06:05.6951005Z              let ext = std::path::Path::new(&file_name)
2025-11-19T16:06:05.6951136Z                  .extension()
2025-11-19T16:06:05.6951535Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:83:
2025-11-19T16:06:05.6951643Z  
2025-11-19T16:06:05.6951868Z                  // Verify the detected extension matches our allowed list
2025-11-19T16:06:05.6952079Z                  if !ALLOWED_EXTENSIONS.contains(&detected_ext) {
2025-11-19T16:06:05.6952213Z -                     return Err((
2025-11-19T16:06:05.6952348Z +                    return Err((
2025-11-19T16:06:05.6952513Z                          StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6952666Z                          Json(ErrorResponse {
2025-11-19T16:06:05.6952996Z -                            error: format!("File type '{}' not allowed. Detected: {}", detected_ext, mime),
2025-11-19T16:06:05.6953314Z +                            error: format!(
2025-11-19T16:06:05.6953516Z +                                "File type '{}' not allowed. Detected: {}",
2025-11-19T16:06:05.6953662Z +                                detected_ext, mime
2025-11-19T16:06:05.6953792Z +                            ),
2025-11-19T16:06:05.6953916Z                          }),
2025-11-19T16:06:05.6954029Z                      ));
2025-11-19T16:06:05.6954118Z                  }
2025-11-19T16:06:05.6954534Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:93:
2025-11-19T16:06:05.6954643Z  
2025-11-19T16:06:05.6954987Z                  // Verify the detected extension matches the file extension (prevent spoofing)
2025-11-19T16:06:05.6955348Z                  // Note: infer might return "jpeg" for "jpg", so we need to be flexible or normalize
2025-11-19T16:06:05.6955731Z -                let normalized_detected = if detected_ext == "jpeg" { "jpg" } else { detected_ext };
2025-11-19T16:06:05.6955962Z +                let normalized_detected = if detected_ext == "jpeg" {
2025-11-19T16:06:05.6956094Z +                    "jpg"
2025-11-19T16:06:05.6956204Z +                } else {
2025-11-19T16:06:05.6956333Z +                    detected_ext
2025-11-19T16:06:05.6956445Z +                };
2025-11-19T16:06:05.6956753Z                  let normalized_ext = if ext == "jpeg" { "jpg" } else { ext.as_str() };
2025-11-19T16:06:05.6956860Z  
2025-11-19T16:06:05.6957048Z                  if normalized_detected != normalized_ext {
2025-11-19T16:06:05.6957483Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:100:
2025-11-19T16:06:05.6957607Z -                     return Err((
2025-11-19T16:06:05.6957722Z +                    return Err((
2025-11-19T16:06:05.6957890Z                          StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6958062Z                          Json(ErrorResponse {
2025-11-19T16:06:05.6958502Z -                            error: format!("File extension mismatch. Expected '{}', but detected '{}'", ext, detected_ext),
2025-11-19T16:06:05.6958639Z +                            error: format!(
2025-11-19T16:06:05.6958905Z +                                "File extension mismatch. Expected '{}', but detected '{}'",
2025-11-19T16:06:05.6959154Z +                                ext, detected_ext
2025-11-19T16:06:05.6959437Z +                            ),
2025-11-19T16:06:05.6959565Z                          }),
2025-11-19T16:06:05.6959684Z                      ));
2025-11-19T16:06:05.6959798Z                  }
2025-11-19T16:06:05.6960204Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:107:
2025-11-19T16:06:05.6960332Z              } else {
2025-11-19T16:06:05.6960459Z -                 return Err((
2025-11-19T16:06:05.6960585Z +                return Err((
2025-11-19T16:06:05.6960752Z                      StatusCode::BAD_REQUEST,
2025-11-19T16:06:05.6960904Z                      Json(ErrorResponse {
2025-11-19T16:06:05.6961112Z                          error: "Could not determine file type".to_string(),
2025-11-19T16:06:05.6961464Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:116:
2025-11-19T16:06:05.6961704Z              let new_filename = format!("{}.{}", Uuid::new_v4(), ext);
2025-11-19T16:06:05.6962061Z              let upload_dir = std::env::var("UPLOAD_DIR").unwrap_or_else(|_| "uploads".to_string());
2025-11-19T16:06:05.6962267Z              let mut upload_path = PathBuf::from(upload_dir);
2025-11-19T16:06:05.6962390Z -            
2025-11-19T16:06:05.6962499Z +
2025-11-19T16:06:05.6962666Z              // Ensure uploads directory exists
2025-11-19T16:06:05.6962823Z              if !upload_path.exists() {
2025-11-19T16:06:05.6963057Z                  fs::create_dir_all(&upload_path).await.map_err(|err| {
2025-11-19T16:06:05.6963481Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:128:
2025-11-19T16:06:05.6963596Z                      )
2025-11-19T16:06:05.6963847Z                  })?;
2025-11-19T16:06:05.6963962Z              }
2025-11-19T16:06:05.6964080Z -            
2025-11-19T16:06:05.6964201Z +
2025-11-19T16:06:05.6964370Z              upload_path.push(&new_filename);
2025-11-19T16:06:05.6964488Z  
2025-11-19T16:06:05.6964714Z              fs::write(&upload_path, data).await.map_err(|err| {
2025-11-19T16:06:05.6965138Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/handlers/upload.rs:141:
2025-11-19T16:06:05.6965260Z              })?;
2025-11-19T16:06:05.6965372Z  
2025-11-19T16:06:05.6965577Z              let url = format!("/uploads/{}", new_filename);
2025-11-19T16:06:05.6965690Z -            
2025-11-19T16:06:05.6965803Z +
2025-11-19T16:06:05.6965984Z              return Ok(Json(UploadResponse { url }));
2025-11-19T16:06:05.6966087Z          }
2025-11-19T16:06:05.6966199Z      }
2025-11-19T16:06:05.6991373Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:1:
2025-11-19T16:06:05.6991538Z -
2025-11-19T16:06:05.6991804Z  // Module declarations for organizing the backend codebase
2025-11-19T16:06:05.6992106Z -pub mod auth;     // Authentication and JWT token management
2025-11-19T16:06:05.6992341Z -pub mod csrf;     // Cross-Site Request Forgery protection
2025-11-19T16:06:05.6992554Z -pub mod db;       // Database connection and pooling
2025-11-19T16:06:05.6992810Z +pub mod auth; // Authentication and JWT token management
2025-11-19T16:06:05.6993054Z +pub mod csrf; // Cross-Site Request Forgery protection
2025-11-19T16:06:05.6993243Z +pub mod db; // Database connection and pooling
2025-11-19T16:06:05.6993500Z  pub mod handlers; // HTTP request handlers organized by feature
2025-11-19T16:06:05.6993740Z -pub mod models;   // Data structures and database models
2025-11-19T16:06:05.6993918Z  pub mod middleware; // Middleware modules
2025-11-19T16:06:05.6994114Z +pub mod models; // Data structures and database models
2025-11-19T16:06:05.6994281Z  pub mod repositories; // Repository modules
2025-11-19T16:06:05.6994391Z  
2025-11-19T16:06:05.6994596Z  use crate::middleware::{cors, security};
2025-11-19T16:06:05.6994939Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:12:
2025-11-19T16:06:05.6995046Z  
2025-11-19T16:06:05.6995239Z  // HTTP-related imports for building the web server
2025-11-19T16:06:05.6995603Z  use axum::http::{
2025-11-19T16:06:05.6995738Z -    header::{
2025-11-19T16:06:05.6995896Z -        AUTHORIZATION, CONTENT_TYPE, ACCEPT,
2025-11-19T16:06:05.6996001Z -    },
2025-11-19T16:06:05.6996195Z +    header::{ACCEPT, AUTHORIZATION, CONTENT_TYPE},
2025-11-19T16:06:05.6996364Z      HeaderName, HeaderValue, Method,
2025-11-19T16:06:05.6996476Z  };
2025-11-19T16:06:05.6996600Z  use axum::{
2025-11-19T16:06:05.6996950Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:32:
2025-11-19T16:06:05.6997082Z  use tokio::signal;
2025-11-19T16:06:05.6997320Z  use tower_governor::key_extractor::SmartIpKeyExtractor;
2025-11-19T16:06:05.6997652Z  use tower_governor::{governor::GovernorConfigBuilder, GovernorLayer};
2025-11-19T16:06:05.6997799Z -use tower_http::cors::{CorsLayer};
2025-11-19T16:06:05.6997933Z +use tower_http::cors::CorsLayer;
2025-11-19T16:06:05.6998117Z  use tower_http::limit::RequestBodyLimitLayer;
2025-11-19T16:06:05.6998280Z  use tower_http::services::ServeDir;
2025-11-19T16:06:05.6998425Z  use tracing_subscriber;
2025-11-19T16:06:05.6998746Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:78:
2025-11-19T16:06:05.6999114Z  /// direct connection IP is trusted, preventing clients from faking their IP address.
2025-11-19T16:06:05.6999659Z  // These are now likely handled within the `security` module if they are still needed.
2025-11-19T16:06:05.6999769Z  
2025-11-19T16:06:05.6999878Z -
2025-11-19T16:06:05.7000104Z  // Request body size limits for different endpoint types
2025-11-19T16:06:05.7000307Z  // These prevent DoS attacks through large payloads
2025-11-19T16:06:05.7000615Z -const LOGIN_BODY_LIMIT: usize = 64 * 1024;      // 64KB for login endpoints
2025-11-19T16:06:05.7001041Z +const LOGIN_BODY_LIMIT: usize = 64 * 1024; // 64KB for login endpoints
2025-11-19T16:06:05.7001322Z  const PUBLIC_BODY_LIMIT: usize = 2 * 1024 * 1024; // 2MB for public endpoints
2025-11-19T16:06:05.7001613Z -const ADMIN_BODY_LIMIT: usize = 8 * 1024 * 1024;  // 8MB for admin content uploads
2025-11-19T16:06:05.7001933Z +const ADMIN_BODY_LIMIT: usize = 8 * 1024 * 1024; // 8MB for admin content uploads
2025-11-19T16:06:05.7002022Z  
2025-11-19T16:06:05.7002108Z -
2025-11-19T16:06:05.7002251Z  /// Main application entry point.
2025-11-19T16:06:05.7002353Z  ///
2025-11-19T16:06:05.7002658Z  /// This function initializes and starts the web server with all necessary
2025-11-19T16:06:05.7002995Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:153:
2025-11-19T16:06:05.7003124Z                  .iter()
2025-11-19T16:06:05.7003270Z                  .map(|&s| s.to_string())
2025-11-19T16:06:05.7003402Z                  .collect()
2025-11-19T16:06:05.7003512Z -            });
2025-11-19T16:06:05.7003628Z +        });
2025-11-19T16:06:05.7003733Z  
2025-11-19T16:06:05.7004160Z      let allowed_origins = cors::parse_allowed_origins(cors_origins.iter().map(|s| s.as_str()));
2025-11-19T16:06:05.7004277Z  
2025-11-19T16:06:05.7004611Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/main.rs:240:
2025-11-19T16:06:05.7004763Z              "/api/comments/{id}",
2025-11-19T16:06:05.7004958Z              delete(handlers::comments::delete_comment),
2025-11-19T16:06:05.7005074Z          )
2025-11-19T16:06:05.7005195Z -        .route(
2025-11-19T16:06:05.7005314Z -            "/api/upload",
2025-11-19T16:06:05.7005472Z -            post(handlers::upload::upload_image),
2025-11-19T16:06:05.7005569Z -        )
2025-11-19T16:06:05.7005911Z -        .route_layer(axum::middleware::from_fn_with_state(pool.clone(), csrf::enforce_csrf))
2025-11-19T16:06:05.7006336Z -        .route_layer(axum::middleware::from_fn_with_state(pool.clone(), middleware::auth::auth_middleware))
2025-11-19T16:06:05.7006583Z +        .route("/api/upload", post(handlers::upload::upload_image))
2025-11-19T16:06:05.7006783Z +        .route_layer(axum::middleware::from_fn_with_state(
2025-11-19T16:06:05.7006919Z +            pool.clone(),
2025-11-19T16:06:05.7007055Z +            csrf::enforce_csrf,
2025-11-19T16:06:05.7007318Z +        ))
2025-11-19T16:06:05.7007514Z +        .route_layer(axum::middleware::from_fn_with_state(
2025-11-19T16:06:05.7007640Z +            pool.clone(),
2025-11-19T16:06:05.7007802Z +            middleware::auth::auth_middleware,
2025-11-19T16:06:05.7007909Z +        ))
2025-11-19T16:06:05.7008142Z          .layer(RequestBodyLimitLayer::new(ADMIN_BODY_LIMIT))
2025-11-19T16:06:05.7008406Z          .layer(GovernorLayer::new(admin_rate_limit_config.clone()));
2025-11-19T16:06:05.7008518Z  
2025-11-19T16:06:05.7008894Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/auth.rs:1:
2025-11-19T16:06:05.7009043Z  use crate::{auth, repositories};
2025-11-19T16:06:05.7009160Z -use axum::{
2025-11-19T16:06:05.7009418Z -    http::StatusCode,
2025-11-19T16:06:05.7009550Z -    Json,
2025-11-19T16:06:05.7009643Z -};
2025-11-19T16:06:05.7009792Z +use axum::{http::StatusCode, Json};
2025-11-19T16:06:05.7009911Z  
2025-11-19T16:06:05.7010173Z  /// AXUM middleware for protecting routes with authentication.
2025-11-19T16:06:05.7010291Z  ///
2025-11-19T16:06:05.7010700Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/cors.rs:1:
2025-11-19T16:06:05.7010859Z  use axum::http::HeaderValue;
2025-11-19T16:06:05.7010968Z  
2025-11-19T16:06:05.7011165Z  // Default CORS origins for development environment
2025-11-19T16:06:05.7011638Z -pub const DEV_DEFAULT_FRONTEND_ORIGINS: &[&str] = &["http://localhost:5173", "http://localhost:3000"];
2025-11-19T16:06:05.7011839Z +pub const DEV_DEFAULT_FRONTEND_ORIGINS: &[&str] =
2025-11-19T16:06:05.7012059Z +    &["http://localhost:5173", "http://localhost:3000"];
2025-11-19T16:06:05.7012179Z  
2025-11-19T16:06:05.7012534Z  /// Parses and validates a list of allowed CORS origins.
2025-11-19T16:06:05.7012835Z  pub fn parse_allowed_origins<'a, I>(origins: I) -> Vec<HeaderValue>
2025-11-19T16:06:05.7013241Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/middleware/mod.rs:1:
2025-11-19T16:06:05.7013392Z +pub mod auth;
2025-11-19T16:06:05.7013517Z  pub mod cors;
2025-11-19T16:06:05.7013651Z  pub mod security;
2025-11-19T16:06:05.7013801Z -pub mod auth;
2025-11-19T16:06:05.7013913Z  
2025-11-19T16:06:05.7036187Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:1:
2025-11-19T16:06:05.7036369Z -
2025-11-19T16:06:05.7036469Z -
2025-11-19T16:06:05.7036674Z  use serde::{Deserialize, Serialize};
2025-11-19T16:06:05.7036793Z  use serde_json::Value;
2025-11-19T16:06:05.7036897Z  use sqlx::FromRow;
2025-11-19T16:06:05.7037224Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:74:
2025-11-19T16:06:05.7037349Z      pub color: String,
2025-11-19T16:06:05.7037445Z  
2025-11-19T16:06:05.7037602Z      pub topics: Vec<String>,
2025-11-19T16:06:05.7037714Z -    
2025-11-19T16:06:05.7037823Z +
2025-11-19T16:06:05.7037951Z      pub content: String,
2025-11-19T16:06:05.7038056Z  
2025-11-19T16:06:05.7038185Z      pub id: Option<String>,
2025-11-19T16:06:05.7038545Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:140:
2025-11-19T16:06:05.7038920Z          let topics: Vec<String> = serde_json::from_str(&tutorial.topics).unwrap_or_else(|e| {
2025-11-19T16:06:05.7039064Z              tracing::error!(
2025-11-19T16:06:05.7039522Z                  "Failed to parse topics JSON for tutorial {}: {}. Topics JSON: '{}'",
2025-11-19T16:06:05.7039677Z -                tutorial.id, e, tutorial.topics
2025-11-19T16:06:05.7039800Z +                tutorial.id,
2025-11-19T16:06:05.7039901Z +                e,
2025-11-19T16:06:05.7040029Z +                tutorial.topics
2025-11-19T16:06:05.7040138Z              );
2025-11-19T16:06:05.7040266Z              Vec::new()
2025-11-19T16:06:05.7040373Z          });
2025-11-19T16:06:05.7040717Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:167:
2025-11-19T16:06:05.7041096Z          let topics: Vec<String> = serde_json::from_str(&tutorial.topics).unwrap_or_else(|e| {
2025-11-19T16:06:05.7041232Z              tracing::error!(
2025-11-19T16:06:05.7041743Z                  "Failed to parse topics JSON for tutorial {}: {}. Topics JSON: '{}'",
2025-11-19T16:06:05.7041917Z -                tutorial.id, e, tutorial.topics
2025-11-19T16:06:05.7042040Z +                tutorial.id,
2025-11-19T16:06:05.7042157Z +                e,
2025-11-19T16:06:05.7042290Z +                tutorial.topics
2025-11-19T16:06:05.7042411Z              );
2025-11-19T16:06:05.7042543Z              Vec::new()
2025-11-19T16:06:05.7042650Z          });
2025-11-19T16:06:05.7043026Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:253:
2025-11-19T16:06:05.7043131Z  
2025-11-19T16:06:05.7043271Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7043431Z  pub struct SitePageResponse {
2025-11-19T16:06:05.7043541Z -
2025-11-19T16:06:05.7043658Z      pub id: String,
2025-11-19T16:06:05.7043755Z  
2025-11-19T16:06:05.7043898Z      pub slug: String,
2025-11-19T16:06:05.7044248Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:281:
2025-11-19T16:06:05.7044363Z  
2025-11-19T16:06:05.7044494Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7044660Z  pub struct SitePageListResponse {
2025-11-19T16:06:05.7044764Z -
2025-11-19T16:06:05.7044926Z      pub items: Vec<SitePageResponse>,
2025-11-19T16:06:05.7045044Z  }
2025-11-19T16:06:05.7045151Z  
2025-11-19T16:06:05.7045510Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:288:
2025-11-19T16:06:05.7045647Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7045827Z  pub struct SitePageWithPostsResponse {
2025-11-19T16:06:05.7045932Z -
2025-11-19T16:06:05.7046086Z      pub page: SitePageResponse,
2025-11-19T16:06:05.7046207Z  
2025-11-19T16:06:05.7046369Z      pub posts: Vec<SitePostResponse>,
2025-11-19T16:06:05.7046829Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:295:
2025-11-19T16:06:05.7046938Z  
2025-11-19T16:06:05.7047080Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7047245Z  pub struct SitePostDetailResponse {
2025-11-19T16:06:05.7047360Z -
2025-11-19T16:06:05.7047515Z      pub page: SitePageResponse,
2025-11-19T16:06:05.7047613Z  
2025-11-19T16:06:05.7047759Z      pub post: SitePostResponse,
2025-11-19T16:06:05.7048119Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:303:
2025-11-19T16:06:05.7048236Z  
2025-11-19T16:06:05.7048380Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.7048538Z  pub struct CreateSitePageRequest {
2025-11-19T16:06:05.7048649Z -
2025-11-19T16:06:05.7048775Z      pub slug: String,
2025-11-19T16:06:05.7048886Z  
2025-11-19T16:06:05.7049006Z      pub title: String,
2025-11-19T16:06:05.7049500Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:329:
2025-11-19T16:06:05.7049599Z  
2025-11-19T16:06:05.7049737Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.7049922Z  pub struct UpdateSitePageRequest {
2025-11-19T16:06:05.7050027Z -
2025-11-19T16:06:05.7050170Z      pub slug: Option<String>,
2025-11-19T16:06:05.7050284Z  
2025-11-19T16:06:05.7050451Z      pub title: Option<String>,
2025-11-19T16:06:05.7050823Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:351:
2025-11-19T16:06:05.7050935Z  
2025-11-19T16:06:05.7051155Z  #[derive(Debug, Serialize, Deserialize, FromRow, Clone)]
2025-11-19T16:06:05.7051292Z  pub struct SitePost {
2025-11-19T16:06:05.7051398Z -
2025-11-19T16:06:05.7051495Z      pub id: String,
2025-11-19T16:06:05.7051607Z  
2025-11-19T16:06:05.7051739Z      pub page_id: String,
2025-11-19T16:06:05.7052053Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:377:
2025-11-19T16:06:05.7052163Z  
2025-11-19T16:06:05.7052297Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7052429Z  pub struct SitePostResponse {
2025-11-19T16:06:05.7052524Z -
2025-11-19T16:06:05.7052636Z      pub id: String,
2025-11-19T16:06:05.7052729Z  
2025-11-19T16:06:05.7052852Z      pub page_id: String,
2025-11-19T16:06:05.7053219Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:403:
2025-11-19T16:06:05.7053501Z  
2025-11-19T16:06:05.7053645Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7053815Z  pub struct SitePostListResponse {
2025-11-19T16:06:05.7053937Z -
2025-11-19T16:06:05.7054102Z      pub items: Vec<SitePostResponse>,
2025-11-19T16:06:05.7054205Z  }
2025-11-19T16:06:05.7054314Z  
2025-11-19T16:06:05.7054641Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:410:
2025-11-19T16:06:05.7054773Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.7054938Z  pub struct CreateSitePostRequest {
2025-11-19T16:06:05.7055045Z -
2025-11-19T16:06:05.7055174Z      pub title: String,
2025-11-19T16:06:05.7055274Z  
2025-11-19T16:06:05.7055406Z      pub slug: String,
2025-11-19T16:06:05.7055767Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:428:
2025-11-19T16:06:05.7055879Z  
2025-11-19T16:06:05.7056012Z  #[derive(Debug, Deserialize)]
2025-11-19T16:06:05.7056169Z  pub struct UpdateSitePostRequest {
2025-11-19T16:06:05.7056275Z -
2025-11-19T16:06:05.7056413Z      pub title: Option<String>,
2025-11-19T16:06:05.7056528Z  
2025-11-19T16:06:05.7056665Z      pub slug: Option<String>,
2025-11-19T16:06:05.7057015Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:446:
2025-11-19T16:06:05.7057123Z  
2025-11-19T16:06:05.7057272Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7057444Z  pub struct NavigationItemResponse {
2025-11-19T16:06:05.7057552Z -
2025-11-19T16:06:05.7057681Z      pub id: String,
2025-11-19T16:06:05.7057790Z  
2025-11-19T16:06:05.7057908Z      pub slug: String,
2025-11-19T16:06:05.7058268Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/models.rs:458:
2025-11-19T16:06:05.7058378Z  
2025-11-19T16:06:05.7058515Z  #[derive(Debug, Serialize)]
2025-11-19T16:06:05.7058783Z  pub struct NavigationResponse {
2025-11-19T16:06:05.7058896Z -
2025-11-19T16:06:05.7059086Z      pub items: Vec<NavigationItemResponse>,
2025-11-19T16:06:05.7059329Z  }
2025-11-19T16:06:05.7059443Z  
2025-11-19T16:06:05.7059964Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/comments.rs:125:
2025-11-19T16:06:05.7060084Z      Ok(exists.is_some())
2025-11-19T16:06:05.7060190Z  }
2025-11-19T16:06:05.7060292Z  
2025-11-19T16:06:05.7060764Z -pub async fn check_vote_exists(pool: &DbPool, comment_id: &str, voter_id: &str) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.7060943Z -    let exists: Option<(i64,)> = sqlx::query_as(
2025-11-19T16:06:05.7061223Z -        "SELECT 1 FROM comment_votes WHERE comment_id = ? AND voter_id = ?"
2025-11-19T16:06:05.7061333Z -    )
2025-11-19T16:06:05.7061449Z -    .bind(comment_id)
2025-11-19T16:06:05.7061571Z -    .bind(voter_id)
2025-11-19T16:06:05.7061713Z -    .fetch_optional(pool)
2025-11-19T16:06:05.7061822Z -    .await?;
2025-11-19T16:06:05.7061973Z +pub async fn check_vote_exists(
2025-11-19T16:06:05.7062111Z +    pool: &DbPool,
2025-11-19T16:06:05.7062239Z +    comment_id: &str,
2025-11-19T16:06:05.7062366Z +    voter_id: &str,
2025-11-19T16:06:05.7062510Z +) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.7062650Z +    let exists: Option<(i64,)> =
2025-11-19T16:06:05.7062981Z +        sqlx::query_as("SELECT 1 FROM comment_votes WHERE comment_id = ? AND voter_id = ?")
2025-11-19T16:06:05.7063101Z +            .bind(comment_id)
2025-11-19T16:06:05.7063237Z +            .bind(voter_id)
2025-11-19T16:06:05.7063372Z +            .fetch_optional(pool)
2025-11-19T16:06:05.7063478Z +            .await?;
2025-11-19T16:06:05.7063600Z      Ok(exists.is_some())
2025-11-19T16:06:05.7063709Z  }
2025-11-19T16:06:05.7063804Z  
2025-11-19T16:06:05.7064253Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/comments.rs:151:
2025-11-19T16:06:05.7064374Z      Ok(())
2025-11-19T16:06:05.7064477Z  }
2025-11-19T16:06:05.7064587Z  
2025-11-19T16:06:05.7065054Z -pub async fn get_last_comment_time(pool: &DbPool, author: &str) -> Result<Option<String>, sqlx::Error> {
2025-11-19T16:06:05.7065225Z +pub async fn get_last_comment_time(
2025-11-19T16:06:05.7065347Z +    pool: &DbPool,
2025-11-19T16:06:05.7065623Z +    author: &str,
2025-11-19T16:06:05.7065804Z +) -> Result<Option<String>, sqlx::Error> {
2025-11-19T16:06:05.7066023Z      let last_comment: Option<(String,)> = sqlx::query_as(
2025-11-19T16:06:05.7066376Z -        "SELECT created_at FROM comments WHERE author = ? ORDER BY created_at DESC LIMIT 1"
2025-11-19T16:06:05.7066716Z +        "SELECT created_at FROM comments WHERE author = ? ORDER BY created_at DESC LIMIT 1",
2025-11-19T16:06:05.7066845Z      )
2025-11-19T16:06:05.7066961Z      .bind(author)
2025-11-19T16:06:05.7067098Z      .fetch_optional(pool)
2025-11-19T16:06:05.7067572Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/content.rs:4:
2025-11-19T16:06:05.7067704Z  use serde_json::Value;
2025-11-19T16:06:05.7067821Z  use sqlx;
2025-11-19T16:06:05.7067931Z  
2025-11-19T16:06:05.7068086Z -pub async fn fetch_all_site_content(
2025-11-19T16:06:05.7068211Z -    pool: &DbPool,
2025-11-19T16:06:05.7068394Z -) -> Result<Vec<SiteContent>, sqlx::Error> {
2025-11-19T16:06:05.7068811Z +pub async fn fetch_all_site_content(pool: &DbPool) -> Result<Vec<SiteContent>, sqlx::Error> {
2025-11-19T16:06:05.7068966Z      sqlx::query_as::<_, SiteContent>(
2025-11-19T16:06:05.7069456Z          "SELECT section, content_json, updated_at FROM site_content ORDER BY section",
2025-11-19T16:06:05.7069586Z      )
2025-11-19T16:06:05.7070018Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/mod.rs:1:
2025-11-19T16:06:05.7070156Z +pub mod app_metadata;
2025-11-19T16:06:05.7070297Z +pub mod comments;
2025-11-19T16:06:05.7070426Z  pub mod common;
2025-11-19T16:06:05.7070544Z  pub mod content;
2025-11-19T16:06:05.7070674Z  pub mod pages;
2025-11-19T16:06:05.7071269Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/mod.rs:4:
2025-11-19T16:06:05.7071396Z  pub mod posts;
2025-11-19T16:06:05.7071548Z  pub mod token_blacklist;
2025-11-19T16:06:05.7071679Z  pub mod tutorials;
2025-11-19T16:06:05.7071798Z -pub mod comments;
2025-11-19T16:06:05.7071925Z  pub mod users;
2025-11-19T16:06:05.7072060Z -pub mod app_metadata;
2025-11-19T16:06:05.7072184Z  
2025-11-19T16:06:05.7074838Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:22:
2025-11-19T16:06:05.7074957Z      .await
2025-11-19T16:06:05.7075093Z  }
2025-11-19T16:06:05.7075195Z  
2025-11-19T16:06:05.7075351Z -pub async fn list_published_pages(
2025-11-19T16:06:05.7075489Z -    pool: &DbPool,
2025-11-19T16:06:05.7075678Z -) -> Result<Vec<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.7076085Z +pub async fn list_published_pages(pool: &DbPool) -> Result<Vec<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.7076236Z      sqlx::query_as::<_, SitePage>(
2025-11-19T16:06:05.7076861Z          "SELECT id, slug, title, description, nav_label, show_in_nav, order_index, is_published, hero_json, layout_json, created_at, updated_at
2025-11-19T16:06:05.7076993Z           FROM site_pages
2025-11-19T16:06:05.7077438Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:35:
2025-11-19T16:06:05.7077568Z      .await
2025-11-19T16:06:05.7077678Z  }
2025-11-19T16:06:05.7077778Z  
2025-11-19T16:06:05.7077930Z -pub async fn get_site_page_by_id(
2025-11-19T16:06:05.7078052Z -    pool: &DbPool,
2025-11-19T16:06:05.7078165Z -    id: &str,
2025-11-19T16:06:05.7078343Z -) -> Result<Option<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.7078780Z +pub async fn get_site_page_by_id(pool: &DbPool, id: &str) -> Result<Option<SitePage>, sqlx::Error> {
2025-11-19T16:06:05.7078922Z      sqlx::query_as::<_, SitePage>(
2025-11-19T16:06:05.7079811Z          "SELECT id, slug, title, description, nav_label, show_in_nav, order_index, is_published, hero_json, layout_json, created_at, updated_at FROM site_pages WHERE id = ?",
2025-11-19T16:06:05.7079940Z      )
2025-11-19T16:06:05.7080389Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/pages.rs:63:
2025-11-19T16:06:05.7080515Z      pool: &DbPool,
2025-11-19T16:06:05.7080678Z      page: CreateSitePageRequest,
2025-11-19T16:06:05.7081069Z  ) -> Result<SitePage, sqlx::Error> {
2025-11-19T16:06:05.7081176Z -
2025-11-19T16:06:05.7081317Z      validate_slug(&page.slug)?;
2025-11-19T16:06:05.7081426Z  
2025-11-19T16:06:05.7081596Z      let id = uuid::Uuid::new_v4().to_string();
2025-11-19T16:06:05.7084705Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/posts.rs:49:
2025-11-19T16:06:05.7084839Z      .await
2025-11-19T16:06:05.7084942Z  }
2025-11-19T16:06:05.7085043Z  
2025-11-19T16:06:05.7085210Z -pub async fn get_site_post_by_id(
2025-11-19T16:06:05.7085325Z -    pool: &DbPool,
2025-11-19T16:06:05.7085438Z -    id: &str,
2025-11-19T16:06:05.7085618Z -) -> Result<Option<SitePost>, sqlx::Error> {
2025-11-19T16:06:05.7086045Z +pub async fn get_site_post_by_id(pool: &DbPool, id: &str) -> Result<Option<SitePost>, sqlx::Error> {
2025-11-19T16:06:05.7086195Z      sqlx::query_as::<_, SitePost>(
2025-11-19T16:06:05.7086761Z          "SELECT id, page_id, title, slug, excerpt, content_markdown, is_published, published_at, order_index, created_at, updated_at
2025-11-19T16:06:05.7086926Z           FROM site_posts WHERE id = ?",
2025-11-19T16:06:05.7087973Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/token_blacklist.rs:1:
2025-11-19T16:06:05.7088131Z  use crate::db::DbPool;
2025-11-19T16:06:05.7088252Z  use sqlx;
2025-11-19T16:06:05.7088356Z  
2025-11-19T16:06:05.7088808Z -pub async fn blacklist_token(pool: &DbPool, token: &str, expires_at: i64) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.7089554Z -    let expires_at_str = chrono::DateTime::<chrono::Utc>::from(std::time::UNIX_EPOCH + std::time::Duration::from_secs(expires_at as u64))
2025-11-19T16:06:05.7089672Z -        .to_rfc3339();
2025-11-19T16:06:05.7089996Z +pub async fn blacklist_token(
2025-11-19T16:06:05.7090139Z +    pool: &DbPool,
2025-11-19T16:06:05.7090260Z +    token: &str,
2025-11-19T16:06:05.7090383Z +    expires_at: i64,
2025-11-19T16:06:05.7090529Z +) -> Result<(), sqlx::Error> {
2025-11-19T16:06:05.7090780Z +    let expires_at_str = chrono::DateTime::<chrono::Utc>::from(
2025-11-19T16:06:05.7091085Z +        std::time::UNIX_EPOCH + std::time::Duration::from_secs(expires_at as u64),
2025-11-19T16:06:05.7091196Z +    )
2025-11-19T16:06:05.7091324Z +    .to_rfc3339();
2025-11-19T16:06:05.7091424Z  
2025-11-19T16:06:05.7091754Z      sqlx::query("INSERT INTO token_blacklist (token, expires_at) VALUES (?, ?)")
2025-11-19T16:06:05.7091875Z          .bind(token)
2025-11-19T16:06:05.7092404Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/token_blacklist.rs:14:
2025-11-19T16:06:05.7092519Z  }
2025-11-19T16:06:05.7092626Z  
2025-11-19T16:06:05.7093045Z  pub async fn is_token_blacklisted(pool: &DbPool, token: &str) -> Result<bool, sqlx::Error> {
2025-11-19T16:06:05.7093467Z -    let exists: Option<(String,)> = sqlx::query_as("SELECT token FROM token_blacklist WHERE token = ?")
2025-11-19T16:06:05.7093588Z -        .bind(token)
2025-11-19T16:06:05.7093737Z -        .fetch_optional(pool)
2025-11-19T16:06:05.7093861Z -        .await?;
2025-11-19T16:06:05.7094005Z +    let exists: Option<(String,)> =
2025-11-19T16:06:05.7094280Z +        sqlx::query_as("SELECT token FROM token_blacklist WHERE token = ?")
2025-11-19T16:06:05.7094420Z +            .bind(token)
2025-11-19T16:06:05.7094560Z +            .fetch_optional(pool)
2025-11-19T16:06:05.7094674Z +            .await?;
2025-11-19T16:06:05.7094812Z      Ok(exists.is_some())
2025-11-19T16:06:05.7094924Z  }
2025-11-19T16:06:05.7095034Z  
2025-11-19T16:06:05.7098428Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/tutorials.rs:2:
2025-11-19T16:06:05.7098612Z  use crate::models::Tutorial;
2025-11-19T16:06:05.7098725Z  use sqlx;
2025-11-19T16:06:05.7098838Z  
2025-11-19T16:06:05.7098966Z -
2025-11-19T16:06:05.7099113Z  pub async fn list_tutorials(
2025-11-19T16:06:05.7099372Z      pool: &DbPool,
2025-11-19T16:06:05.7099492Z      limit: i64,
2025-11-19T16:06:05.7101683Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/users.rs:8:
2025-11-19T16:06:05.7102008Z      pub blocked_until: Option<String>,
2025-11-19T16:06:05.7102102Z  }
2025-11-19T16:06:05.7102199Z  
2025-11-19T16:06:05.7102673Z -pub async fn get_user_by_username(pool: &DbPool, username: &str) -> Result<Option<User>, sqlx::Error> {
2025-11-19T16:06:05.7102826Z +pub async fn get_user_by_username(
2025-11-19T16:06:05.7102932Z +    pool: &DbPool,
2025-11-19T16:06:05.7103028Z +    username: &str,
2025-11-19T16:06:05.7103169Z +) -> Result<Option<User>, sqlx::Error> {
2025-11-19T16:06:05.7103415Z      sqlx::query_as::<_, User>("SELECT * FROM users WHERE username = ?")
2025-11-19T16:06:05.7103548Z          .bind(username)
2025-11-19T16:06:05.7103671Z          .fetch_optional(pool)
2025-11-19T16:06:05.7104063Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/src/repositories/users.rs:15:
2025-11-19T16:06:05.7104180Z          .await
2025-11-19T16:06:05.7104278Z  }
2025-11-19T16:06:05.7104375Z  
2025-11-19T16:06:05.7104793Z -pub async fn get_login_attempt(pool: &DbPool, username_hash: &str) -> Result<Option<LoginAttempt>, sqlx::Error> {
2025-11-19T16:06:05.7104922Z +pub async fn get_login_attempt(
2025-11-19T16:06:05.7105028Z +    pool: &DbPool,
2025-11-19T16:06:05.7105161Z +    username_hash: &str,
2025-11-19T16:06:05.7105340Z +) -> Result<Option<LoginAttempt>, sqlx::Error> {
2025-11-19T16:06:05.7105493Z      sqlx::query_as::<_, LoginAttempt>(
2025-11-19T16:06:05.7105760Z          "SELECT fail_count, blocked_until FROM login_attempts WHERE username = ?",
2025-11-19T16:06:05.7105847Z      )
2025-11-19T16:06:05.7110334Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/tests/bug_fixes.rs:6:
2025-11-19T16:06:05.7110559Z  async fn test_bug_fixes() -> anyhow::Result<()> {
2025-11-19T16:06:05.7110883Z      // Setup in-memory DB
2025-11-19T16:06:05.7111119Z      let pool = SqlitePool::connect("sqlite::memory:").await?;
2025-11-19T16:06:05.7111214Z -    
2025-11-19T16:06:05.7111416Z -    // Run migrations manually or via a helper if available. 
2025-11-19T16:06:05.7111523Z +
2025-11-19T16:06:05.7111737Z +    // Run migrations manually or via a helper if available.
2025-11-19T16:06:05.7112025Z      // Since we can't easily access the migration logic from here without exposing it,
2025-11-19T16:06:05.7112203Z      // we'll simulate the schema for the relevant tables.
2025-11-19T16:06:05.7113028Z      sqlx::query("CREATE TABLE tutorials (id TEXT PRIMARY KEY, title TEXT, description TEXT, icon TEXT, color TEXT, topics TEXT, content TEXT, version INTEGER, created_at TEXT, updated_at TEXT)")
2025-11-19T16:06:05.7113395Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/tests/bug_fixes.rs:14:
2025-11-19T16:06:05.7113545Z          .execute(&pool).await?;
2025-11-19T16:06:05.7113649Z -    
2025-11-19T16:06:05.7113764Z +
2025-11-19T16:06:05.7113988Z      // --- Verify Bug 1 & 2: Performance & Resilience ---
2025-11-19T16:06:05.7114254Z      // Insert a tutorial with INVALID JSON topics to test resilience
2025-11-19T16:06:05.7114881Z      sqlx::query("INSERT INTO tutorials (id, title, description, icon, color, topics, content, version, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)")
2025-11-19T16:06:05.7115218Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/tests/bug_fixes.rs:35:
2025-11-19T16:06:05.7115331Z      .fetch_all(&pool).await?;
2025-11-19T16:06:05.7115421Z  
2025-11-19T16:06:05.7115538Z      assert_eq!(tutorials.len(), 1);
2025-11-19T16:06:05.7115632Z -    
2025-11-19T16:06:05.7115716Z +
2025-11-19T16:06:05.7115901Z      // Test TryFrom conversion for Summary (Resilience check)
2025-11-19T16:06:05.7116358Z -    let summary: TutorialSummaryResponse = tutorials[0].try_into().expect("Should not fail even with invalid JSON");
2025-11-19T16:06:05.7116544Z +    let summary: TutorialSummaryResponse = tutorials[0]
2025-11-19T16:06:05.7116651Z +        .try_into()
2025-11-19T16:06:05.7116839Z +        .expect("Should not fail even with invalid JSON");
2025-11-19T16:06:05.7116967Z      assert_eq!(summary.id, "test-1");
2025-11-19T16:06:05.7117432Z -    assert!(summary.topics.is_empty(), "Should return empty topics for invalid JSON");
2025-11-19T16:06:05.7117530Z +    assert!(
2025-11-19T16:06:05.7117665Z +        summary.topics.is_empty(),
2025-11-19T16:06:05.7117841Z +        "Should return empty topics for invalid JSON"
2025-11-19T16:06:05.7117930Z +    );
2025-11-19T16:06:05.7118020Z  
2025-11-19T16:06:05.7118162Z      // --- Verify Bug 4: Validation ---
2025-11-19T16:06:05.7118496Z      // We can't easily test the handler logic directly without spinning up the full axum app,
2025-11-19T16:06:05.7118863Z Diff in /home/runner/work/RustBlogCMS/RustBlogCMS/backend/tests/bug_fixes.rs:46:
2025-11-19T16:06:05.7119096Z -    // but we can verify the validation logic if we extracted it. 
2025-11-19T16:06:05.7119525Z +    // but we can verify the validation logic if we extracted it.
2025-11-19T16:06:05.7119973Z      // Since we modified the handler directly, we'll rely on the manual verification plan for the full HTTP flow,
2025-11-19T16:06:05.7120143Z      // but we've verified the DB resilience above.
2025-11-19T16:06:05.7120245Z  
2025-11-19T16:06:05.7143037Z ##[error]Process completed with exit code 1.
2025-11-19T16:06:05.7206356Z Post job cleanup.
2025-11-19T16:06:05.7975245Z [command]/usr/bin/git version
2025-11-19T16:06:05.8008964Z git version 2.51.2
2025-11-19T16:06:05.8043460Z Temporarily overriding HOME='/home/runner/work/_temp/cf8dd41c-1031-4135-9ccc-04e37274d46c' before making global git config changes
2025-11-19T16:06:05.8045398Z Adding repository directory to the temporary git global config as a safe directory
2025-11-19T16:06:05.8049511Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/RustBlogCMS/RustBlogCMS
2025-11-19T16:06:05.8084960Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-11-19T16:06:05.8116501Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-11-19T16:06:05.8310418Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-11-19T16:06:05.8331855Z http.https://github.com/.extraheader
2025-11-19T16:06:05.8342056Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2025-11-19T16:06:05.8373515Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-11-19T16:06:05.8566488Z [command]/usr/bin/git config --local --name-only --get-regexp ^includeIf\.gitdir:
2025-11-19T16:06:05.8598862Z [command]/usr/bin/git submodule foreach --recursive git config --local --show-origin --name-only --get-regexp remote.origin.url
2025-11-19T16:06:05.8894966Z Cleaning up orphan processes
